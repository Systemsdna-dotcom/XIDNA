@model XICore.XIIComponent
@using XIDNA
@using XISystem
@using XICore
@using System.Globalization;
@{
    var falg = Model.bFlag;
    if (falg == true)
    {
        Layout = "~/Views/Shared/_PopupLayout.cshtml";
    }
    int iUserID = SessionManager.UserID;
    var sUserName = SessionManager.sName;
    var CheckboxonChangefnName = "AttachRenewalDoc";
    string PhysicalPath = System.Configuration.ConfigurationManager.AppSettings["SharedPath"];
    var singnalRID = "SigROneClick";
    XIDBO oBOD = new XIDBO();
    XID1Click o1ClickD = new XID1Click();
    string sRefenceID = SessionManager.sReference;
    bool bDebug = SessionManager.bDebug;
    string sPrimaryKey = string.Empty;
    <script src="~/Scripts/ajaxfileupload.js"></script>
    if (Model.oContent.ContainsKey(XIConstant.OneClickComponent))
    {
        o1ClickD = (XID1Click)Model.oContent[XIConstant.OneClickComponent];
        if (o1ClickD == null)
        {
            o1ClickD = new XID1Click();
        }
        XIInfraCache oCache = new XIInfraCache();
        oBOD = (XIDBO)oCache.GetObjectFromCache(XIConstant.CacheBO_All, null, o1ClickD.BOIDXIGUID.ToString());
        if (o1ClickD.Headings == null)
        {
            o1ClickD.Headings = new List<string>();
        }
        sPrimaryKey = oBOD.sPrimaryKey;
        if (string.IsNullOrEmpty(sPrimaryKey))
        {
            sPrimaryKey = "id";
        }
    }
    var sShowClickHeader = "yes";
    var SortColumns = o1ClickD.TableColumns;
    var sTabColumns = SortColumns == null ? null : string.Join(",", SortColumns);
    var sShowHeading = "yes";
    var IsSaveQS = "no";
    var IsDisableAdd = "no";
    var sShowCreate = "yes";
    var IsQSLinkLoading = "no";
    var ShowSections = string.Empty;
    var IsQuickSearch = "no";
    var oVisualisations = Model.oVisualisation;
    bool bUIDRef = false;
    var BOGUID = "";
    if (!string.IsNullOrEmpty(sRefenceID) && sRefenceID.ToLower() == "xiguid" && o1ClickD.BO != null)
    {
        bUIDRef = true;
        BOGUID = o1ClickD.BO;
    }
    //if (oVisualisations != null)
    //{
    //    var Visual = oVisualisations.Where(m => m.Name.ToLower() == "OneClickVisibility".ToLower()).Select(m => m.XiVisualisationNVs).FirstOrDefault();
    //    if (Visual != null)
    //    {
    //        var ShowHead = Visual.Where(m => m.sName.ToLower() == "Heading".ToLower()).Select(m => m.sValue).FirstOrDefault();
    //        if (!string.IsNullOrEmpty(ShowHead))
    //        {
    //            sShowHeading = ShowHead;
    //        }
    //    }
    //}
    var bIsStepLock = false;
    var IsLock = ViewBag.bIsStepLock;
    if (IsLock != null)
    {
        bIsStepLock = IsLock;
    }
    string sShowID = string.Empty;
    List<XIVisualisationNV> oVisualisationNVs = new List<XIVisualisationNV>();
    if (oVisualisations != null)
    {
        var oVisual = oVisualisations.FirstOrDefault();
        if (oVisual != null && oVisual.XiVisualisationNVs != null && oVisual.XiVisualisationNVs.Count() > 0)
        {
            oVisualisationNVs = oVisual.XiVisualisationNVs;
            var ShowHead = oVisualisationNVs.Where(m => m.sName.ToLower() == "Heading".ToLower()).Select(m => m.sValue).FirstOrDefault();
            if (!string.IsNullOrEmpty(ShowHead))
            {
                sShowHeading = ShowHead;
            }
            var ShowclickHeader = oVisualisationNVs.Where(m => m.sName.ToLower() == "IsShowHeaders".ToLower()).Select(m => m.sValue).FirstOrDefault();
            if (!string.IsNullOrEmpty(ShowclickHeader))
            {
                sShowClickHeader = ShowclickHeader;
            }
            var SaveQsStep = oVisualisationNVs.Where(m => m.sName.ToLower() == "IsSaveQsStep".ToLower()).Select(m => m.sValue).FirstOrDefault();
            if (!string.IsNullOrEmpty(SaveQsStep))
            {
                IsSaveQS = SaveQsStep;
            }
            var Count = oVisualisationNVs.Where(m => m.sName.ToLower() == "iCount".ToLower()).Select(m => m.sValue).FirstOrDefault();
            int iCount = 0;
            if (int.TryParse(Count, out iCount))
            {
                if (iCount >= 5)
                {
                    sShowCreate = "no";
                }
            }
            else
            {
                var ShowCreate = oVisualisationNVs.Where(m => m.sName.ToLower() == "ShowCreate".ToLower()).Select(m => m.sValue).FirstOrDefault();
                if (!string.IsNullOrEmpty(ShowCreate))
                {
                    sShowCreate = ShowCreate;
                }
            }
            var DisableAdd = oVisualisationNVs.Where(m => m.sName.ToLower() == "IsDisableAdd".ToLower()).Select(m => m.sValue).FirstOrDefault();
            if (!string.IsNullOrEmpty(DisableAdd))
            {
                IsDisableAdd = DisableAdd;
            }
            var sIsLoading = oVisualisationNVs.Where(m => m.sName.ToLower() == "IsQSLinkLoading".ToLower()).Select(m => m.sValue).FirstOrDefault();
            if (!string.IsNullOrEmpty(sIsLoading))
            {
                IsQSLinkLoading = sIsLoading;
            }
            var sShowSections = oVisualisationNVs.Where(m => m.sName.ToLower() == "ShowSections".ToLower()).Select(m => m.sValue).FirstOrDefault();
            if (!string.IsNullOrEmpty(sShowSections))
            {
                ShowSections = sShowSections;
            }
            var QuickSearch = oVisualisationNVs.Where(m => m.sName.ToLower() == "bIsQuickSearch".ToLower()).Select(m => m.sValue).FirstOrDefault();
            if (!string.IsNullOrEmpty(QuickSearch))
            {
                IsQuickSearch = QuickSearch;
            }
        }
    }
    var ReportID = o1ClickD.XIGUID;
    //var sBOName = string.Empty;
    var sBOName = string.Empty;
    var iBODID = 0;
    if (o1ClickD != null)
    {
        sBOName = o1ClickD.sBOName;
        iBODID = o1ClickD.BOID;
    }
    if (IsQuickSearch == "yes")
    {
        o1ClickD.SearchType = "Quick";
        o1ClickD.IsFilterSearch = false;
        o1ClickD.IsNaturalSearch = false;
    }
    if (o1ClickD.IsFilterSearch)
    {
        o1ClickD.SearchType = "FilterSearch";
    }
    else if (o1ClickD.IsNaturalSearch)
    {
        o1ClickD.SearchType = "NaturalSearch";
    }
    string sIsFirstTime = o1ClickD.sIsFirstTime;
    var iRecordCount = 0;
    if (o1ClickD.oDataSet != null && o1ClickD.oDataSet.Count() > 0)
    {
        iRecordCount = o1ClickD.oDataSet.Count();
    }
    int i = 1;
    Dictionary<string, string> refconvits = new Dictionary<string, string>();
    if (o1ClickD.sBOName != null && o1ClickD.sBOName.ToLower() == "conviction_t")
    {
        var DDLrefConviciton = oBOD.Attributes.Values.Where(m => m.Name.ToLower() == "refconviction").FirstOrDefault();
        if (DDLrefConviciton != null)
        {
            refconvits = DDLrefConviciton.FieldDDL.Where(m => !string.IsNullOrEmpty(m.Expression)).GroupBy(m => m.Expression).Select(m => m.FirstOrDefault()).ToDictionary(m => m.Expression, m => m.text);
        }
    }
    string ReconcilliationID = "0"; string ActRec = ""; string EnumReconciliation = "";
    XIInfraCache oCacheID = new XIInfraCache();
    string sSessionID = Context.Session.SessionID;
    ReconcilliationID = oCacheID.Get_ParamVal(sSessionID, o1ClickD.sGUID, null, "{XIP|ACReconcilliation_T.id}");
    ActRec = oCacheID.Get_ParamVal(sSessionID, o1ClickD.sGUID, null, "{XIP|ActRec}");
    EnumReconciliation = oCacheID.Get_ParamVal(sSessionID, o1ClickD.sGUID, null, "{XIP|EnumReconciliations_T.id}");
    string sScroll = "yes";
    var sTabGUID = Guid.NewGuid().ToString();
    if (o1ClickD.oOneClickParameters.Where(x => x.sName == "XIGUID").Count() == 0)
    {
        o1ClickD.oOneClickParameters.Add(new XID1ClickParameter { iType = 10, sName = "XIGUID", sValue = "{XIP|XIGUID}" });
    }
    string sErrorMsg = o1ClickD.sErrorMessage;
}
<link href="~/Content/theme.default.css" rel="stylesheet" />
<script src="~/Scripts/jquery.tablesorter.js"></script>
<script src="~/Scripts/jquery.tablesorter.widgets.js"></script>

<link href="@Url.Content("~/Scripts/Choosen/chosen.min.css")" rel="stylesheet" />
<script src="@Url.Content("~/Scripts/Choosen/chosen.jquery.min.js")"></script>
<script>

    $(document).ready(function()
    {
        if('@o1ClickD.Query' != null && '@o1ClickD.oOneClickParameters.Where(x => x.iType == 20).Count()'> 0)
        {
            $("#XICParams").dialog({
                modal: true,
                width: 600
            });
        }
    })
    var iRecordCount = '@iRecordCount';
    var dtable;
    var Fields = "";
    var Optrs = "";
    var Values = "";
    var sSearchType="";
    var SearchText="";
    var SubmitClick = 0;
    var NVPairs = [];
    var editpopups = new Array();
    var OneClickURL = '@Url.Action("GetOneClickResult", "XiLink")';
    if('@o1ClickD.IsNaturalSearch'=="True"){
        sSearchType="NaturalSearch";
    } else if('@o1ClickD.IsFilterSearch'=="True"){
        sSearchType="FilterSearch";
    }

    if('@o1ClickD.SearchType' != null && sSearchType.length == 0){
        sSearchType = '@o1ClickD.SearchType';
    }
    var SelectedFields=new Array();
    var FieldGroup = @Html.Raw(Json.Encode(o1ClickD.FilterGroup));
    function GetDataTable(Fields, Optrs, Values, Type, NVPairs, oneClickID, TableColumns) {
        debugger
        if('@o1ClickD.ResultListDisplayType'==1){
            var SortColumns =TableColumns.substring(2,TableColumns.length-2).split('","');
            var expColumns = new Array();
            for (var i = 0; i < SortColumns.length; i++) {
                var obj = new Object();
                obj.sName = SortColumns[i];
                if (SortColumns[i] == "Select") {
                    obj.bSortable = false;
                }
                else {
                    obj.bSortable = true;
                }
                expColumns.push(obj);
            }
            var iPageLength = 0;
            if('@o1ClickD.iPaginationCount' == 0)
            {
                iPageLength = 100;
            }
            else
            {
                iPageLength = '@o1ClickD.iPaginationCount';
            }
            var DynamicParams ="";
            if(NVPairs && NVPairs.length > 0){
                DynamicParams = NVPairs.join(",");
            }
            fncGetDTable(OneClickURL, '@o1ClickD.XIGUID', expColumns, '@o1ClickD.sGUID', '@o1ClickD.SearchText', iPageLength, '@sTabGUID', '@o1ClickD.SearchType','@o1ClickD.sParentWhere', DynamicParams,'@o1ClickD.iDefaultSortColumn','@o1ClickD.sDefaultSortDirection');
        }
        else{
            $("#OneClickResult-@sTabGUID").tablesorter();
        }
    }

    $(document).ready(function () {
        $(document.body).unbind('click').on('click', 'button#GridAddBtn', function(){
            var GUID = fncGetGUIDFromHTMLTree('LayoutGUID', this);
            var BODID = $(this).attr('data-boid');
            var sBO = $(this).attr('data-bo');
            XIRun(null,'@o1ClickD.iCreateXILinkIDXIGUID', 0, GUID, sBO, false, BODID);
            @*$.ajax({
                type: 'GET',
                url: '@Url.Action("GetLayoutDetails", "XiLink")',
                data: {iLayoutID: parseInt('@o1ClickD.iLayoutID'), sParentGUID: GUID, sSection: Section},
                contentType: 'application/json;',
                dataType: 'html',
                traditional: true,
                success: function (data) {
                    $('#GridAddFormDlg').html(data);
                    $("#GridAddFormDlg").dialog({
                        width: 700,
                        close: function (event, ui) {
                            $('#GridAddFormDlg').dialog('close');
                            //$('#my_dialog').parent().hide();
                            //$(this).dialog('destroy').remove();
                        }
                    });
                }
            });*@
        });
        $('.popcontainer').hide();
        $('body2').popover({
            trigger: 'hover',
            //placement: 'right',
            html: true,
            selector: '#OneClickResult-@sTabGUID td',
            content: function () {
                var MouseOver = $('#OneClickResult-@sTabGUID th').eq($(this).index()).attr('data-mover');
                var ColumnName = $('#OneClickResult-@sTabGUID th').eq($(this).index()).text();
                if ((MouseOver && MouseOver.length>0) || ColumnName=="ID") {
                    var ID = $(this).text();
                    var BOID = "@o1ClickD.BOID";
                    var BOName = MouseOver;
                    var LeadID = $(this).text();
                    var pvalue = {
                        BOID: BOID,
                        ID: parseInt(ID),
                        BOName:BOName,
                        ColumnName: ColumnName
                    }
                    $.ajax({
                        url: '@Url.Action("ListHover", "XiLink")',
                        type: 'POST',
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        cache: false,
                        async: false,
                        data: JSON.stringify(pvalue),
                        success: function (data) {
                            if(data){
                                var rowvalues = "";
                                rowvalues = rowvalues + '<div class="popover-time">';
                                rowvalues = rowvalues + '<table class="table m-b-none">';
                                rowvalues = rowvalues + '<tbody>';
                                rowvalues = rowvalues + '<thead>';
                                rowvalues = rowvalues + '</tr>';
                                if (data) {
                                    for (i = 0; i < data.NVPairs.length; i++) {
                                        //data[i].sValue = 'http://192.168.7.7/Converter/Content/images/lead-logo.png';
                                        rowvalues = rowvalues + '<tr>';
                                        //rowvalues = rowvalues + '<td class="fc-sky">' + data[i].sName + '</td>';
                                        //rowvalues = rowvalues + '<td>|</td>';

                                        var IsImage = false;
                                        var BOFields = data.Definition.BOFields;
                                        for(j=0;j<BOFields.length;j++){
                                            if(data.NVPairs[i].sName == BOFields[j].Name){
                                                var FileType = BOFields[j].FKiFileTypeID;
                                                if(FileType>0){
                                                    IsImage = true;
                                                }
                                            }
                                        }
                                        if(IsImage){
                                            rowvalues = rowvalues + '<td><img src="' + data.NVPairs[i].sValue + '"></td>';
                                        }
                                        else{
                                            rowvalues = rowvalues + '<td>' + data.NVPairs[i].sValue + '</td>';
                                        }
                                        //rowvalues = rowvalues + '<td><img src="/Content/Files/png/2018/3/16/images_1_168_137.png"></td>';
                                        rowvalues = rowvalues + '</tr>';
                                    }
                                }
                                //else {
                                //    rowvalues = rowvalues + '<tr>';
                                //    rowvalues = rowvalues + '<td> No foregin key group </td>';
                                //    rowvalues = rowvalues + '</tr>';
                                //}
                                rowvalues = rowvalues + '</thead>';
                                rowvalues = rowvalues + '</tbody>';
                                rowvalues = rowvalues + '</table>';
                                rowvalues = rowvalues + '</div>';
                                $(".popcontainer").empty();
                                $(".popcontainer").append(rowvalues);
                            }
                            else{
                                $(".popcontainer").empty();
                            }
                        },
                        error: function (data) {
                            $(".popcontainer").empty();
                        }
                    });
                    var rowdata = $('.popcontainer').html();
                    return $(rowdata).html();
                }
            },
            container: 'body',
            placement: 'auto top'
        });

        var poppopups = new Array();
        var respopups = new Array();
        var SearchString="";

        var availableTags;
        if(FieldGroup){
            availableTags = Object.keys(FieldGroup)
        }

        //$( "#QuickSearchTBox" ).autocomplete({
        //    source: availableTags,
        //    select: function (event, ui) { GetSearchResults() }
        //});
        function split( val ) {
            return val.split(" ");
        }
        function extractLast( term ) {
            return split( term ).pop();
        }

        //$( "#QuickSearchTBox" )
        //  // don't navigate away from the field on tab when selecting an item
        //  .on( "keydown", function( event ) {
        //      if ( event.keyCode === $.ui.keyCode.TAB &&
        //          $( this ).autocomplete( "instance" ).menu.active ) {
        //          event.preventDefault();
        //      }
        //  })
        //  .autocomplete({
        //      minLength: 0,
        //      source: function( request, response ) {
        //          // delegate back to autocomplete, but extract the last term
        //          response( $.ui.autocomplete.filter(
        //            availableTags, extractLast( request.term ) ) );
        //      },
        //      focus: function() {
        //          // prevent value inserted on focus
        //          return false;
        //      },
        //      select: function( event, ui ) {
        //          var terms = split( this.value );
        //          // remove the current input
        //          terms.pop();
        //          // add the selected item
        //          terms.push( ui.item.value );
        //          // add placeholder to get the comma-and-space at the end
        //          terms.push( "" );
        //          this.value = terms.join( " " );
        //          SelectedFields.push(ui.item.value);
        //          return false;
        //      }
        //  });
        var changeTimer = false;
        $('#QuickSearchTBox-@sTabGUID').on("keyup", function () {
            $(".oneclickres").show();
            if(changeTimer !== false) clearTimeout(changeTimer);
            changeTimer = setTimeout(function(){
                var srhType = $('#QuickSearchTBox-@sTabGUID').attr('data-srctype');
                GetSearchResults(srhType);
                changeTimer = false;
            },300);
        });
        function GetSearchResults(srhType) {
            SearchText = $('#QuickSearchTBox-@sTabGUID').val();
            if(SearchText.length==0){
                SelectedFields=[];
            }
            for(i=0;i<SelectedFields.length;i++){
                var SearchField = FieldGroup[SelectedFields[i]];
                if(SearchField){
                    SearchText = SearchText.replace(SelectedFields[i]+" ",SearchField+" ");
                }
            }
            if ('@o1ClickD.ResultListDisplayType' == 0){
                SubmitClick = 1;
                GetRecords(Fields,Optrs,Values, Type, SearchText);
            }
            else{
                //GetDataTable(Fields,Optrs,Values, Type, SearchText,"");
                var iPageLength = 0;
                if('@o1ClickD.iPaginationCount' == 0)
                {
                    iPageLength = 100;
                }
                else
                {
                    iPageLength = '@o1ClickD.iPaginationCount';
                }
                fncGetDTable(OneClickURL, '@o1ClickD.XIGUID', expColumns, '@o1ClickD.sGUID', SearchText, iPageLength, '@sTabGUID', srhType,'@o1ClickD.sParentWhere',null,'@o1ClickD.iDefaultSortColumn','@o1ClickD.sDefaultSortDirection');
            }
        }
        var popups = new Array();
        //GetDataTable(Fields,Optrs,Values,null);
        if ('@o1ClickD.Query' != null && '@o1ClickD.oOneClickParameters.Where(x => x.iType == 20).Count()' > 0) {
            $('#XIOneClickParamsBtn').click(function () {
                $("#XICParams").dialog('close');
                $('.NVPairs').each(function () {
                    var Name; var Value;
                    $(this).find('label').each(function (i, obj) {
                        Name = $(this).attr('data-sName');

                    });
                    $(this).find('input').each(function (i, obj) {
                        var Nname = obj.name;
                        if (Nname == "Names") {
                            Value = $(this).val();
                        }
                    });
                    if ((Name && Name.length > 0) || (Value && Value.length > 0)) {
                        NVPairs.push(Name + "-" + Value);
                    }
                });
                var TabColumns = '@Html.Raw(Json.Encode(@o1ClickD.TableColumns)).ToString()';
                TabColumns = TabColumns.replace(/&quot;/g, '"');
                GetDataTable(Fields, Optrs, Values, null, NVPairs, "", TabColumns);
            });
        }
        else {
            var oOneClickVisualisations =@Html.Raw(Json.Encode(oVisualisationNVs));
            if ('@o1ClickD.DisplayAs' == '50'||'@o1ClickD.DisplayAs' == '170') {
                var SortColumns = @Html.Raw(Json.Encode(o1ClickD.TableColumns));
                var expColumns = new Array();
                if (SortColumns && SortColumns != null && SortColumns.length > 0) {
                    for (var i = 0; i < SortColumns.length; i++) {
                        var ishidden = true;
                        if (oOneClickVisualisations != null && oOneClickVisualisations.length > 0) {
                            for (var j = 0; j < oOneClickVisualisations.length; j++) {
                                if (oOneClickVisualisations[j].sName.toLowerCase() == SortColumns[i].toLowerCase()) {
                                    if (oOneClickVisualisations[j].sValue != null && oOneClickVisualisations[j].sValue.toLowerCase() == "Yes".toLowerCase()) {
                                        ishidden = false;
                                    }
                                }
                            }
                        }
                        var obj = new Object();
                        obj.sName = SortColumns[i];
                        if (SortColumns[i] == "Select") {
                            obj.bSortable = false;
                        }
                        else {
                            obj.bSortable = true;
                            obj.visible = ishidden;
                            if (obj.sName == 'HiddenData') {
                                obj.visible = false;
                            }
                        }
                        expColumns.push(obj);
                    }
                    var iPageLength = 0;
                    if ('@o1ClickD.iPaginationCount' == 0) {
                        iPageLength = 100;
                    }
                    else {
                        iPageLength = '@o1ClickD.iPaginationCount';
                    }
                    fncGetDTable(OneClickURL, '@o1ClickD.XIGUID', expColumns, '@o1ClickD.sGUID', '@o1ClickD.SearchText', iPageLength, '@sTabGUID', '@o1ClickD.SearchType', '@o1ClickD.sParentWhere',null,'@o1ClickD.iDefaultSortColumn','@o1ClickD.sDefaultSortDirection', '@o1ClickD.bIsSelectAll');
                    //GetDataTable(Fields,Optrs,Values,null,"");
                }
            }
        }

        $('.DFSubmit').click(function () {
            SubmitClick = 1;
            pageIndex = 1;
            Fields = "";
            Optrs = "";
            Values = "";
            DValue ="";
            var j= 0;
            var SrchFlds = '@o1ClickD.SearchFields';
            if(SrchFlds && SrchFlds!=null){
                j = SrchFlds.split(", ").length;
            }
            for(i=0;i<j;i++){
                var form = $(this).parent().parent().parent().parent();
                var Value = $(form).find('#'+i+'-Value').val();
                if(Value && Value.length>0){
                    var Field =$(form).find('#'+i+'-FieldName').val();
                    var Optr = $(form).find('#'+i+'-Operator').val();
                    var DValue = $(form).find('#'+i+'-Value2').val();
                    if(Optr=="Between"){
                        Values = Values + Value+"_"+DValue+",";
                    }
                    else{
                        Values = Values + Value+",";
                    }
                    Fields = Fields + Field+",";
                    Optrs = Optrs + Optr+",";
                }
            }
            Fields = Fields.substring(0, Fields.length-1);
            Optrs = Optrs.substring(0, Optrs.length-1);
            Values = Values.substring(0, Values.length-1);
            if ('@o1ClickD.ResultListDisplayType' == 0){
                GetRecords(Fields,Optrs,Values,sSearchType, iPageLength);
            }
            else{
                fncGetDTable(OneClickURL, '@o1ClickD.XIGUID', expColumns, '@o1ClickD.sGUID','@o1ClickD.SearchText', iPageLength, '@sTabGUID', '@o1ClickD.SearchType', '@o1ClickD.sParentWhere',null,'@o1ClickD.iDefaultSortColumn','@o1ClickD.sDefaultSortDirection');
            }
        });
        $('.DFReset').click(function () {
            var form = $(this).parent().parent().parent().parent();
            $(form).find('#DynamicForm input[type="text"]').val('');
            $(form).find('#DynamicForm select').val('=');
            $(form).find('#DynamicQueryForm').find('select').each(function (i, val) {
                $(this).prop('selectedIndex',0);
            });
            $('.BetweenDate').hide();
            if ('@o1ClickD.ResultListDisplayType' == 0){
                SubmitClick = 1;
                Fields = "";
                Optrs = "";
                Values = "";
                GetRecords("","","",Type);
            }
            else{
                Fields = "";
                Optrs = "";
                Values = "";
                fncGetDTable(OneClickURL, '@o1ClickD.XIGUID', null, '@o1ClickD.sGUID', '@o1ClickD.SearchText','@sTabGUID', '@o1ClickD.SearchType', '@o1ClickD.sParentWhere', Fields,Optrs,Values);
            }
        });
        $('#OneClickResult-@sTabGUID tbody').unbind().on('click', 'tr.one-1q-row td:not(.one-1q-field-actions,.one-1q-field-hiddendata)', function (e) {
            debugger
            var Checked=$(this).find("input[type=checkbox]").prop("checked");
            var ColIndex= $('td', this).index(e.target);//$(this).parent().parent().children().index($(this).parent());
            var bIsLock='@o1ClickD.bIsRecordLock';
            var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', this);
            @*var o1ClickDJ = @Html.Raw(Json.Encode(o1ClickD));*@
            @*var oBODJ = @Html.Raw(Json.Encode(oBOD));*@
            var oCompDJ = @Html.Raw(Json.Encode(Model.oDefintion));
            var o1ClickDJ ={
                oOneClickParameters :@Html.Raw(Json.Encode(o1ClickD.oOneClickParameters.Where(x => x.iType == 10 || x.iType == 30 || x.iType == 40).ToList())),
                ResultListDisplayType :'@o1ClickD.ResultListDisplayType',
                ResultListDisplayType : '@o1ClickD.ResultListDisplayType',
                DisplayAs : '@o1ClickD.DisplayAs',
                Headings : @Html.Raw(Json.Encode(o1ClickD.Headings)),
                TableColumns : @Html.Raw(Json.Encode(o1ClickD.TableColumns)),
                IsRowClick : '@o1ClickD.IsRowClick',
                RowXiLinkID : '@o1ClickD.RowXiLinkID',
                RowXiLinkIDXIGUID : '@o1ClickD.RowXiLinkIDXIGUID',
                sBOName : '@o1ClickD.sBOName',
                BOID : '@o1ClickD.BOID',
                BOIDXIGUID: '@o1ClickD.BOIDXIGUID',
                bIsRecordLock : '@o1ClickD.bIsRecordLock',
                sRowXiLinkType : '@o1ClickD.sRowXiLinkType',
                oneClickID:'@o1ClickD.ID',
                iCatID:'@o1ClickD.CategoryID',
                oneClickGUID: '@o1ClickD.XIGUID',
                sTarget: '@o1ClickD.TargetPeriod',
                sIDRef:'@sRefenceID'
            }
            var oBODJ = {
                sPrimaryKey : '@oBOD.sPrimaryKey',
                LabelName : '@oBOD.LabelName',
                sAuditBOName : '@oBOD.sAuditBOName',
                BOID : '@oBOD.BOID',
                bGUID:'@oBOD.bUID'
            }
            if('@o1ClickD.IsRowClick'=="True" && '@o1ClickD.OnRowClickType'=="TD"){
                if(!Checked || Checked==false||ColIndex>0){
                    funDrillIn(this, o1ClickDJ, oBODJ, sGUID, '@sTabGUID');
                    fncTrigger1Click(this, o1ClickDJ, oBODJ, oCompDJ, sGUID, '@sTabGUID');
                }
            }
            else if('@o1ClickD.IsRowClick'=="True"){
                if('@o1ClickD.RowXiLinkID' > 0){
                    if(!Checked || Checked==false||ColIndex>0|| '@o1ClickD.sBOName' == 'XIDocumentTree'){
                        funDrillIn(this, o1ClickDJ, oBODJ, sGUID, '@sTabGUID');
                    }
                }
                else if('@o1ClickD.OnRowClickType' == "advc"){
                    fncAdvc1Click(this, o1ClickDJ, oBODJ, oCompDJ, sGUID, '@sTabGUID');
                }
                else{
                    if('@o1ClickD.bIsCheckbox'=="True"){

                    }
                    else
                    {
                        fncTrigger1Click(this, o1ClickDJ, oBODJ, oCompDJ, sGUID, '@sTabGUID');
                    }
                }
            }
        });
        var prepopups = new Array();
        $('#OneClickResult-@sTabGUID').on('click', 'th', function () {
            var ReportID=$(this).attr('id');
            var codes = "";
            if (ReportID > 0 ) {
                var url = '@Url.Action("InnerReportResult", "Inbox")?ReportID=' + ReportID + '&ParentID=' + 0 + '&IsParent=' + false + '&PageIndex=1' + '&ReportColumns=' + codes+"&BaseID="+0;
                if (prepopups.length > 0) {
                    for (j = 0; j < prepopups.length; j++) {
                        prepopups[j].close();
                    }
                }
                var preview = window.open(url, '_blank', "scrollbars=1,resizable=1,width=" + screen.width + ", height=" + screen.height);
                prepopups.push(preview);
            }
        });

        $('.DatePicker_Txt_10437').datepicker({
            changeMonth: true,
            changeYear: true,
            inline: true,
            yearRange: '1920:2030',
            dateFormat: 'dd-M-yy',
            @*minDate: new Date('@FieldOrigin.sMinDate'),
            maxDate: new Date('@FieldOrigin.sMaxDate'),*@
            //maxDate:'+1m +10d',
            //minDate: -10
        });

        $('.DatePicker_Txt_10529').datepicker({
            changeMonth: true,
            changeYear: true,
            inline: true,
            yearRange: '1920:2030',
            dateFormat: 'dd-M-yy',
            @*minDate: new Date('@FieldOrigin.sMinDate'),
            maxDate: new Date('@FieldOrigin.sMaxDate'),*@
            //maxDate:'+1m +10d',
            //minDate: -10
        });
        if('@o1ClickD.sBOName' !=null && '@o1ClickD.sBOName' == "Conviction_T"){
            $("#DDLShow-refConviction").change(function(){
                var sResult = 0;
                for (var k = 0; k < AutoCompleteDict.length; k++) {
                    if (AutoCompleteDict[k].key == 'refConviction_T') {
                        sResult = AutoCompleteDict[k].value;
                    }
                }
                var txtValue = $(this).val();
                $("#DDL-refConviction").val("");
                if(typeof txtValue !== 'undefined' && txtValue != ''){
                    var sValue = sResult[txtValue];
                    if(typeof sValue !== 'undefined' && sValue != ''){
                        $("#DDL-refConviction").val(sValue);
                    }
                    else
                    {
                        $(this).val('');
                    }
                }
            });
            $("#DDLShow-refConviction").autocomplete({
                source: function(request, response){
                    var DOptionsList = 0;
                    for (var k = 0; k < AutoCompleteDict.length; k++) {
                        if (AutoCompleteDict[k].key == 'refConviction_T') {
                            DOptionsList = AutoCompleteDict[k].value;
                        }
                    }
                    $("#DDL-refConviction").val("");
                    var List = [];
                    //for(var i = 0;i < DOptionsList.length; i++){
                    //    List.push({label:DOptionsList[i].Expression, value:DOptionsList[i].text});
                    //}
                    $.each(DOptionsList, function(key, value) {
                        List.push({label:key, value:value});
                    });
                    response($.ui.autocomplete.filter(List, request.term));
                },
                select: function( event, ui ) {
                    $("#DDLShow-refConviction").val(ui.item.label);
                    $("#DDL-refConviction").val(ui.item.value);
                    return false;
                }
            });
        }
    });
    var pageIndex = 1;
    var PageCount = 40;
    $(window).scroll(function () {
        if ($(window).scrollTop() == $(document).height() - $(window).height()) {
            SubmitClick = 0;
            GetRecords(Fields,Optrs,Values,Type,SearchText);
        }
    });
    function GetRecords(Fields,Optrs,Values,Type,SearchText) {
        if('@o1ClickD.ResultListDisplayType'==0){
            pageIndex++;
            var sTable = "";
            var QueryID='@o1ClickD.XIGUID';
            if(SubmitClick==1){
                pageIndex=1;
            }
            var QValues = {
                ReportID: QueryID,
                PageIndex: pageIndex,
                Fields:Fields,
                Optrs:Optrs,
                Values:Values,
                SearchType:Type,
                SearchText:SearchText,
                BO:'@sBOName'
            }
            $.ajax({
                url: '@Url.Action("RunUserQuery", "Inbox")',
                type: "POST",
                contentType: "application/json; charset=utf-8",
                datatype: "JSON",
                cache: false,
                async: false,
                //data: { PageIndex: pageIndex,QueryID:QueryID },
                data: JSON.stringify(QValues),
                success: function (data) {
                    for(i=0;i<data.length;i++)
                    {
                        sTable = sTable + "<tr role='row'>";
                        for(j=0;j<data[i].length;j++)
                        {
                            @*if('@o1ClickD.IDExists'=="True")
                            {
                                sTable = sTable +"<td>" + data[i][j]+ "</td>";
                            }
                            else
                            {
                                if(j==0)
                                {
                                    sTable = sTable +"<tdstyle='display:none'>" + data[i][j]+ "</td>";
                                }
                                else{
                                    sTable = sTable +"<td>" + data[i][j]+ "</td>";
                                }
                            }*@
                            sTable = sTable +"<td>" + data[i][j]+ "</td>";
                        }
                        sTable = sTable + "</tr>";
                    }
                    if(SubmitClick==1){
                        $("#OneClickResult-@sTabGUID tbody").html(sTable);
                    }
                    else{
                        $("#OneClickResult-@sTabGUID").append(sTable);
                    }
                    $("#OneClickResult-@sTabGUID").trigger("updateAll");
                }
            });
        }
    }

    function fncrefresh(oneClickID, TableColumns) {
        debugger
        GetDataTable(Fields, Optrs, Values, Type, NVPairs,oneClickID,TableColumns);
    }

    function fnc1clickcreate(ReportID, GroupID, BOID, CreateXILinkID, InstanceID, $this,sNewGuid,LayoutGuid,Operator){
        debugger
        var newpopups = new Array();
        var Operator=$($this).val();
        if ($this != "") {
            var bIsLoading = $($this).attr("data-IsLoading");
            if (bIsLoading != "" && bIsLoading != undefined && bIsLoading.toLowerCase() == "yes") {
                $($this).css("background-image", "url(" + sImagePath + "/loading.gif)").css("background-repeat", "no-repeat");
                $($this).val('Please wait');
            }
        }
        var sShowSections='@ShowSections';
        var InputParams = [];
        if(sShowSections && InstanceID &&InstanceID!=""&&InstanceID!="0")
        {
            var param1 = {};
            param1["sName"] = 'ShowSections';
            param1["sValue"] = sShowSections;
            InputParams.push(param1);
        }
        @*'@sIsFirstTime'!=null && '@sIsFirstTime' == 'yes'*@
        if (BOID == 506)
        {
            var Name = "Addon_" + InstanceID;
            var sBO ="ProductAddon_T"
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SetParams", "xilink")',
                data: JSON.stringify({ sID: InstanceID, sGUID: '@Model.sGUID', sName: Name, sBO: sBO }),
                contentType: 'application/json;',
                dataType: 'json',
                traditional: true,
                success: function () {
                    $("#Add_" + sBO + "_" + InstanceID).attr("disabled", "disabled");
                    $("#Remove_" + sBO + "_" + InstanceID).removeAttr("disabled");
                    //resolve(true);
                }
            });
        }
        if (InstanceID > 0) {
            var DriverSNo = $($this).attr('data-sNo');
            fncSetParam(DriverSNo, '@Model.sGUID', "{XIP|sDriverSNo}", "");
        }
        if(false){

        }
        else{
            var Params = {
                sBODID : BOID,
                iGroupID : GroupID,
                s1ClickID : ReportID,
                iRecordCount: iRecordCount,
                iInstanceID :InstanceID,
                sGUID: sNewGuid,
                sMode: '@o1ClickD.Code',
                sOperator:Operator,
                LayoutGuid:LayoutGuid
            }
            if('@o1ClickD.Code'=="Advc"){
                var url = '@Url.Action("GetQueryForm", "QueryGeneration")';
                if (newpopups.length > 0) {
                    for (i = 0; i < newpopups.length; i++) {
                        newpopups[i].close();
                    }
                }
                //var newquery = window.open(url, '_blank', 'fullscreen=yes,resizable=yes,scrollbars=yes,toolbar=yes,menubar=yes,location=yes,left=0,top=0');
                //var newquery = window.open(url, '_blank', "scrollbars=1,resizable=1,width=1400, height=700,left=0,top=0");
                var newquery = window.open(url, '_blank', "scrollbars=1,resizable=1,width=" + screen.width + ", height=" + screen.height);
                newpopups.push(newquery);
                newquery.moveTo(0, 0);
                popups.push(newquery);
            }
            else if (CreateXILinkID && CreateXILinkID.toString().length > 0 && CreateXILinkID != "0" && CreateXILinkID != "00000000-0000-0000-0000-000000000000") {
                if ('@o1ClickD.sRowXiLinkType' == "run" || ReportID == 0 || ReportID == 'bdf6e123-dca2-4800-9e98-83d2082c73ff') {
                //XIRun(CreateXILinkID, 0, null, null, true, 0, 0)
                var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
		   XIRun(null,CreateXILinkID, InstanceID, sGUID, null, false, BOID, 121, null, InputParams)
               }
                else {
                    var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
                    var param1 = {};
                    param1["sName"] = 'childaddpopup';
                    param1["sValue"] = 'yes';
                    InputParams.push(param1);
                    var param2 = {};
                    param2["sName"] = 'Parent1Click';
                    param2["sValue"] = ReportID;
                    InputParams.push(param2);
                   XILinkLoadJson(CreateXILinkID, sGUID, InputParams);
               }
                //XIRun(CreateXILinkID, InstanceID, '@o1ClickD.sGUID', null, false, BOID, 121,null,InputParams)
                @*var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);

                if('@o1ClickD.sRowXiLinkType' == "run"){
                    XIRun(CreateXILinkID, 0, null, null, true, 0, 0)
                }
                else{
                    XILinkLoadJson(CreateXILinkID, sGUID, InputParams);
                }*@
            }
            else{
                $.ajax({
                    url: '@Url.Action("OneClickInsert", "QueryGeneration")',
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    datatype: "html",
                    cache: false,
                    async: false,
                    data: JSON.stringify(Params),
                    success: function (BOForm) {
                        //$('#InlineTop-'+ReportID).empty();
                        var id=$($this).attr('id');
                        var sFormID = $(BOForm).find('form').attr('id');
                        if(sFormID)
                        {
                            var sAddformGUID=sFormID.split('_')[1];
                            $('#' + id).attr("id", "Add_" + sAddformGUID);
                            $($this).parent().find('#hiderefresh').attr("id", "hiderefresh_" + sNewGuid );
                            //$($this).parent().find('.close-btn-toggle').addClass("btn-active");
                            $($this).parent().find('.close-btn-toggle').show();
                            $($this).parent().parent().find('.inline-add-form').show();
                            $($this).hide();
                           // $('#hiderefresh').attr("id", "hiderefresh_" + '@o1ClickD.sGUID');
                             //$("#"+id).attr("disabled", true);
                           //$("#Add_" + @o1ClickD.BOID).attr("disabled", "disabled");
                        }
                        var sCreateType = '@o1ClickD.sCreateType';
                        if(Operator=='+' || Operator=="Edit")
                        {
                            sCreateType = "rowinlinetop";
                        }
                        else if(Operator=='-'){
                            sCreateType = "rowinlinebottom";
                        }
                        //else
                        //{
                        //    sCreateType="";
                        //}
                        if('@o1ClickD.DisplayAs' == 50 || '@o1ClickD.DisplayAs' == 120 || '@o1ClickD.DisplayAs' == 130||'@o1ClickD.DisplayAs' == 170){
                            if(sCreateType && sCreateType!=null && sCreateType.length > 0){
                                if(sCreateType.toLowerCase() == "rowinlinetop"){
                                    $(".simple1clickInline").remove();
                                    //var trClass = "simple1clickInline_" + sAddformGUID;
                                    var sContentHTML = '<tr class="simple1clickInline"><td colspan="20" class="simple1clickContent"><div class="simple1clickClose">&times;</div>' + BOForm + '</td></tr>';
                                    $('div[data-def="' + ReportID + '"]').find(".simpleclick_" + InstanceID).after(sContentHTML);
                                    $(".simple1clickClose").on('click',function(){
                                        $(".simple1clickInline").remove();
                                        $('body').find('.trActive').removeClass('trActive trActiveBefore');
                                        $('body').find('.simple1clickActive.btn-theme').removeClass('simple1clickActive');
                                    })
                                    //$('#InlineTop_'+sNewGuid).prepend(BOForm);
                                    //$("#1ClickResponse").height($('.ui-dialog').height() - $("#DynamicQueryForm").height() - 100);
                                }
                                else if(sCreateType.toLowerCase() == "rowinlinebottom"){
                                    $(".simple1clickInline").remove();
                                    var sContentHTML = '<tr class="simple1clickInline beforeTR"><td colspan="20" class="simple1clickContent"><div class="simple1clickClose">&times;</div>' + BOForm + '</td></tr>';
                                    $('div[data-def="' + ReportID + '"]').find(".simpleclick_" + InstanceID).before(sContentHTML);
                                    $(".simple1clickClose").on('click',function(){
                                        $(".simple1clickInline").remove();
                                        $('body').find('.trActive').removeClass('trActive trActiveBefore');
                                        $('body').find('.simple1clickActive.btn-theme').removeClass('simple1clickActive');
                                    })
                                    //$('#InlineBottom-'+ReportID).html(BOForm);
                                }
                                else if(sCreateType.toLowerCase() == "inlinetop"){
                                    $('#InlineTop_' + sNewGuid).find('.PopupTabContentArea').remove();
                                    $('#InlineTop_' + sNewGuid).prepend(BOForm);
                                }
                                else if(sCreateType.toLowerCase() == "inlinebottom"){
                                    $('#InlineBottom-' + sNewGuid).find('.PopupTabContentArea').remove();
                                    $('#InlineBottom-'+ ReportID).html(BOForm);
                                }
                                else if(sCreateType.toLowerCase() == "dialog"){
                                    $('#GridAddFormDlg-@ReportID').html(data);
                                    $("#GridAddFormDlg-@ReportID").dialog({
                                        width: 700,
                                        close: function (event, ui) {
                                            $('#GridAddFormDlg-@ReportID').dialog('close');
                                        }
                                    });
                                }
                                else if(sCreateType.toLowerCase() == "popup"){
                                    $('#GridAddFormDlg-@ReportID').html(BOForm);
                                    $("#GridAddFormDlg-@ReportID").dialog({
                                        width: 700,
                                        close: function (event, ui) {
                                            $('#GridAddFormDlg-@ReportID').dialog('close');
                                        }
                                    });
                                }
                            }
                            //    else
                            //    {
                            //        //$('#InlineBottom-'+ReportID).html(BOForm);
                            //        //$(".simple1clickInline").remove();
                            //        //var sContentHTML = '<div class="simple1clickInline"><div class="simple1clickContent"><div class="simple1clickClose">&times;</div>' + BOForm + '</div></div>';
                            //        ////$(".simpleclick_" + InstanceID).after(sContentHTML);
                            //        //$('#InlineTop_' + sNewGuid).after(sContentHTML);
                            //        //$(".simple1clickClose").on('click',function(){
                            //        //    $(".simple1clickInline").remove();
                            //        //    $('body').find('.trActive').removeClass('trActive');
                            //        //    $('body').find('.simple1clickActive.btn-theme').removeClass('simple1clickActive');
                            //        //})
                            //        $(".simple1clickInline").remove();
                            //        var sContentHTML = '<tr class="simple1clickInline beforeTR"><td colspan="20" class="simple1clickContent"><div class="simple1clickClose">&times;</div>' + BOForm + '</td></tr>';
                            // $('#InlineTop_' + sNewGuid).after(sContentHTML);
                            //        $(".simpleclick_" + InstanceID).after(sContentHTML);
                            //        $(".simple1clickClose").on('click',function(){
                            //            $(".simple1clickInline").remove();
                            //            $('body').find('.trActive').removeClass('trActive trActiveBefore');
                            //            $('body').find('.simple1clickActive.btn-theme').removeClass('simple1clickActive');
                            //        })
                            //    }
                        }
                        else{
                            iRecordCount++;
                            $('.gridtbody').append(BOForm);
                        }

                    },
                    error: function(err){
                    }

                });
            }
            $(".close-btn-toggle").click(function () {
                $($this).show();
                $($this).parent().parent().find('.inline-add-form').slideUp();
                $(this).hide();
            });
        }
    }
    function fnc1clickremove(ReportID, GroupID, BOID, InstanceID, $this) {
        if (BOID == 506)
        {
            var check = $($this).prop("checked");
            var Name = "Addon_" + InstanceID;
            var sBO = "ProductAddon_T";
            var ID = "";
            if (check == true)
            {
                ID = InstanceID;
            }
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SetParams", "xilink")',
                data: JSON.stringify({ sID: ID, sGUID: '@Model.sGUID', sName: Name, sBO: sBO }),
                contentType: 'application/json;',
                dataType: 'json',
                traditional: true,
                success: function () {
                    if (ID != "") {
                        $("#ADDon_" + InstanceID).addClass("addonboxchecked");
                    }
                    else {

                        $("#ADDon_" + InstanceID).removeClass("addonboxchecked");
                    }
                    //$("#Remove_" + sBO + "_" + InstanceID).attr("disabled", "disabled");
                    //$("#Add_" + sBO + "_" + InstanceID).removeAttr("disabled");
                    //resolve(true);
                }
            });
        }
    }
    function fncgetinstanceid($this) {

        return new Promise(function (resolve, reject) {
            var Headings =@Html.Raw(Json.Encode(o1ClickD.Headings));
            var RowData;
            if('@o1ClickD.ResultListDisplayType'==1)
            {
                var tr = $($this).closest('tr');
                var tddata = [];
                $(tr).children('td').each(function(ii, vv){
                    tddata[ii] = $(this).text();
                });
                RowData = tddata;
            }
            else{
                RowData = $(this).children("td").map(function() {
                    return $(this).text();
                }).get();
            }
            if(RowData){
                for (var i = 0; i < Headings.length; i++) {
                    if (Headings[i].toLowerCase() == "ID".toLowerCase()) {
                        id = RowData[i];
                        resolve(id);
                    }
                }
            }
        });

    }

    function fnc1ClickPCAction(_this, ProcessControllerIDs, sGUID, sID) {
        sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', _this);
        $("#BoActionDlg").html("The " + iCount + " policies you have selected will start the renewal process. Are you sure you wish to proceed?");
        $("#BoActionDlg").dialog({
            title: "Confirmation",
            autoOpen: true,
            modal: true,
            width: 400,
            left: '600px',
            top: '80px',
            buttons: [
                {
                    text: "Yes",
                    click: function () {
                        fncRunProcessController(_this, ProcessControllerIDs, sGUID, sID);
                        $('#BoActionDlg').dialog('close');
                        $('#BoActionDlg').dialog('destroy');
                    }
                },
                {
                    text: "No",
                    click: function () {

                        $('#BoActionDlg').dialog('close');
                        $('#BoActionDlg').dialog('destroy');
                        //fnc1clickcreate(ReportID, GroupID, BOID, CreateXILinkID);
                    }
                }
            ]
        });

    }
    function fncEditBO($this,ReportID, GroupID, BOID, CreateXILinkID){
        $($this).addClass('simple1clickActive').parent().parents('tr').siblings().find('.simple1clickActive').removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').siblings().removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').parent().parents('tr').addClass("trActive").siblings().removeClass('trActive');
        fncgetinstanceid($this).then(function (iInstanceID) {
            fnc1clickcreate(ReportID, GroupID, BOID, CreateXILinkID, iInstanceID,$this,'@sTabGUID');
        })
    }
    var InputParams = []; var JEID; var param1 = {}; var iCount = 0;
    var SelectedInputParams = [];
    function fncCheckboxOnchange($this, ReportID, GroupID, BOID, CreateXILinkID) {
        debugger
        if (ReportID.toLocaleLowerCase() =="28430213-C8A6-448F-92E1-64879E2ECC50".toLocaleLowerCase())
        {
            DeselectReconciliations($this, ReportID, GroupID, BOID, CreateXILinkID);
        }
        else
        {
            SelectReconciliations($this, ReportID, GroupID, BOID, CreateXILinkID);
        }
        var checkList=$('#CheckedList-@ReportID').val();
        fncSetParam(checkList, '@o1ClickD.sGUID', "{XIP|SelectedInstanceIDs}", "");
    }
    function fncCheckboxOnchangeAll($this, ReportID, GroupID, BOID, CreateXILinkID) {
        var sGuid = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
        var tableID= $($this).closest('table').attr('id');
        $('#'+tableID+' tbody>tr').each(function () {
            SelectALLReconciliations($this, this, ReportID, GroupID, BOID, CreateXILinkID, sGuid);
        })
        var checkList=$('#CheckedList-@ReportID').val();
        fncSetParam(checkList, '@o1ClickD.sGUID', "{XIP|SelectedInstanceIDs}", "");
    }
    function SelectALLReconciliations(thead, $this, ReportID, GroupID, BOID, CreateXILinkID, sGuid)
    {
        var Headings =[];
        if($("#Heading_"+ReportID).val()!=null)
        {
            Headings= $("#Heading_"+ReportID).val().split(" ,");
        }
        var rt = $(thead).prop("checked");
        var tr = $($this).closest('tr');
        if(rt==true){
            $(tr).addClass("trhighlighter").removeClass('chkReconcilliation');
            $(tr).find("input").prop('checked',true).removeClass('chkReconcilliation');
            //$('td input:checkbox',tr).prop('checked',true);
        }
        else{
            $(tr).removeClass("trhighlighter");
            $('td input:checkbox',tr).prop('checked',false);
        }
        var RowData = [];
        $(tr).children('td').each(function (ii, vv) {
            RowData[ii] = $(this).text();
        });
        if(RowData){
            var rCr=0;
            var rDr=0;
            for (var i = 0; i < Headings.length; i++) {
                if (Headings[i].toLowerCase() == "Journal ID".toLowerCase()) {
                    JEID=RowData[i];
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_FKiACJEID";
                    param1["sValue"] = RowData[i];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "ID".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_FKiACTransactionID";
                    param1["sValue"] = RowData[i];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                        SelectedInputParams.push(RowData[i]);
                        var checkList=$('#CheckedList-@ReportID').val();
                        if (checkList == '') {
                            $('#CheckedList-@ReportID').val(RowData[i]);
                            iCount=iCount+1;
                        }
                        else {
                            checkList = checkList + "," + RowData[i];
                            $('#CheckedList-@ReportID').val(checkList);
                            iCount=iCount+1;
                        }
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                        var checkList=$('#CheckedList-@ReportID').val();
                        if (checkList == '') {
                            //$('#CheckedList-'+@ReportID).val(RowData[i])
                        }
                        else {
                            var CheckedList = $('#CheckedList-@ReportID').val().split(",");
                            CheckedList = CheckedList.filter(e => e !== RowData[i]);
                            Docs = CheckedList.join(',');
                            checkList = checkList + "," + RowData[i];
                            $('#CheckedList-@ReportID').val(checkList);
                            iCount=iCount-1;
                        }
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Insurer".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_FKiSupplierID";
                    param1["sValue"] = RowData[i].split(" ")[0];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Type".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_iDRCRType";
                    param1["sValue"] = RowData[i].toLowerCase()=='dr'?"10":"20";
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Dr".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_rDR";
                    param1["sValue"] = Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);;
                    rDr= Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Cr".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_rCR";
                    param1["sValue"] = Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);
                    param1["bDirty"] =true;
                    rCr= Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }

                if (Headings[i].toLowerCase() == "Account Category".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" + JEID +"_refAccountCategory";
                    param1["sValue"] = RowData[i].split(" ")[0];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Balance".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_"+Headings[i];
                    param1["sValue"] = RowData[i].split(" ")[0];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
            } //end for for loop
            var ReconcilliationID="";
            var sParameter = "{XIP|ACReconcilliation_T.id}";
            var sGUID = fncGetGUIDFromHTMLTree("LayoutGUID", $this);
            if (sParameter.length > 0 && sGUID != 0) {
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetCacheParameterValue", "XiLink")',
                    data: { sParamName: sParameter, sGUID: sGUID },
                    cache: false,
                    async: false,
                    dataType: 'json',
                    success: function (result) {
                        if (result != "No Value") {
                            ReconcilliationID=result["{XIP|ACReconcilliation_T.id}"];
                        }
                        else {
                            $('.ParameterValueView').html('Parameter Not Found');
                        }
                    }
                });
            }
            param1 = {};
            param1["sName"] = "tr" +JEID+"_FKiACReconcilliationID";
            param1["sValue"] = ReconcilliationID;
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                });
            }
            param1 = {};
            param1["sName"] = "tr" +JEID+"_iType";
            param1["sValue"] = '0';
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                });
            }
            param1 = {};
            param1["sName"] = "tr" +JEID+"_FKiEnterpriseID";
            param1["sValue"] = '2';
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                })
            }
            //if (Headings[i].toLowerCase() == "rReconciled".toLowerCase()) {
            param1 = {};
            param1["sName"] = "tr" +JEID+"_rAmountReconciled";

            if(rCr!=0)
            {
                param1["sValue"] = rCr;
            }
            else{
                param1["sValue"] = "-"+rDr
            }
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                });
            }
            //}

        }
    }
    function DeselectReconciliations($this, ReportID, GroupID, BOID, CreateXILinkID)
    {
        debugger
        var Headings =[];
        if($("#Heading_"+ReportID).val()!=null)
        {
            Headings= $("#Heading_"+ReportID).val().split(" ,");
        }
        var rt = $($this).prop("checked");
        var tr = $($this).closest('tr');
        if(rt==true){
            $(tr).addClass("trhighlighter");
        }
        else{
            $(tr).removeClass("trhighlighter");
        }
        var RowData = [];
        $(tr).children('td').each(function (ii, vv) {
            RowData[ii] = $(this).text();
        });
        if(RowData){
            for (var i = 0; i < Headings.length; i++) {
                if (Headings[i].toLowerCase() == "ID".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr_ID";
                    param1["sValue"] = RowData[i];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
            } //end for for loop
            param1 = {};
            param1["sName"] = "tr_XIDeleted";
            param1["sValue"] = "1";
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                });
            }
        }
    }
    function fncSelectOrDeselectALLCheckbox(thead, $this, ReportID) {
        var Headings = [];
        if ($("#Heading_" + ReportID).val() != null) {
            Headings = $("#Heading_" + ReportID).val().split(" ,");
        }
        var rt = $(thead).prop("checked");
        var tr = $($this).closest('tr');
        if (rt == true) {
            $(tr).addClass("trhighlighter").removeClass('chkReconcilliation');
            $(tr).find("input").prop('checked', true).removeClass('chkReconcilliation');
            //$('td input:checkbox',tr).prop('checked',true);
        }
        else {
            $(tr).removeClass("trhighlighter");
            $('td input:checkbox', tr).prop('checked', false);
        }
        var RowData = [];
        $(tr).children('td').each(function (ii, vv) {
            RowData[ii] = $(this).text();
        });
        if (RowData) {
            var rCr = 0;
            var rDr = 0;

            for (var i = 0; i < Headings.length; i++) {
                if (Headings[i].toLowerCase() == "ID".toLowerCase()) {

                    if (rt == true) {
                        InputParams.push(RowData[i]);
                    } else {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element != RowData[i];
                        });
                    }
                }
            }
            var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
            fncSetParam(InputParams.join(','), sGUID, "{XIP|SelectedInstanceIDs}", "");
        }
    }
    function fncSelectOrDeselectCheckbox($this, ReportID, GroupID, BOID, CreateXILinkID) {
        var Headings = [];
        if ($("#Heading_" + ReportID).val() != null) {
            Headings = $("#Heading_" + ReportID).val().split(" ,");
        }
        var rt = $($this).prop("checked");
        var tr = $($this).closest('tr');
        if (rt == true) {
            $(tr).addClass("trhighlighter");
        }
        else {
            $(tr).removeClass("trhighlighter");
        }
        var RowData = [];
        $(tr).children('td').each(function (ii, vv) {
            RowData[ii] = $(this).text();
        });
        if (RowData) {
            for (var i = 0; i < Headings.length; i++) {
                if (Headings[i].toLowerCase() == "ID".toLowerCase()) {
                    if (rt == true) {
                        InputParams.push(RowData[i]);
                        SelectedInputParams.push(RowData[i]);
                    }
                    else {
                        InputParams = $.grep(InputParams, function (element, index) {
                            if (index > -1) {
                                var CheckedList = $('#CheckedList-@ReportID').val();
                                if (CheckedList != "") {
                                     CheckedList = $('#CheckedList-@ReportID').val().split(",");
                                    CheckedList = CheckedList.filter(e => e !== RowData[i]);
                                    $('#CheckedList-d4797c26-b2be-4c8b-9671-50cbb8bf569f').val(CheckedList.join(','));
                                    iCount = CheckedList.length;
                                    return element != RowData[i];
                                }
                            }
                        });
                        SelectedInputParams = $.grep(SelectedInputParams, function (element, index) {
                            if (index > -1) {
                                return element != RowData[i];
                            }
                        });
                    }
                }
            }
        }
        if (@CheckboxonChangefnName != null && @CheckboxonChangefnName != "") {
            eval("@CheckboxonChangefnName" + "($this)");
        }
        else {
            var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
            fncSetParam(InputParams.join(','), sGUID, "{XIP|SelectedInstanceIDs}", "");
        }

    }
    function AttachRenewalDoc($this) {
        var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
        var SelectedDocIds = InputParams.join(',');
        $('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val(SelectedDocIds);
        var checkList = $('#CheckedList-@ReportID').val();
        if (checkList == "" && SelectedDocIds != null) {
            checkList = SelectedDocIds;
            iCount = checkList.split(',').length;
        }
        fncSetParam(checkList, '@o1ClickD.sGUID', "{XIP|SelectedInstanceIDs}", "");
    }
    function SelectReconciliations($this, ReportID, GroupID, BOID, CreateXILinkID)
    {
        debugger
        var Headings =[];
        if($("#Heading_"+ReportID).val()!=null)
        {
            Headings= $("#Heading_"+ReportID).val().split(" ,");
        }
        var rt = $($this).prop("checked");
        var tr = $($this).closest('tr');
        if(rt==true){
            $(tr).addClass("trhighlighter");
        }
        else{
            $(tr).removeClass("trhighlighter");
        }
        var RowData = [];
        $(tr).children('td').each(function (ii, vv) {
            RowData[ii] = $(this).text();
        });
        if(RowData){
            var rCR=0;
            var rDR=0;
            for (var i = 0; i < Headings.length; i++) {
                if (Headings[i].toLowerCase() == "Journal ID".toLowerCase()) {
                    JEID=RowData[i];
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_FKiACJEID";
                    param1["sValue"] = RowData[i];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "ID".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_FKiACTransactionID";
                    param1["sValue"] = RowData[i];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                        var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
                        var Docs = $('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val();
                        var checkList=$('#CheckedList-@ReportID').val();
                        if (Docs == '') {
                            $('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val(RowData[i])
                        }
                        else {
                            Docs = Docs + "," + RowData[i];
                            $('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val(Docs)
                        }
                        if (checkList == '') {
                            $('#CheckedList-@ReportID').val(RowData[i]);
                            iCount=iCount+1;
                        }
                        else {
                            checkList = checkList + "," + RowData[i];
                            $('#CheckedList-@ReportID').val(checkList);
                            iCount=iCount+1;
                        }
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                        var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
                        var Docs = $('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val();
                        var checkList=$('#CheckedList-@ReportID').val();
                        if (Docs == '') {
                            //$('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val(RowData[i])
                        }
                        else {
                            var docList = $('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val().split(",");
                            docList = docList.filter(e => e !== RowData[i]);
                            Docs = docList.join(',');
                            $('.LayoutCode_' + sGUID).find("input[name=FKizXDoc]").val(Docs)
                        }
                        if (checkList == '') {
                            //$('#CheckedList-'+@ReportID).val(RowData[i])
                        }
                        else {
                            var CheckedList = $('#CheckedList-@ReportID').val().split(",");
                            CheckedList = CheckedList.filter(e => e !== RowData[i]);
                            Docs = CheckedList.join(',');
                            checkList = checkList + "," + RowData[i];
                            $('#CheckedList-@ReportID').val(checkList);
                            iCount=iCount-1;
                        }
                    }
                }
                if (Headings[i].toLowerCase() == "Insurer".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_FKiSupplierID";
                    param1["sValue"] = RowData[i].split(" ")[0];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Type".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_iDRCRType";
                    param1["sValue"] = RowData[i].toLowerCase()=='dr'?"10":"20";
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Dr".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" + JEID +"_rDR";
                    param1["sValue"] = Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);;
                    rDR= Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Cr".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" + JEID +"_rCR";
                    param1["sValue"] = Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);
                    param1["bDirty"] =true;
                    rCR= Number(RowData[i].replace(/[^0-9.-]+/g,""));//RowData[i].substr(RowData[i].indexOf("£")+1);
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }

                if (Headings[i].toLowerCase() == "Account Category".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" + JEID +"_refAccountCategory";
                    param1["sValue"] = RowData[i].split(" ")[0];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
                if (Headings[i].toLowerCase() == "Balance".toLowerCase()) {
                    param1 = {};
                    param1["sName"] = "tr" +JEID+"_"+Headings[i];
                    param1["sValue"] = RowData[i].split(" ")[0];
                    param1["bDirty"] =true;
                    if(rt==true){
                        InputParams.push(param1);
                    }else
                    {
                        InputParams = $.grep(InputParams, function (element, index) {
                            return element.sName != param1["sName"];
                        });
                    }
                }
            } //end for for loop
            var ReconcilliationID="";
            var sParameter = "{XIP|ACReconcilliation_T.id}";
            var sGUID = fncGetGUIDFromHTMLTree("LayoutGUID", $this);
            if (sParameter.length > 0 && sGUID != 0) {
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetCacheParameterValue", "XiLink")',
                    data: { sParamName: sParameter, sGUID: sGUID },
                    cache: false,
                    async: false,
                    dataType: 'json',
                    success: function (result) {
                        if (result != "No Value") {
                            ReconcilliationID=result["{XIP|ACReconcilliation_T.id}"];
                        }
                        else {
                            $('.ParameterValueView').html('Parameter Not Found');
                        }
                    }
                });
            }
            param1 = {};
            param1["sName"] = "tr" +JEID+"_FKiACReconcilliationID";
            param1["sValue"] = ReconcilliationID;
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                });
            }
            param1 = {};
            param1["sName"] = "tr" +JEID+"_iType";
            param1["sValue"] = '0';
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                });
            }
            param1 = {};
            param1["sName"] = "tr" +JEID+"_FKiEnterpriseID";
            param1["sValue"] = '2';
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                })
            }
            //if (Headings[i].toLowerCase() == "rReconciled".toLowerCase()) {
            param1 = {};
            param1["sName"] = "tr" +JEID+"_rAmountReconciled";

            if(rCR!=0)
            {
                param1["sValue"] = rCR;
            }
            else{
                param1["sValue"] = "-"+rDR
            }
            param1["bDirty"] =true;
            if(rt==true){
                InputParams.push(param1);
            }else
            {
                InputParams = $.grep(InputParams, function (element, index) {
                    return element.sName != param1["sName"];
                });
            }
            //}

        }
    }
    function fncViewBO(_this, ReportID, GroupID, BOID, CreateXILinkID) {

        if (CreateXILinkID && CreateXILinkID.toString().length > 0)
        {
            var InputParams = [];
            var iInstanceID = $(_this).closest('tr')[0].id.split('_')[1];
           /* fncgetinstanceid(_this).then(function (iInstanceID) {*/
                var param1 = {};
                param1["sName"] = '{XIP|ActiveBO}';
                param1["sValue"] = '@sBOName';
                InputParams.push(param1);
                var param2 = {};
                param2["sName"] = 'iBOIID';
                param2["sValue"] = iInstanceID;
                InputParams.push(param2);
                var param3 = {};
                param3["sName"] = '{-iInstanceID}';
                param3["sValue"] = iInstanceID;
                InputParams.push(param3);
                var param4 = {};
                param4["sName"] = '{XIP|'+'@sBOName'+'.id}';
                param4["sValue"] = iInstanceID;
                InputParams.push(param4);
                var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', _this);
                XILinkLoadJson(CreateXILinkID, sGUID, InputParams);
                @*XIRun(CreateXILinkID, parseInt(iInstanceID), sGUID, '@sBOName', false,parseInt('@o1ClickD.BOID'),0);*@
            /*})*/
        }
    }

    function fncOpenCodeEditorWindow(_this, ReportID, GroupID, BOID, CreateXILinkID) {
        debugger
        var iInstanceID = $(_this).closest('tr').find('.one-1q-field-id').text();
        //var dialClose = '<button type="button" class="ui-dialog-titlebar-close"></button>'
        var windowclose = '<i class="windowClose fa fa-times" id="modalClose"></i>';
        //$('#CodeEditorDiv').html('<iframe src="https://platformfactory.in/Blockchain/XIComponents/CodeEditor?Id=' + iInstanceID + '" title="description" width="100%" height="100%"></iframe>');
        $('#CodeEditorDiv').html('<iframe src="http://localhost:53996/XIComponents/CodeEditor?Id=' + iInstanceID + '" title="description" width="100%" height="100%"></iframe>');
        $('#CodeEditorDiv').dialog({
            title: 'Search Result',
            //modal: true,
            //height: 500,
            //width: 1000,
            height: $(window).height(),
            width: $(window).width(),
            resizable: true,
            IsCloseIcon: true,
            position: { my: 'center center', at: 'left top' },
            open: function () {
                $(this).parent().promise().done(function () {
                    $(this).children('.ui-dialog-titlebar').append('<div class="dialogIcons">' + windowclose + '</div>');
                })
            },close: function (event, ui) {
                //$('#Dialogs').parent().hide();
                $("#CodeEditorDiv").dialog('close');
                //$("#CodeEditorDiv").dialog('destroy').remove();
            }
        });
        //window.open('/Blockchain/XIComponents/CodeEditor?Id=' + iInstanceID, '_blank');
        $("#modalClose").click(function(){
            $("#CodeEditorDiv").dialog('close');
            $("#modalClose").remove();
            //$("#CodeEditorDiv").dialog('destroy').remove();
        });
    }

    function fncDeleteBO($this, ReportID, GroupID, BOID, CreateXILinkID){
        fncgetinstanceid($this).then(function (iInstanceID) {
            //DeleteBO

            var pvalue = {
                iInstanceID: iInstanceID,
                sGUID: sGUID,
                sBOName: '@sBOName',
                sBOID: BOID
            }
            $($this).closest('tr').remove();
            $.ajax({
                url: DeleteBOURL,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                cache: false,
                data: JSON.stringify(pvalue),
                success: function (data) {

                },
                error:function(data){

                }
            })
        })
    }
    function fncAddInstanceBottom($this, ReportID, GroupID, BOID, CreateXILinkID){
        // $('.lbluebtn')hasClass( "selected" ).removeClass( "blue under" )
        $($this).addClass('simple1clickActive').parent().parents('tr').siblings().find('.simple1clickActive').removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').siblings().removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').parent().parents('tr').addClass("trActive trActiveBefore").siblings().removeClass('trActive trActiveBefore');
        fncgetinstanceid($this).then(function (iInstanceID) {
            fnc1clickcreate(ReportID, GroupID, BOID, CreateXILinkID, iInstanceID,$this,'@sTabGUID');
        })
    }
    function fncAddInstanceTop($this, ReportID, GroupID, BOID, CreateXILinkID){
        $($this).addClass('simple1clickActive').parent().parents('tr').siblings().find('.simple1clickActive').removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').siblings().removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').parent().parents('tr').removeClass('trActiveBefore');
        $($this).addClass('simple1clickActive').parent().parents('tr').addClass("trActive").siblings().removeClass('trActive trActiveBefore');
        fncgetinstanceid($this).then(function (iInstanceID) {
            fnc1clickcreate(ReportID, GroupID, BOID, CreateXILinkID, iInstanceID,$this,'@sTabGUID');
        })
    }
    function fncOrderIncrement($this, ReportID, GroupID, sBOName, CreateXILinkID, sTableColumns){
        $($this).addClass('simple1clickActive').parent().parents('tr').siblings().find('.simple1clickActive').removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').siblings().removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').parent().parents('tr').addClass("trActive").siblings().removeClass('trActive trActiveBefore');
        var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
        fncgetinstanceid($this).then(function (iInstanceID) {
            fncChangeOrder($this,ReportID,iInstanceID, sBOName, "increment", sTableColumns);
        })
    }
    function fncOrderDecrement($this, ReportID, GroupID, sBOName, CreateXILinkID, sTableColumns){
        $($this).addClass('simple1clickActive').parent().parents('tr').siblings().find('.simple1clickActive').removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').siblings().removeClass('simple1clickActive');
        $($this).addClass('simple1clickActive').parent().parents('tr').addClass("trActive").siblings().removeClass('trActive trActiveBefore');
        var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
        fncgetinstanceid($this).then(function (iInstanceID) {
            fncChangeOrder($this,ReportID,iInstanceID, sBOName, "decrement", sTableColumns);
        })
    }
    function fncChangeOrder($this,ReportID,iInstanceID, sBOName, Value, sTableColumns){
        var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
        var sTabGUID=$($this).closest('table').attr('id').substring('OneClickResult-'.length);
        $.ajax({
            type: 'Get',
            url: '@Url.Action("ChangeOrder", "XIComponents")',
            data: { iInstanceID: iInstanceID,sBOName:sBOName,Value:Value},
            cache: false,
            dataType: 'json',
            success: function (Res) {
                sTableColumns=sTableColumns+", Actions"
                fncTriggerRefresh(ReportID, sTableColumns, sGUID, sTabGUID, 50);
            },
            error:function(Res){
            }
        })
    }
    function fncCopyBO($this, ReportID, GroupID, BOID, CreateXILinkID){
        var InputParams = [];
        fncgetinstanceid($this).then(function (iInstanceID) {
            var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
            $.ajax({
                type: 'POST',
                url: '@Url.Action("CopyFor1Click", "XiLink")',
                data: { iInstanceID: iInstanceID,BOID:BOID},
                cache: false,
                dataType: 'html',
                success: function (data) {
                    $('LayoutGUID').dialog("refresh");
                },
                error:function(data){
                }
            })
        })
    }

    function fncGridViewBO($this, ReportID, GroupID, BOID, CreateXILinkID, sBOName) {
        if (CreateXILinkID && CreateXILinkID.toString().length > 0)
        {

            var InputParams = [];
            var tr = $($this).closest('tr');
            //var RowData = $(tr).children("td").map(function() {
            //    return $(this).text();
            //}).get();
            var sInstanceID=  $(tr).attr('id');var iInstanceID="";
            if(sInstanceID)
            {
                iInstanceID=sInstanceID.split('_')[1];
            }
            var param1 = {};
            param1["sName"] = '{XIP|ActiveBO}';
            param1["sValue"] = sBOName;
            InputParams.push(param1);
            var param2 = {};
            param2["sName"] = 'iBOIID';
            param2["sValue"] = iInstanceID;
            InputParams.push(param2);
            var param3 = {};
            param3["sName"] = '{-iInstanceID}';
            param3["sValue"] = iInstanceID;
            InputParams.push(param3);
            var param4 = {};
            param4["sName"] = '{XIP|'+sBOName+'.id}';
            param4["sValue"] = iInstanceID;
            InputParams.push(param4);
            var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', $this);
            XILinkLoadJson(CreateXILinkID, sGUID, InputParams);
            @*XIRun(CreateXILinkID, parseInt(iInstanceID), sGUID, '@sBOName', false,parseInt('@o1ClickD.BOID'),0);*@
        }
    }
    function oneClickSearch(_this, id, sTabCols, sTabGUID, sSearchFields, sType, sSrchType, sSearchType) {
        $(".oneclickres").show();
        SubmitClick = 1;
        pageIndex = 1;
        Fields = "";
        Optrs = "";
        Values = "";
        DValue ="";
        var j= 0;
        var SrchFlds = sSearchFields;
        if(SrchFlds && SrchFlds!=null){
            j = SrchFlds.split(", ").length;
        }
        for(i=0;i<j;i++){
            var form = $(_this).parent().parent().parent().parent();
            //var Value = $(form).find('#'+i+'-Value').val();
            var Value = $(form).find('#'+sTabGUID+'-'+i+'-Value').attr('data-value');
            var Optr = $(form).find('#' + sTabGUID + '-' + i + '-Operator').val();
            if(typeof Value === 'undefined' && Value != 0)
            {
                Value = $(form).find('#'+sTabGUID+'-'+i+'-Value').val();
            }
            var ddltext = $(form).find('#'+sTabGUID+'-'+i+'-Value :selected').text();
            if(Value != -1){
                var FieldType =$(form).find('#'+sTabGUID+'-'+i+'-FieldName').attr('data-typeid');
                if(FieldType==150){

                    var FieldDateType =$(form).find('#'+sTabGUID+'-'+i+'-FieldName').attr('data-datetype');
                    if(FieldDateType==20){
                        var date1 = $('.'+sTabGUID+'-'+i+'-datefield1').val();
                        if (date1 != "" && date1 != null ) {
                            var date2 = date1.split('/');
                            var obj1 = new Date(date2[2], date2[1] - 1, date2[0]);
                            var month1 = date1[1];
                            month1 = obj1.toLocaleString('default', { month: 'short' });
                            var fullDate = date2[0] + "-" + month1 + "-" + date2[2];
                            date1 = "";
                            if (fullDate != null && fullDate != "") {
                                Value = fullDate;
                            }
                        }
                    }
                    else if(FieldDateType==30){
                        var day = $('#'+sTabGUID+'-'+i+'-day').val();
                        var month = $('#'+sTabGUID+'-'+i+'-month').val();
                        var year = $('#'+sTabGUID+'-'+i+'-year').val();
                        //Call the function to validate date
                        fncCheckValidDate(day, month, year);
                        function fncCheckValidDate(day, month, year) {
                            //create object
                            var obj = new Date(year, month - 1, day);
                            var msg = obj && (obj.getMonth() + 1) == month
                            //if validation is successfull then in returns boolean value
                            if (msg == true) {
                                // change month number to month name
                                month = obj.toLocaleString('default', { month: 'short' });
                                var Fulldate = day + '-' + month + '-' + year;
                            }
                            if (Fulldate != null && Fulldate != "")
                            {
                                Value = Fulldate;
                            }
                        }
                    }
                }
                else if (FieldType == "20") {

                }
                if(ddltext.length > 0 && ddltext.toLowerCase() == "please select"){

                }
                else if ((Value && Value != "" && Value.length > 0) || (Optr == 'is not null' || Optr == 'is null')){
                    var Field =$(form).find('#'+sTabGUID+'-'+i+'-FieldName').val();
                    //var Optr = "";
                    if(sSearchType == "EqualOperator")
                    {
                        Optr = "=";
                    }
                    else
                    {
                        Optr = $(form).find('#'+sTabGUID+'-'+i+'-Operator').val();
                    }
                    //var Optr = $(form).find('#'+sTabGUID+'-'+i+'-Operator').val();
                    var DValue = $(form).find('#'+sTabGUID+'-'+i+'-Value2').val();
                    if(Optr=="between"){
                        Values = Values + Value+"_"+DValue+",";
                    }
                    else{
                        Values = Values + Value+",";
                    }
                    Fields = Fields + Field+",";
                    Optrs = Optrs + Optr+",";
                }
            }
        }
        Fields = Fields.substring(0, Fields.length-1);
        Optrs = Optrs.substring(0, Optrs.length-1);
        Values = Values.substring(0, Values.length-1);
        Type = sSearchType;
        if ('@o1ClickD.ResultListDisplayType' == 0){
            GetRecords(Fields,Optrs,Values,sSearchType);
        }
        else{
            var iPageLength = 0;
            if('@o1ClickD.iPaginationCount' == 0)
            {
                iPageLength = 100;
            }
            else
            {
                iPageLength = '@o1ClickD.iPaginationCount';
            }
            @*var SortColumns =  @Html.Raw(Json.Encode(o1ClickD.TableColumns));*@
            var SortColumns = sTabCols.split(',');
            var expColumns = new Array();
            for (var i = 0; i < SortColumns.length; i++) {
                var obj = new Object();
                obj.sName = SortColumns[i];
                if (SortColumns[i] == "Select") {
                    obj.bSortable = false;
                }
                else {
                    obj.bSortable = true;
                }
                if (SortColumns[i].toLowerCase() == "hiddendata" || SortColumns[i].toLowerCase() == "color"){
                    obj.visible = false;
                }
                expColumns.push(obj);
            }
            var sGUID = fncGetGUIDFromHTMLTree('LayoutGUID', _this);
            if(sType == "Grid")
            {
                $.ajax({
                    url: '@Url.Action("GetGridClickResult", "XiLink")',
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    async: true,
                    cache: false,
                    data: JSON.stringify({i1ClickID:id,sGUID:sGUID,Fields:Fields, Optrs:Optrs,Values:Values,SearchType:Type}),
                    success: function (data) {
                        $('.OneClickResDiv').html(data);
                    },
                    error:function(data){
                        $('.OneClickResDiv').html("Error Occured");
                    }
                })
                //fncGetGridDTable(OneClickGridURL, id, sGUID,Fields,Optrs,Values);
            }
            else
            {
                fncGetDTable(OneClickURL, id, expColumns, sGUID,'@o1ClickD.SearchText',iPageLength, sTabGUID, sSrchType,'@o1ClickD.sParentWhere',null,'@o1ClickD.iDefaultSortColumn','@o1ClickD.sDefaultSortDirection');
            }
        }
    }

    function oneClickReset(_this, id, sTabCols, sTabGUID, sType) {
        var userid = '@iUserID';
        var form = $(_this).parent().parent().parent().parent();
        $(form).find('input[type="text"]').val('');
        $(form).find('input[type="number"]').val('');
        $(form).find('input[data-inputtype="mask"]').val('');
        //$(form).find('select').val('=');
        //$(form).find('select').val('-1');
        $(form).find('.oprator').each(function (i, val) {
            $(this).prop("selectedIndex", 0);
        });
        $(form).find('.optionvalue').each(function (i, val) {
            $(this).prop("selectedIndex", 0);
            var DependentID = $(this).context.getAttributeNode('data-DependentID')
            if (DependentID != undefined) {
                $(this).trigger("change");
            }
        });
        $(form).find('select').find('option:first-child').prop('selected', true).end().trigger('chosen:updated');
        $(form).find('.autocomplete').each(function (i, val) {
            $(this).attr("data-value", -1);
        });
        $(form).find('.dBtnDatesRes').each(function() {
            var elemID = $(this).prop("lastElementChild");
            var dHideBet = elemID.id.valueOf("id");
            $('#'+dHideBet).hide();
        });
        //$('.'+sTabGUID+ "-"+'BetweenDate').hide();
        if ('@o1ClickD.ResultListDisplayType' == 0){
            SubmitClick = 1;
            Fields = "";
            Optrs = "";
            Values = "";
            GetRecords("","","",Type);
        }
        else{
            var SortColumns = sTabCols.split(',');
            @*var SortColumns =  @Html.Raw(Json.Encode(o1ClickD.TableColumns));*@
            var expColumns = new Array();
            for (var i = 0; i < SortColumns.length; i++) {
                var obj = new Object();
                obj.sName = SortColumns[i];
                if (SortColumns[i] == "Select") {
                    obj.bSortable = false;
                }
                else {
                    obj.bSortable = true;
                }
                if (SortColumns[i].toLowerCase() == "hiddendata" || SortColumns[i].toLowerCase() == "color"){
                    obj.visible = false;
                }
                expColumns.push(obj);
            }
            Fields = "";
            Optrs = "";
            Values = "";
            var iPageLength = 0;
            if('@o1ClickD.iPaginationCount' == 0)
            {
                iPageLength = 100;
            }
            else
            {
                iPageLength = '@o1ClickD.iPaginationCount';
            }
            if(sType == "Grid")
            {
                $.ajax({
                    url: '@Url.Action("GetGridClickResult", "XiLink")',
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    datatype: "json",
                    async: true,
                    cache: false,
                    data: JSON.stringify({i1ClickID:id,sGUID:sGUID,Fields:Fields, Optrs:Optrs,Values:Values,SearchType:Type}),
                    success: function (data) {
                        $('.OneClickResDiv').html(data);
                    },
                    error:function(data){
                        $('.OneClickResDiv').html("Error Occured");
                    }
                })
                @*fncGetDTable(OneClickURL, id, expColumns, '@o1ClickD.sGUID', '@o1ClickD.SearchText', iPageLength,sTabGUID,Fields,Optrs,Values);*@
            }
            else
            {
                fncGetDTable(OneClickURL, id, expColumns, '@o1ClickD.sGUID', '@o1ClickD.SearchText', iPageLength, sTabGUID, '@o1ClickD.SearchType', '@o1ClickD.sParentWhere', '', '@o1ClickD.iDefaultSortColumn', '@o1ClickD.sDefaultSortDirection');
            }
            @*fncGetDTable(OneClickURL, '@o1ClickD.ID', null, '@o1ClickD.sGUID', '@o1ClickD.SearchText',Fields,Optrs,Values);*@
        }
         if (userid !== "5057") {
            $('[name=FKiUserID1]').val('@iUserID');
        }
    }


    function fncTriggerRefresh(i1ClickID, sTabCols, sGUID, sTabGUID, iPageCount) {

        var SortColumns = sTabCols.split(',');
        var expColumns = new Array();
        for (var i = 0; i < SortColumns.length; i++) {
            var obj = new Object();
            obj.sName = SortColumns[i];
            if (SortColumns[i] == "Select") {
                obj.bSortable = false;
            }
            else {
                obj.bSortable = true;
            }
            if (SortColumns[i].toLowerCase() == "hiddendata" || SortColumns[i].toLowerCase() == "color"){
                obj.visible = false;
            }
            expColumns.push(obj);
        }
        var iPageLength = 0;
        if(iPageCount == 0)
        {
            iPageLength = 100;
        }
        else
        {
            iPageLength = iPageCount;
        }
        fncGetDTable(OneClickURL, i1ClickID, expColumns, sGUID, '', iPageLength, sTabGUID, '','','', '0','');
    }

    if('@o1ClickD.DisplayAs' == 110){
        SaveEditBOURL = '@Url.Action("SaveGrid", "XiLink")';
    }
    else{
        SaveEditBOURL = '@Url.Action("SaveBO", "XiLink")';
    }
    MakeaChangeURL='@Url.Action("MakeaChange", "XiLink")';
</script>

<style>
    .r-c-b {
        width: 12px;
        height: 12px;
        color: red;
        display: block;
        background: #a02020;
    }

    .subnav {
        margin-bottom: 10px;
    }

    .targetredcolor {
        background: #9a1919;
        width: 75px;
        height: 12px;
        display: inline-block;
        margin-left: 10px;
    }

    .targetgreencolor {
        background: #4b752b;
        width: 75px;
        height: 12px;
        display: inline-block;
        margin-left: 10px;
    }

    .QSearchTBox {
        width: 300px;
    }

    /*.popover {
        background-color: #333740;
        border-radius: 2px;
        border: 1px solid #5e5e5e;
        font-size: 11px;
    }

    .popover-content {
        padding: 0px 2px;
    }

    .popover.top > .arrow:after {
        border-top-color: #333740;
        border-width: 8px;
        bottom: -6px;
    }

    .popover-content .table > tbody > tr > td, .popover-content .table > tbody > tr > th, .popover-content .table > tfoot > tr > td, .popover-content .table > tfoot > tr > th, .popover-content .table > thead > tr > td, .popover-content .table > thead > tr > th {
        padding: 3px;
    }*/
</style>
@*@if (sBOName.ToLower() != "claim_t" && sBOName.ToLower() != "conviction_t" && sBOName.ToLower() != "driver_t")
    {
    <h3 class="maintitle">@o1ClickD.Title</h3>
    }*@

@if (!string.IsNullOrEmpty(sErrorMsg))
{
    <h4>@sErrorMsg</h4>
}
else if (o1ClickD.ID > 0 || (o1ClickD.XIGUID != null && o1ClickD.XIGUID != Guid.Empty))
{
    var s1ClickClass = "one-1q one-1q-id-" + @o1ClickD.ID + " one-1q-" + o1ClickD.Name.ToLower().Replace(" ", "_") + "" + (@o1ClickD.sCssClass != null ? (@o1ClickD.sCssClass.Length > 0 ? (" " + @o1ClickD.sCssClass) : "") : "");
    <div class="OneClickResDiv p5 @s1ClickClass" data-def="@o1ClickD.XIGUID">
        <div class="scroll_vh_100 section-container">
            @if (sShowHeading == "yes")
            {
                <h3 class="maintitle">@oBOD.LabelName</h3>
            }
            <input type="hidden" name="Heading" id="Heading_@ReportID" value="@string.Join(" ,", o1ClickD.Headings)">
            <div class="clearfix flex-head">
                @if (o1ClickD.SearchType == "NaturalSearch" || o1ClickD.IsNaturalSearch)
                {
                    @*<label class="form-label">Search</label>*@
                    <div class="search-input">
                        <input type="text" class="input-sm form-control QSearchTBox" name="QuickSearch" id="QuickSearchTBox-@sTabGUID" placeholder="Search Here" style="margin:10px auto" data-srctype="@o1ClickD.SearchType">
                    </div>

                }
            </div>
            @if (o1ClickD.SearchType == "FilterSearch" || o1ClickD.IsFilterSearch)
            {
                <div id="DynamicForm" class="one-1q-filter-form">
                    <div class="search_filter_title">
                        <span class="search_filter_btn">Filter</span>
                    </div>
                    @{
                        o1ClickD.sGUID = sTabGUID;
                        Html.RenderPartial("~/Views/Inbox/QueryDynamicForm.cshtml", o1ClickD);
                    }
                    @*@{
                            Html.RenderAction("QueryDynamicForm", "Inbox", new { OneClickID = o1ClickD.XIGUID.ToString(), BOID = o1ClickD.BOIDXIGUID.ToString(), sGUID = sTabGUID, sTabCols = sTabColumns });
                        }*@
                </div>
            }
            @if (o1ClickD.iBroadcastUpdate == 10)
            {
                singnalRID = oBOD.Name + "_" + o1ClickD.BOIDXIGUID;
            }
            @if (o1ClickD.iCreateXILinkIDXIGUID != null && o1ClickD.iCreateXILinkIDXIGUID != Guid.Empty)
            {
                <div id="Alert_@o1ClickD.XIGUID"></div>
            }
            <div id="@singnalRID">
                <div class="oneclickresponse clearfix">
                    <div class="header-form-btn">
                        <button type="button" class="btn btn-theme close-btn-toggle" style="display:none;">Close</button>
                        @if (o1ClickD.IsCreate && !bIsStepLock)
                        {
                            string sAddLabel = string.Empty;
                            if (!string.IsNullOrEmpty(o1ClickD.sAddLabel))
                            {
                                sAddLabel = o1ClickD.sAddLabel;
                            }
                            else
                            {
                                sAddLabel = "Add New";
                            }
                            if (sShowCreate == "no")
                            {
                                <div class="resaddbtn" style="display:none;">
                                    @if (IsSaveQS == "yes")
                                    {
                                        <button type="button" class="btn btn-theme btnQuote" data-IsLoading="@IsQSLinkLoading" onclick="fncQsSaveAndQSLink('@o1ClickD.XIGUID', '@o1ClickD.CreateGroupIDXIGUID', '@o1ClickD.BOIDXIGUID', '@o1ClickD.iCreateXILinkIDXIGUID','',this)">@sAddLabel</button>
                                    }
                                    else
                                    {
                                        <div>
                                            <button type="button" class="btn btn-theme btnQuote" onclick="fnc1clickcreate('@o1ClickD.XIGUID', '@o1ClickD.CreateGroupIDXIGUID', '@o1ClickD.BOIDXIGUID', '@o1ClickD.iCreateXILinkIDXIGUID', '', this, '@sTabGUID','@o1ClickD.LayoutGuid')">@sAddLabel</button>
                                        </div>
                                    }
                                </div>
                            }
                            else
                            {
                                if (IsSaveQS == "yes")
                                {
                                    <button type="button" class="btn btn-theme btnQuote" data-IsLoading="@IsQSLinkLoading" onclick="fncQsSaveAndQSLink('@o1ClickD.XIGUID', '@o1ClickD.CreateGroupIDXIGUID', '@o1ClickD.BOIDXIGUID', '@o1ClickD.iCreateXILinkIDXIGUID','',this)">@sAddLabel</button>
                                }
                                else
                                {
                                    if (IsDisableAdd.ToLower() == "no" || !@o1ClickD.IsDisableSave)
                                    {
                                        if (bUIDRef)
                                        {
                                            <button type="button" class="btn btn-theme btnQuote" id="Add_@BOGUID" onclick="fnc1clickcreate('@o1ClickD.XIGUID', '@o1ClickD.CreateGroupIDXIGUID', '@o1ClickD.BOIDXIGUID', '@o1ClickD.iCreateXILinkIDXIGUID', '',this, '@sTabGUID','@o1ClickD.LayoutGuid')">@sAddLabel</button>

                                        }
                                        else
                                        {
                                            <button type="button" class="btn btn-theme btnQuote" id="Add_@o1ClickD.BOID" onclick="fnc1clickcreate('@o1ClickD.XIGUID', '@o1ClickD.CreateGroupIDXIGUID', '@o1ClickD.BOIDXIGUID', '@o1ClickD.iCreateXILinkIDXIGUID', '',this, '@sTabGUID','@o1ClickD.LayoutGuid')">@sAddLabel</button>
                                        }
                                    }
                                    else
                                    {
                                        if (bUIDRef)
                                        {
                                            <button type="button" class="btn btn-theme btnQuote" id="Add_@BOGUID" disabled onclick="fnc1clickcreate('@o1ClickD.XIGUID', '@o1ClickD.CreateGroupIDXIGUID', '@o1ClickD.BOIDXIGUID', '@o1ClickD.iCreateXILinkIDXIGUID', '',this, '@sTabGUID','@o1ClickD.LayoutGuid')">@sAddLabel</button>

                                        }
                                        else
                                        {
                                            <button type="button" class="btn btn-theme btnQuote" id="Add_@o1ClickD.BOID" disabled onclick="fnc1clickcreate('@o1ClickD.XIGUID', '@o1ClickD.CreateGroupIDXIGUID', '@o1ClickD.BOIDXIGUID', '@o1ClickD.iCreateXILinkIDXIGUID', '',this, '@sTabGUID','@o1ClickD.LayoutGuid')">@sAddLabel</button>
                                        }
                                    }
                                }
                            }
                        }
                        @if (bDebug)
                        {
                            <button type="button" class="btn" id="DebugBtn_@o1ClickD.XIGUID" onclick="fncDebugShow(this)">Debug</button>
                            <textarea class="form-control" id="Debug-@o1ClickD.XIGUID" style="display:none;"></textarea>
                        }

                        @if (o1ClickD.IsDelete && @o1ClickD.Actions.Count() > 0)
                        {
                            XIInfraCache oCache = new XIInfraCache();
                            var oActionD = (XIDBOAction)oCache.GetObjectFromCache(XIConstant.CacheBOAction, null, @o1ClickD.Actions.FirstOrDefault().FKiActionIDXIGUID.ToString());
                            <div>
                                <button type="button" class="btn btn-theme btnQuote" onclick="fnc1clickDelete('@o1ClickD.XIGUID', '@oActionD.FKiActionIDXIGUID', '@o1ClickD.BOIDXIGUID', this, '@sTabGUID')">Delete All</button>
                            </div>
                        }
                        @if (o1ClickD.IsRefresh)
                        {
                            if (sBOName.ToLower() != "claim_t" && sBOName.ToLower() != "conviction_t" && sBOName.ToLower() != "driver_t")
                            {
                                <button type="button" class="btn btn-theme btnQuote" onclick="fncrefresh('@o1ClickD.XIGUID','@Html.Raw(Json.Encode(@o1ClickD.TableColumns)).ToString()')">Refresh</button>
                            }
                        }
                        else
                        {
                            <button type="button" class="btn btn-theme btnQuote hideref-@o1ClickD.BOIDXIGUID" id="hiderefresh" onclick="fncTriggerRefresh('@o1ClickD.XIGUID', '@sTabColumns', '@o1ClickD.LayoutGuid', '@sTabGUID', '@o1ClickD.iPaginationCount')" style="display:none;">Refresh</button>
                        }
                        @if (o1ClickD.Code == "EXPORT" && o1ClickD.MyLinks.Count() > 0)
                        {
                            foreach (var item in o1ClickD.MyLinks)
                            {
                                if (item.iType == 20)
                                {
                                    <button type="button" class="btn btn-theme btnQuote" onclick="fncRunProcessController(this,'@item.sProcessControllers', '@o1ClickD.sGUID',0);">@item.sName</button>
                                }
                                else if (item.iType == 30)
                                {
                                    <button type="button" class="btn btn-theme btnQuote" onclick="fnc1ClickPCAction(this,'@item.sProcessControllers', '@o1ClickD.sGUID',0);">@item.sName</button>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-theme btnQuote" onclick="XIRun(this,'@item.FKiXILinkIDXIGUID', 0, '@o1ClickD.sGUID', null, true, '@o1ClickD.BOIDXIGUID');">@item.sName</button>
                                }
                            }
                        }
                        @*@if (o1ClickD.Code == "Quotes")
                                {

                                            <button type="button" class="btn btn-theme btnQuote" onclick="fncExecuteAsncQuotes('@o1ClickD.sGUID')">Generate Quotes</button>
                            }*@
                    </div>
                    <div id="OneclickBtnMsg" hidden></div>
                    <div id="InlineTop_@sTabGUID" class="inline-add-form InLineTop-@o1ClickD.BOIDXIGUID"></div>
                    @if (o1ClickD.Code == "Assign")
                    {
                        <div><input type="button" class="btn btn-theme btnQuote" value="Assign" id="btnSaveAssign" onclick="btnSaveAssign('@o1ClickD.sAssign')" /></div>
                    }
                    @if (o1ClickD.DisplayAs == (Int32)Enum.Parse(typeof(xiEnumSystem.xi1ClcikDisplayAS), xiEnumSystem.xi1ClcikDisplayAS.ResultList.ToString()))
                    {
                        //if (o1ClickD.FKiListGroup == 0 || (o1ClickD.FKiListGroup != 0 && o1ClickD.FKiFilterSearch == 0))0
                        //{
                        <div class="overflow-hide">
                            <div class="table-clean table-responsive">
                                <table class="table table_v2 table-striped custom-table table-condensed table-hover tablesorter dataTable tablelook" id="OneClickResult-@sTabGUID">
                                    <thead>
                                        <tr>
                                            @if (o1ClickD.Headings != null && o1ClickD.Headings.Count() > 0)
                                            {
                                                for (int k = 0; k < o1ClickD.Headings.Count(); k++)
                                                {
                                                    if (@o1ClickD.Headings[k].ToLower() == "select" && @o1ClickD.bIsSelectAll == true)
                                                    {
                                                        <th>
                                                            <input type='checkbox' class='chkReconcilliationAll' onclick="fncCheckboxOnchangeAll(this,'@o1ClickD.XIGUID','@o1ClickD.CreateGroupIDXIGUID','@o1ClickD.BOIDXIGUID','@o1ClickD.iCreateXILinkIDXIGUID','@o1ClickD.sCode')" />
                                                        </th>
                                                    }
                                                    else if (sShowClickHeader == "no" || @o1ClickD.Headings[k].ToLower() == "color")
                                                    {
                                                        <th style="display:none">@o1ClickD.Headings[k]</th>
                                                    }
                                                    else if (@o1ClickD.Headings[k].ToLower() == "hiddendata")
                                                    {
                                                        <th style="display:none">@o1ClickD.Headings[k]</th>

                                                    }
                                                    else
                                                    {
                                                        <!-- <th style="white-space: normal;line-height: 1.2;">@o1ClickD.Headings[k]</th> -->
                                                        <th style="">@o1ClickD.Headings[k]</th>
                                                    }
                                                }
                                            }
                                        </tr>
                                    </thead>
                                    <tbody class="one-1q-content"></tbody>
                                </table>
                            </div>
                            @if (o1ClickD.bIsExport == true)
                            {
                                <div>
                                    <input type="button" name="@o1ClickD.ID" value="Export" id="btnExport" class="btn btn-theme" />
                                </div>
                            }
                        </div>
                        //}
                        //else
                        //{
                        @*<div class="oneclickres" hidden>
                                <div class="table-clean table-responsive">
                                    <table class="table table-striped custom-table table-condensed table-hover tablesorter dataTable tablelook" id="OneClickResult-@sTabGUID">
                                        <thead>
                                            <tr>
                                                @if (o1ClickD.Headings != null && o1ClickD.Headings.Count() > 0)
                                                {
                                                    for (int k = 0; k < o1ClickD.Headings.Count(); k++)
                                                    {
                                                        <th>@o1ClickD.Headings[k]</th>
                                                    }
                                                }
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                                @if (o1ClickD.bIsExport == true)
                                {
                                    <div>
                                        <input type="button" name="@o1ClickD.ID" value="Export" id="btnExport" class="btn btn-theme" />
                                    </div>
                                 }
                            </div>*@
                        //}
                        <script type="text/javascript">
                            $('#btnExport').click(function () {
                                debugger
                            var sTabGUID= '@sTabGUID';
                            Fields = "";
                            Optrs = "";
                            Values = "";
                            DValue ="";
                            var j= 0;
                            var SrchFlds = '@o1ClickD.SearchFields';
                            if(SrchFlds && SrchFlds!=null){
                                j = SrchFlds.split(", ").length;
                            }
                            for(i=0;i<j;i++){
                                var form = $('.DFSubmit1').parent().parent().parent().parent();
                                var Value = $(form).find('#'+sTabGUID+'-'+i+'-Value').val();
                                if(typeof Value === 'undefined' && Value != 0)
                                {
                                    Value = $(form).find('#'+sTabGUID+'-'+i+'-Value').val();
                                }
                                var ddltext = $(form).find('#'+sTabGUID+'-'+i+'-Value :selected').text();
                                if(Value != -1){
                                    if(ddltext.length > 0 && ddltext.toLowerCase() == "please select"){

                                    }
                                    else if(Value && Value !="" && Value.length>0){
                                        var Field =$(form).find('#'+sTabGUID+'-'+i+'-FieldName').val();
                                        var Optr = $(form).find('#'+sTabGUID+'-'+i+'-Operator').val();
                                        var DValue = $(form).find('#'+sTabGUID+'-'+i+'-Value2').val();
                                        if(Optr=="between"){
                                            Values = Values + Value+"_"+DValue+",";
                                        }
                                        else{
                                            Values = Values + Value+",";
                                        }
                                        Fields = Fields + Field+",";
                                        Optrs = Optrs + Optr+",";
                                    }
                                }
                            }
                            Fields = Fields.substring(0, Fields.length-1);
                            Optrs = Optrs.substring(0, Optrs.length-1);
                            Values = Values.substring(0, Values.length-1);
                            Type = sSearchType;
                            var sFileExtension='@o1ClickD.sFileExtension';
                            var sGUID='@o1ClickD.LayoutGuid';
                            var id= $(this).attr('name');
                            window.location.href = '@Url.Action("ToDataTable", "Inbox")?i1ClickID=' + id +'&Name=Report_'+id+'&FileFormat='+sFileExtension+'&Type='+Type+'&Fields='+Fields+'&Optrs='+Optrs+'&Values='+Values+'&sGUID='+sGUID;
                            @*$.ajax({
                        url: '@Url.Action("ToDataTable", "Inbox")',
                        type: 'POST',
                        contentType: "application/json; charset=utf-8",
                        datatype: "json",
                        async: true,
                        cache: false,
                        data: JSON.stringify({i1ClickID:id, Name :"Report_"+id, FileFormat:'@o1ClickD.sFileExtension',sGUID:'@o1ClickD.sGUID', Type: Type,Fields:Fields, Optrs:Optrs,Values:Values}),
                        success: function (data) {
                        },
                        error:function(data){
                        }
                    })*@
                        })
                        </script>
                    }
                    else if (o1ClickD.DisplayAs == (Int32)Enum.Parse(typeof(xiEnumSystem.xi1ClcikDisplayAS), xiEnumSystem.xi1ClcikDisplayAS.List.ToString()) ||
                        o1ClickD.DisplayAs == (Int32)Enum.Parse(typeof(xiEnumSystem.xi1ClcikDisplayAS), xiEnumSystem.xi1ClcikDisplayAS.StoredProcedure.ToString()))
                    {
                        <div class="box-container">
                            <div class="box-body">
                                <div class="table-clean">
                                    <table class="table table-striped custom-table table-condensed table-hover tablesorter dataTable tablelook summery_Table" id="OneClickResult-@sTabGUID">
                                        <thead>
                                            <tr>
                                                @if (o1ClickD.Headings != null && o1ClickD.Headings.Count() > 0)
                                                {
                                                    for (int k = 0; k < o1ClickD.Headings.Count(); k++)
                                                    {
                                                        if (oVisualisationNVs != null && oVisualisationNVs.Count() > 0)
                                                        {
                                                            var isHidden = oVisualisationNVs.Where(x => x.sName.ToLower() == o1ClickD.Headings[k].ToLower()).Select(x => x.sValue).FirstOrDefault();
                                                            if (!string.IsNullOrEmpty(isHidden) && isHidden.ToLower() == "Yes".ToLower())
                                                            {
                                                                if (!string.IsNullOrEmpty(o1ClickD.Headings[k]))
                                                                {
                                                                    <th hidden="hidden">@o1ClickD.Headings[k]</th>
                                                                }
                                                            }
                                                            else
                                                            {
                                                                if (@o1ClickD.Headings[k].ToLower() == "select" && @o1ClickD.bIsSelectAll == true)
                                                                {
                                                                    <th>
                                                                        <input type='checkbox' class='chkReconcilliationAll' onclick="fncCheckboxOnchangeAll(this,'@o1ClickD.XIGUID','@o1ClickD.CreateGroupIDXIGUID','@o1ClickD.BOIDXIGUID','@o1ClickD.iCreateXILinkIDXIGUID')" />
                                                                    </th>
                                                                }
                                                                else if (sShowClickHeader == "no")
                                                                {
                                                                    <th hidden="hidden">@o1ClickD.Headings[k]</th>
                                                                }
                                                                else
                                                                {
                                                                    <th>@Html.Raw(@o1ClickD.Headings[k])</th>
                                                                }
                                                                @*<th>@o1ClickD.Headings[k]</th>*@
                                                            }
                                                        }
                                                        else
                                                        {
                                                            if (!string.IsNullOrEmpty(o1ClickD.Headings[k].Trim()))
                                                            {
                                                                if (o1ClickD.Headings[k].Trim().ToLower() == "hiddendata" || o1ClickD.Headings[k].Trim().ToLower() == "color")
                                                                {
                                                                    <th hidden="hidden">@o1ClickD.Headings[k]</th>
                                                                }
                                                                else
                                                                {
                                                                    <th>@o1ClickD.Headings[k]</th>
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            </tr>
                                        </thead>
                                        <tbody class="one-1q-content">
                                            @if (o1ClickD.oDataSet != null && o1ClickD.oDataSet.Count() > 0)
                                            {
                                                for (int j = 0; j < o1ClickD.oDataSet.Count(); j++)
                                                {
                                                    <tr class="one-1q-row">
                                                        @foreach (var item in o1ClickD.oDataSet["" + j + ""].Attributes)
                                                        {
                                                            string sLableName = oBOD.Attributes.Where(x => x.Value.Name.ToLower() == item.Value.sName.ToLower()).Select(x => x.Value.LabelName).FirstOrDefault();
                                                            item.Value.BOD = oBOD;
                                                            if (string.IsNullOrEmpty(sLableName) && (item.Value.sName.ToLower() == "hidden data" || item.Value.sName.ToLower() == "hiddendata" || item.Value.sName.ToLower() == "hiddendata1" || item.Value.sName.ToLower() == "color"))
                                                            {
                                                                <td hidden="hidden">@Html.Raw(item.Value.sResolvedValue)</td>
                                                            }
                                                            @*else if (oVisualisationNVs != null && oVisualisationNVs.Count() > 0 && !string.IsNullOrEmpty(sLableName))
                                                                {
                                                                    <td hidden="hidden">@Html.Raw(item.Value.sResolvedValue)</td>
                                                                }*@
                                                            else if (oVisualisationNVs != null && oVisualisationNVs.Count() > 0 && !string.IsNullOrEmpty(sLableName))
                                                            {
                                                                var isHidden = oVisualisationNVs.Where(x => x.sName.ToLower() == sLableName.ToLower()).Select(x => x.sValue).FirstOrDefault();
                                                                if (isHidden != null && isHidden.ToLower() == "Yes".ToLower())
                                                                {
                                                                    <td hidden="hidden">@Html.Raw(item.Value.sResolvedValue)</td>
                                                                }
                                                                else if (item.Value.ImagePathDetails != null && item.Value.ImagePathDetails.Count() > 0)
                                                                {
                                                                    <td><a href="@PhysicalPath\@item.Value.ImagePathDetails[0].Expression" target="_blank" type='application/pdf'>View</a></td>
                                                                }
                                                                else
                                                                {
                                                                    <td class="one-1q-field one-1q-field-@item.Value.sName.ToLower()">@Html.Raw(item.Value.sResolvedValue)</td>
                                                                }
                                                            }
                                                            else
                                                            {
                                                                if (item.Value.sName.StartsWith("r") && !item.Value.sName.StartsWith("ref"))
                                                                {
                                                                    <td class="text-right one-1q-field one-1q-field-@item.Value.sName.ToLower()">@Html.Raw(string.Format(new CultureInfo("en-GB"), "{0:c}", item.Value.sResolvedValue))</td>
                                                                }
                                                                else
                                                                {
                                                                    if (o1ClickD.bIsCheckbox == true && o1ClickD.TotalColumns.Count() > 0 && o1ClickD.oDataSet.Count() == j + 1)
                                                                    {
                                                                        <td></td>
                                                                    }
                                                                    else if (item.Value.ImagePathDetails != null && item.Value.ImagePathDetails.Count() > 0)
                                                                    {
                                                                        <td><a href="@PhysicalPath\@item.Value.ImagePathDetails[0].Expression" target="_blank" type='application/pdf'>View</a></td>
                                                                    }
                                                                    else
                                                                    {
                                                                        <td class="one-1q-field one-1q-field-@item.Value.sName.ToLower()">@Html.Raw(item.Value.sResolvedValue)</td>
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    </tr>
                                                }

                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    }
                    else if (o1ClickD.DisplayAs == (Int32)Enum.Parse(typeof(xiEnumSystem.xi1ClcikDisplayAS), xiEnumSystem.xi1ClcikDisplayAS.Chat.ToString()))
                    {

                        var XIBO = o1ClickD.BOD.Attributes.Where(x => x.Key == "fkiuserid").FirstOrDefault();
                        var XIBO_project = o1ClickD.BOD.Attributes.Where(x => x.Key == "fkiprojectid").FirstOrDefault();
                        var XIBO_category = o1ClickD.BOD.Attributes.Where(x => x.Key == "icategory").FirstOrDefault();
                        var XIBO_chattype = o1ClickD.BOD.Attributes.Where(x => x.Key == "ichattype").FirstOrDefault();
                        <div class="chatContainer">
                            <div class="list-group chatproject" id="selectproject">

                                @*@foreach (var opp in XIBO_project.Value.FieldDDL)
                                    {
                                        <a class="selectproject list-group-item" id="@opp.text">@opp.Expression</a>
                                    }*@
                            </div>
                            <select id="selectuser" class="form-control"><option class="selectuser list-group-item"></option></select>

                            @*<select class="form-control chatUsers" id="selectuser">
                                    @foreach (var opp in XIBO.Value.FieldDDL)
                                    {
                                        var removeuserID = opp.Expression.Replace(opp.text, "");
                                        <option class="selectuser list-group-item" id="@opp.text">@removeuserID</option>
                                    }
                                </select>*@
                            <div class="chatSection">
                                <script>
                                    $(document).ready(function () {
                                        $(".icn.Chat").addClass("active");
                                        $('.icn').click(function () {
                                            debugger
                                            // Remove 'active' class from all elements with class 'icn'
                                            $('.icn').removeClass('active');
                                            // Add 'active' class to the clicked element
                                            $(this).addClass('active');
                                            Get_ChatHistory();
                                        });
                                        $.ajax({
                                        url: '@Url.Action("Get_ProjectsbyUserID", "XIComponents")',
                                        type: 'POST',
                                        contentType: "application/json; charset=utf-8",
                                        datatype: "json",
                                        async: true,
                                        cache: false,
                                        data: JSON.stringify({ iUserID: @iUserID }),
                                        success: function (data) {
                                            $.each(data, function (index, item) {
                                                //var link = $('<a>', { class: 'selectproject list-group-item', id: item.Attributes.ProjectID.sValue, text: item.Attributes.Name.sValue });
                                                var link = '<a class="selectproject list-group-item" id="' + item.Attributes.ProjectID.sValue +'">'+item.Attributes.Name.sValue+'</a>';
                                                $('#selectproject').append(link);
                                            });

                                            // Clear the chat message box
                                            $('#ChatMsgBox_@sTabGUID').val('');
                                        },
                                        error: function (data) {
                                            debugger;
                                        }
                                        });
                                    var ProjectID = 0;
                                   $('.chat_msg').empty('');
                                   $('#selectuser').hide();
                                  //  $('.chat-history').empty();
                                // Attach the click event handler to the list items
                                $("#selectuser1").on("change", function () {
                                    // Get the text content of the selected list item
                                    var selectedOption = $(this).find(":selected");
                                    var selectedUser = selectedOption.val();
                                    var selectedValue = selectedOption.attr("id");
                                    $("#append").text(selectedUser);
                                    $("#append").val(selectedValue);
                                    $.ajax({
                                        url: '@Url.Action("Get_ChatdataByID", "XIComponents")',
                                        type: 'POST',
                                        contentType: "application/json; charset=utf-8",
                                        datatype: "json",
                                        async: true,
                                        cache: false,
                                        data: JSON.stringify({ reciverID: selectedValue }),
                                        success: function (data) {

                                            $.each(data, function (index, item) {
                                                if (@iUserID == item.Attributes.iSenderID.sValue) {
                                                    var sHTML = '<li class="clearfix"><div class="message other-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick="fncSaveChatMessage(' + item.Attributes.ID.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + item.Attributes.ID.sValue + '></div><p>' + item.Attributes.sDescription.sValue + '';
                                                    sHTML = sHTML + '</p><span class="message-data-time"> ' + item.Attributes.dDate.sValue + '</span><div class="expression-icon-select" id="selected_"' + item.Attributes.ID.sValue + '><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '"></span></div>';
                                                    sHTML = sHTML + '<ul id=Name_' + item.Attributes.ID.sValue + '></ul></div ></div ></li > ';
                                                    $('.chat_msg').append(sHTML)

                                                }
                                                else {
                                                    var sHTML = '<li class="clearfix"><div class="msg-right"><div class="message my-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick="fncSaveChatMessage(' + item.Attributes.ID.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + item.Attributes.ID.sValue + '></div><p>' + item.Attributes.sDescription.sValue + '';
                                                    sHTML = sHTML + '</p><span class="message-data-time"> ' + item.Attributes.dDate.sValue + '</span><div class="expression-icon-select"  id="selected_"' + item.Attributes.ID.sValue + '><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '"></span> </div>';
                                                    sHTML = sHTML + '<ul id=Name_' + item.Attributes.ID.sValue + '></ul></div ></div ></li > ';
                                                    $('.chat_msg').append(sHTML)

                                                }
                                               @* $(function () {
                                                    debugger;
                                                    $.contextMenu({
                                                        selector: '.context-menu-one',
                                                        callback: function(key, options) {
                                                            var m = "clicked: " + key;
                                                            window.console && console.log(m) || alert(m);
                                                        },
                                                        items: {
                                                            "edit": {name: "Edit", icon: "edit"},
                                                            "cut": {name: "Cut", icon: "cut"},
                                                            copy: {name: "Copy", icon: "copy"},
                                                            "paste": {name: "Paste", icon: "paste"},
                                                            "delete": {name: "Delete", icon: "delete"},-->
                                                            @* "sep1": "---------",
                                                            "quit": {name: "Quit", icon: function(){
                                                                return 'context-menu-icon context-menu-icon-quit';
                                                            }}
                                                        }
                                                    });

                                                    $('.context-menu-one').on('click', function(e){
                                                        console.log('clicked', this);
                                                    })
                                            });*@
                                            });
                                            @*var name = '@SessionManager.sName';
                                            $('.chat-history').append(sHTML);*@
                                            $('#ChatMsgBox_@sTabGUID').val('');
                                        },
                                        error: function (data) {
                                            debugger;
                                        }
                                    });
                                });

                                    //$("#selectproject a").on("click", function () {

                                   $('#selectproject').on('click', 'a.selectproject', function () {
                                       debugger;
                                        var preprojectID = ProjectID;
                                         ProjectID = $(this).attr("id");
                                        var Projectname = $(this).text();
                                        $("#append").text(Projectname);
                                       $("#append").val(ProjectID);
                                       var categoryID = $("#selectcategory").val();

                                       $('#selectuser').empty();
                                        if (preprojectID > 0 && (preprojectID != ProjectID)) {

                                            hub.server.leaveGroup("Group_" + preprojectID);
                                        }
                                        hub.server.joinGroup("Group_" + ProjectID);
                                       var ChattypeID =  $(".icn.active").attr("id");
                                        console.log("joinedinGroup_" + ProjectID);
                                        $.ajax({
                                            url: '@Url.Action("Get_ChatdataByID", "XIComponents")',
                                            type: 'POST',
                                            contentType: "application/json; charset=utf-8",
                                            datatype: "json",
                                            async: true,
                                            cache: false,
                                            data: JSON.stringify({ ProjectID: ProjectID, categoryID: categoryID, ChattypeID: ChattypeID }),
                                            success: function (data) {
                                                debugger;
                                                $('.chat_msg').empty();
                                                $.each(data.oBOIList, function (index, item) {
                                                    var ID = item.Attributes.ID.sValue;
                                                   var sName= item.Attributes.Names.sValue.split(',')

                                                    var timeArray = item.Attributes.tTime.sValue.split(':');
                                                    var hours = timeArray[0];
                                                    var minutes = timeArray[1];
                                                    var date = item.Attributes.dDate.sValue.split(' ');
                                                    var formattedTime = hours + ':' + minutes;
                                                    if (@iUserID == item.Attributes.iSenderID.sValue) {

                                                        var sHTML = '<li class="clearfix"><div class="msg-right"><div class="message my-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick="fncSaveChatMessage(' + item.Attributes.ID.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + item.Attributes.ID.sValue + '></div>';
                                                        if (item.Attributes.sDescription.sValue.length > 0 ) {
                                                                    sHTML = sHTML + '<p> ' + item.Attributes.sDescription.sValue + '</p>';
                                                                }
                                                        else if (item.Attributes.sAliasName.sValue.length > 0)
                                                        { sHTML = sHTML + '<a download href="' + item.Attributes.sFullPath.sValue + '"><p> ' + item.Attributes.sAliasName.sValue + '</p></a>'; }

                                                        sHTML = sHTML + '<span class="message-data-time">'+ item.Attributes.CreatedBy.sValue + ' ' + date[0] + ' ' + formattedTime + '</span> ';
                                                        if (item.Attributes.iThumbsup.sValue > 0) {
                                                            sHTML = sHTML + '</div><div class="expression-icon-select selected"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '">' + item.Attributes.iThumbsup.sValue + ' </span></div>';
                                                            sHTML = sHTML + '<ul id = Name_' + item.Attributes.ID.sValue + '>';

                                                            $.each(sName, function (index, value) {
                                                                var listItem = $('<li>').text(value);
                                                                $('#Name_' + item.Attributes.ID.sValue).append(listItem);
                                                            });
                                                            sHTML = sHTML + ' </ul ></div ></div ></li> ';
                                                        }
                                                        else {
                                                            sHTML = sHTML + '</div><div class="expression-icon-select"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '"></span></div><ul id=Name_' + item.Attributes.ID.sValue + '></ul></div></div></li>';
                                                        }

                                                        $('.chat_msg').append(sHTML)
                                                        $.each(sName, function (index, value) {
                                                            var listItem = $('<li>').text(value);
                                                            $('#Name_' + item.Attributes.ID.sValue).append(listItem);
                                                        });
                                                    }
                                                    else {

                                                        var sHTML = '<li class="clearfix"><div class="message other-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick="fncSaveChatMessage(' + item.Attributes.ID.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + item.Attributes.ID.sValue + '></div>';

                                                        if (item.Attributes.sDescription.sValue.length > 0 ) {
                                                            sHTML = sHTML + '<p> ' + item.Attributes.sDescription.sValue + '</p>';
                                                        }
                                                        else if (item.Attributes.sAliasName.sValue.length > 0) { sHTML = sHTML + '<a download  href="' + item.Attributes.sFullPath.sValue + '"><p> ' + item.Attributes.sAliasName.sValue + '</p></a>'; }


                                                        sHTML = sHTML + '<span class="message-data-time">' + item.Attributes.CreatedBy.sValue + '  ' + date[0] + ' ' + formattedTime + '</span> ';
                                                        if (item.Attributes.iThumbsup.sValue > 0) {
                                                            sHTML = sHTML + '</div><div class="expression-icon-select selected"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '">' + item.Attributes.iThumbsup.sValue + ' </span></div><ul id=Name_' + item.Attributes.ID.sValue + '></ul></div></li>';
                                                        }
                                                        else {
                                                            sHTML = sHTML + '</div><div class="expression-icon-select"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '"></span></div><ul id=Name_' + item.Attributes.ID.sValue + '></ul></div></li>';
                                                        }
                                                        $('.chat_msg').append(sHTML)
                                                        $.each(sName, function (index, value) {
                                                            var listItem = $('<li>').text(value);
                                                            $('#Name_' + item.Attributes.ID.sValue).append(listItem);
                                                        });

                                                    }
                                                });

                                                $.each(data.Userlist, function (index, US) {
                                                    var option = '<option class="selectuser1 list-group-item" id='+US.ID+'>' + US.text + '</option>';
                                                    $('#selectuser').append(option);
                                                    $('#selectuser').show();

                                                });
                                            @*var name = '@SessionManager.sName';
                                            $('.chat-history').append(sHTML);*@
                                                $('#ChatMsgBox_@sTabGUID').val('');
                                            },
                                            error: function (data) {
                                                debugger;
                                            }
                                        });
                                    });
                                   $("#selectcategory").on("change", function () {
                                    Get_ChatHistory();
                                   });
                               });



                                // Get the select element

                                function Get_ChatHistory() {
                                    debugger;
                                    var ProjectID = $("#append").val();
                                    var categoryID = $("#selectcategory").val();
                                    var ChattypeID = $(".icn.active").attr("id");
                                    $.ajax({
                                        url: '@Url.Action("Get_ChatdataByID", "XIComponents")',
                                        type: 'POST',
                                        contentType: "application/json; charset=utf-8",
                                        datatype: "json",
                                        async: true,
                                        cache: false,
                                        data: JSON.stringify({ ProjectID: ProjectID, categoryID: categoryID, ChattypeID: ChattypeID }),
                                        success: function (data) {
                                            debugger;
                                            $('.chat_msg').empty();
                                            $.each(data.oBOIList, function (index, item) {
                                                debugger;
                                                var timeArray = item.Attributes.tTime.sValue.split(':');
                                                var hours = timeArray[0];
                                                var minutes = timeArray[1];
                                                var date = item.Attributes.dDate.sValue.split(' ');
                                                var formattedTime = hours + ':' + minutes;
                                                var sName = item.Attributes.Names.sValue.split(',')
                                                //var uiElement = document.getElementById('Name');
                                                //uiElement.innerHTML = '';
                                                //namesArray.forEach(function (name) {
                                                //    name = name.trim();
                                                //    var listItem = document.createElement('li');
                                                //    listItem.textContent = name;
                                                //    uiElement.appendChild(listItem);
                                                //});
                                                if (@iUserID == item.Attributes.iSenderID.sValue) {

                                                    var sHTML = '<li class="clearfix"><div class="msg-right"><div class="message my-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick="fncSaveChatMessage(' + item.Attributes.ID.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + item.Attributes.ID.sValue + '></div>';
                                                    if (item.Attributes.sDescription.sValue.length > 0) {
                                                        sHTML = sHTML + '<p> ' + item.Attributes.sDescription.sValue + '</p>';
                                                    }
                                                    else if (item.Attributes.sAliasName.sValue.length > 0) { sHTML = sHTML + '<a download href="' + item.Attributes.sFullPath.sValue + '"><p> ' + item.Attributes.sAliasName.sValue + '</p></a>'; }

                                                    sHTML = sHTML + '<span class="message-data-time">' + item.Attributes.CreatedBy.sValue + ' ' + date[0] + ' ' + formattedTime + '</span> ';
                                                    if (item.Attributes.iThumbsup.sValue > 0) {
                                                        sHTML = sHTML + '</div><div class="expression-icon-select selected"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '">' + item.Attributes.iThumbsup.sValue + '</span></div>';
                                                        sHTML = sHTML + '<ul id=Name_' + item.Attributes.ID.sValue + '></ul>'
                                                        sHTML = sHTML +'</div ></div ></li>';

                                                    }
                                                    else {
                                                        sHTML = sHTML + '</div><div class="expression-icon-select"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '"></span></div><ul id=Name_' + item.Attributes.ID.sValue + '></ul></div></div></li>';
                                                    }
                                                    
                                                    $('.chat_msg').append(sHTML);
                                                    $.each(sName, function (index, value) {
                                                        var listItem = $('<li>').text(value);
                                                        $('#Name_' + item.Attributes.ID.sValue).append(listItem);
                                                    });
                                                }
                                                else {

                                                    var sHTML = '<li class="clearfix"><div class="message other-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick="fncSaveChatMessage(' + item.Attributes.ID.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + item.Attributes.ID.sValue + '></div>';

                                                    if (item.Attributes.sDescription.sValue.length > 0) {
                                                        sHTML = sHTML + '<p> ' + item.Attributes.sDescription.sValue + '</p>';
                                                    }
                                                    else if (item.Attributes.sAliasName.sValue.length > 0) { sHTML = sHTML + '<a download  href="' + item.Attributes.sFullPath.sValue + '"><p> ' + item.Attributes.sAliasName.sValue + '</p></a>'; }


                                                    sHTML = sHTML + '<span class="message-data-time">' + item.Attributes.CreatedBy.sValue + '  ' + date[0] + ' ' + formattedTime + '</span> ';
                                                    if (item.Attributes.iThumbsup.sValue > 0) {
                                                        sHTML = sHTML + '</div><div class="expression-icon-select selected"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '">' + item.Attributes.iThumbsup.sValue + '</span></div><ul id=Name_' + item.Attributes.ID.sValue + '></ul></div></li>';
                                                    }
                                                    else {
                                                        sHTML = sHTML + '</div><div class="expression-icon-select"  id="selected_' + item.Attributes.ID.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + item.Attributes.ID.sValue + '"></span></div><ul id=Name_' + item.Attributes.ID.sValue + '></ul></div></li>';
                                                    }
                                                    $('.chat_msg').append(sHTML);
                                                    $.each(sName, function (index, value) {
                                                        var listItem = $('<li>').text(value);
                                                        $('#Name_' + item.Attributes.ID.sValue).append(listItem);
                                                    });


                                                }
                                            });

                                            $.each(data.Userlist, function (index, US) {
                                                var option = '<option class="selectuser1 list-group-item" id=' + US.ID + '>' + US.text + '</option>';
                                                $('#selectuser').append(option);
                                                $('#selectuser').show();

                                            });
                                        },
                                        error: function (data) {
                                            debugger;
                                        }

                                    });
                                };

                                </script>
                                <div class="card chat-app" id="collapseChat">
                                    <div class="chat-app-header">
                                        <h4 id="append"></h4>
                                        <div class="chat-title-option">
                                            @foreach (var opp in XIBO_chattype.Value.OptionList.OrderBy(opp => opp.sOptionName))
                                            {
                                                <span class="icn @opp.sOptionName" id="@opp.sValues" data-toggle="tooltip" title="@opp.sOptionName"></span>
                                            }
                                        </div>
                                        <select class="" id="selectcategory">

                                            @foreach (var opp in XIBO_category.Value.OptionList.OrderBy(opp => opp.sValues))
                                            {
                                                <option class="selectcategory list-group-item" value="@opp.sValues">@opp.sOptionName</option>
                                            }
                                        </select>
                                        <script>
                                            $(function () {$('[data-toggle="tooltip"]').tooltip()});
                                        </script>
                                    </div>
                                    <div class="chat">
                                        <div class="chat-history">
                                            <ul class="m-b-0 chat_msg">
                                                <span id="currentChat_@o1ClickD.LayoutGuid" style="display:none">
                                                    @o1ClickD.ActionFields;
                                                </span>
                                                @if (o1ClickD.oDataSet != null && o1ClickD.oDataSet.Count() > 0)
                                                {
                                                    for (int j = 0; j < o1ClickD.oDataSet.Count(); j++)
                                                    {
                                                        var chatMsg = o1ClickD.oDataSet["" + j + ""].AttributeI("sDescription").sValue;
                                                        var userId = o1ClickD.oDataSet["" + j + ""].AttributeI("FKsWhoID").sValue;
                                                        var msgTime = o1ClickD.oDataSet["" + j + ""].AttributeI("tTime").sValue;
                                                        var CreatedBy = o1ClickD.oDataSet["" + j + ""].AttributeI("dDate").sValue;
                                                        var lineNumber = o1ClickD.oDataSet["" + j + ""].AttributeI("iSenderID").iValue;
                                                        var lineData = o1ClickD.oDataSet["" + j + ""].AttributeI("iReceiverID").sValue;
                                                        var isUser = "other-message";
                                                        if (j == 0)
                                                        {
                                                            var contractId = o1ClickD.oDataSet["" + j + ""].AttributeI("FKibcoContractID").iValue;
                                                            var contractVersion = o1ClickD.oDataSet["" + j + ""].AttributeI("FKibcoContractVersionID").iValue;
                                                            @*<script>
                                                                    $(document).ready(function () {
                                                                        debugger
                                                                        var tblName = 'bcoContractVersion';
                                                                        var id=@contractVersion;
                                                                    if (@contractId > 0)
                                                                    {
                                                                        tblName = 'bcoContract';
                                                                        id = @contractId;
                                                                    }
                                                                    loadProjectDetails(tblName, id);
                                                                    });
                                                                </script>*@
                                                        }
                                                        if (userId == SessionManager.UserID.ToString())
                                                        {
                                                            isUser = "my-message";
                                                        }
                                                        <li class="clearfix">
                                                            <div class="message @isUser">
                                                                <span class="small ">@CreatedBy</span>
                                                                <p>
                                                                    @chatMsg
                                                                    @if (lineNumber > 0)
                                                                    {
                                                                        <span class="message-hover-icon messageIcon"></span>
                                                                        <span class="message-hover-tooltip">Line No :@lineNumber @lineData</span>
                                                                    }
                                                                </p>
                                                                <span class="message-data-time">@msgTime</span>
                                                            </div>
                                                        </li>
                                                    }
                                                }
                                            </ul>
                                        </div>
                                        <div class="chat-message clearfix">
                                            <input type="file" id="fileAttachInput" style="display:none" />
                                            <div id="fileAttach"></div>


                                            <div class="StatusMessages" title="Confirm Message"></div>
                                            <div class="input-group mb-0">
                                                @* <input type="text" id="ChatMsgBox_@sTabGUID" class="form-control msg-input" placeholder="Enter text here..."> *@
                                                <input type="text" id="ChatMsgBox_@sTabGUID" class="form-control msg-input" contentEditable="true" placeholder="Enter text here...">
                                                <input class="IconDisplay" type="hidden" name="" id="ImageID-0" value="0" />
                                                <div class="input-group-addon message-attach ">
                                                    <i class="fa fa-paperclip"></i>
                                                </div>
                                                <input type="hidden" id="UploadImageValue" name="UploadImageValue" value="">
                                                <input type="file" class="UploadImage" name="UploadImage" id="UploadImage" multiple onchange="UploadFile('iattachments', '45800', '', this)" />
                                                <div class="input-group-addon msg-send-btn" onclick="fncSaveChatMessage()" id="msgPress">
                                                    <i class="fa fa-paper-plane"></i>
                                                </div>
                                            </div>
                                            <script>
                                        $('#fileAttachInput').each(function (index) {
                                            //$('#UploadImage').click(function () {
                                            //    $('#fileAttachInput').trigger('click');
                                            //});
                                            //$('#fileAttachInput').on('change', function () {
                                            //    debugger;
                                            //    //$('#fileAttach').html($(this).val().replace(/^.*[\\\/]/, ''));
                                            //    var filename = $(this).val().replace(/^.*[\\\/]/, '');
                                            //    $('#fileAttach').append('<span>' + filename + '</span>');
                                            //    UploadFile('iattachments', '45800', '', this);
                                            //});
                                        });
                                                function UploadFile(AttrName, BOFieldID, sFileAliasName, This) {
                                                    debugger;
        var sDDLAttr = AttrName.split('_')[0];
        var sDDLAttrName = sDDLAttr + "_" + "iStatus";
        var sBOName = '@sBOName';
        var id = 'UploadImage'; /*$(This).attr('id');*/
        var iInstanceID = 0;/*id.split('-')[1];*/
        var ID = 0;

        //imagesPreview(This, iInstanceID);
        if ($("#" + id).val() != "") {
            $.ajaxFileUpload({
                url: '@Url.Action("SaveFiles", "XiLink")',
                data: { ID: ID, BOFieldID: BOFieldID, sInstanceID: iInstanceID, sFileAliasName: sFileAliasName, sParentID: "", iBuildingID: 0, sFolderName: "" },
                secureuri: false,
                type: 'POST',
                fileElementId: id,
                dataType: 'json',
                success: function (response, responseData) {
                    debugger;
                    var data = responseData.split(',');
                    var chatID = "";
                    var iID = data[0];
                    var FileAliasName = data[1];
                    var FilePath = data[2];
                    if (iID > 0) {
                        $('#UploadImageValue').val(iID);
                        $('.StatusMessages').html('<div class="alert alert-success">File uploaded successfully</div>');
                        $('.StatusMessages').show();
                        fncSaveChatMessage(chatID, FileAliasName, FilePath);
                        setTimeout(function () {
                            $('.StatusMessages').fadeOut();
                        }, 5000)
                    } else {
                        $('#UploadImage').prepend(iID);
                        $('.StatusMessages').html('<div class="alert alert-success">File upload failed...Please upload it again</div>');
                        $('.StatusMessages').show();
                        setTimeout(function () {
                            $('.StatusMessages').fadeOut();
                        }, 5000)
                    }
                },
                error: function (respose, ID) {
                    $("." + sNewGUID + "-" + sBOName + "-" + AttrName).html("File upload failed...Please upload it again");
                }
            })
        }
    }
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    else if (o1ClickD.DisplayAs == (Int32)Enum.Parse(typeof(xiEnumSystem.xi1ClcikDisplayAS), xiEnumSystem.xi1ClcikDisplayAS.Grid.ToString()))
                    {
                        <div id="Grid-@o1ClickD.ID">
                            <form class="CreateForm form-h form-hd fullwidth" id="Create_@iBODID" data-type="form">
                                <div class="table-clean table-responsive">
                                    @*<table class="table custom-table dark-head dark-head2 table-condensed table-hover tablesorter gridtable" id="OneClickResult-@o1ClickD.ID">*@
                                    <table class="table table-striped custom-table table-condensed table-hover tablesorter dataTable tablelook" id="OneClickResult-@sTabGUID">
                                        <thead>
                                            <tr>

                                                @if (o1ClickD.Headings != null && o1ClickD.Headings.Count() > 0)
                                                {
                                                    for (int k = 0; k < o1ClickD.Headings.Count(); k++)
                                                    {
                                                        if (oVisualisationNVs != null && oVisualisationNVs.Count() > 0)
                                                        {
                                                            var isHidden = oVisualisationNVs.Where(x => x.sName.ToLower() == o1ClickD.Headings[k].ToLower()).Select(x => x.sValue).FirstOrDefault();
                                                            if (!string.IsNullOrEmpty(isHidden) && isHidden.ToLower() == "Yes".ToLower())
                                                            {
                                                                if (!string.IsNullOrEmpty(o1ClickD.Headings[k]))
                                                                {
                                                                    <th hidden="hidden">@o1ClickD.Headings[k]</th>
                                                                }
                                                            }
                                                            else
                                                            {
                                                                <th>@o1ClickD.Headings[k]</th>
                                                            }
                                                        }
                                                        else
                                                        {
                                                            <th>@o1ClickD.Headings[k]</th>
                                                        }
                                                    }
                                                }
                                            </tr>
                                        </thead>
                                        <tbody class="gridtbody">
                                            @if (o1ClickD.oDataSet.Values.Count() > 0)
                                            {
                                                if (o1ClickD.oDataSet.Values.Count() > 0)
                                                {
                                                    o1ClickD.oDataSet.Values.FirstOrDefault().BOD = oBOD;
                                                }
                                                XIIComponent oXICompI = new XIIComponent();
                                                oXICompI.oContent[XIConstant.GridComponent] = o1ClickD;
                                                oXICompI.oVisualisation = oVisualisations;
                                                //Model.oContent[XIConstant.GridComponent] = o1ClickD;
                                                //Html.RenderPartial("~/views/xicomponents/_gridresult.cshtml", o1ClickD.oDataSet.Values);
                                                Html.RenderPartial("~/views/xicomponents/_gridresult.cshtml", oXICompI);
                                            }
                                            else if (o1ClickD.oDataSet.Values.Count() == 0)
                                            {
                                                XIIComponent oXICompI = new XIIComponent();
                                                oXICompI.oContent[XIConstant.GridComponent] = o1ClickD;
                                                Html.RenderPartial("~/views/xicomponents/_gridresult.cshtml", oXICompI);
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <button type="button" class="SubmitBtn btn btn-theme btnQuote" onclick="SaveGridData(this,null,'@sBOName')"><i class="fa fa-edit"></i> Update</button>
                            </form>
                        </div>
                    }
                    else if (o1ClickD.DisplayAs == (Int32)Enum.Parse(typeof(xiEnumSystem.xi1ClcikDisplayAS), xiEnumSystem.xi1ClcikDisplayAS.Repeater.ToString()))
                    {
                        if ((o1ClickD.FKiComponentID > 0 || (o1ClickD.FKiComponentIDXIGUID != null && o1ClickD.FKiComponentIDXIGUID != Guid.Empty)) && o1ClickD.XIComponent != null)
                        {
                            if (o1ClickD.XIComponent.sName.ToLower() == XIConstant.HTMLComponent.ToLower())
                            {
                                foreach (var text in o1ClickD.RepeaterResult)
                                {
                                    @*<div id="Delete__@iBODID@i">*@
                                    @*<span>*@
                                    @Html.Raw(text)
                                    @*</span>*@
                                    @*</div>*@
                                    //i++;
                                }
                            }
                            else
                            {
                                if (o1ClickD.oDataSet != null && o1ClickD.oDataSet.Values.Count() > 0)
                                {
                                    foreach (var oBOI in o1ClickD.oDataSet.Values)
                                    {
                                        XIInfraCache oCache = new XIInfraCache();
                                        var oComponentD = o1ClickD.XIComponent;
                                        oBOI.iBODID = o1ClickD.BOID;
                                        XIIComponent oCompI = new XIIComponent();
                                        XIBODisplay oBODisplay = new XIBODisplay();
                                        oBODisplay.BOInstance = oBOI;
                                        oBOI.Attributes.Values.ToList().ForEach(m => m.bDirty = true);
                                        if (oBOI.Attributes.ContainsKey("XIGUID"))
                                        {
                                            oBOI.Attributes["XIGUID"].bDirty = false;
                                        }
                                        oCompI.oContent[XIConstant.FormComponent] = oBODisplay;
                                        oCompI.oDefintion = oComponentD;
                                        oComponentD.sGUID = sTabGUID;
                                        List
                                        <XIVisualisation>
                                            oXIVisualisations = new List<XIVisualisation>
                                                ();
                                        string sVisualisation = oComponentD.Params.Where(m => m.sName.ToLower() == "Visualisation".ToLower()).Select(m => m.sValue).FirstOrDefault();
                                        if (!string.IsNullOrEmpty(sVisualisation))
                                        {
                                            var oXIvisual = (XIVisualisation)oCache.GetObjectFromCache(XIConstant.CacheVisualisation, sVisualisation, null);
                                            var oXIVisualC = (XIVisualisation)o1ClickD.Clone(oXIvisual);
                                            if (oXIVisualC != null)
                                            {
                                                foreach (var oVisualisation in oXIVisualC.XiVisualisationNVs)
                                                {
                                                    if (oVisualisation.sValue != null && oVisualisation.sValue.IndexOf("{XIP") >= 0)
                                                    {
                                                        oVisualisation.sValue = oCache.Get_ParamVal(sSessionID, o1ClickD.sGUID, null, oVisualisation.sValue);
                                                    }
                                                }
                                                oXIVisualisations.Add(oXIVisualC);
                                            }
                                        }
                                        oCompI.oVisualisation = oXIVisualisations;
                                        Html.RenderPartial("~/views/xicomponents/_formcomponent.cshtml", oCompI);
                                        //Html.RenderAction("LoadDataByComponent", "XIComponents", new { oBOI = oBOI, oComponentD = o1ClickD.XIComponent });
                                    }
                                }
                            }
                        }
                    }
                </div>
            </div>
            <div id="InlineBottom-@ReportID"></div>
            <div id="CheckedList-@ReportID"></div>
        </div>
    </div>
    <script>
        const content_height = $(window).height() - $('#HomeHeader').height() - 10;
        $('#OneClickComponent .OneClickResDiv .scroll_vh_100').slimScroll({
            //height: '250px',
            height: content_height,
        });
    </script>
}

<div class="popcontainer popover-time">
</div>

<div id="GridAddFormDlg-@ReportID"></div>
<div id="GridComponentDlg"></div>

@if (o1ClickD.oOneClickParameters.Where(x => x.iType == 20).Count() > 0)
{
    <div id="XICParams" class="content">
        <form id="XiFieldsForm">
            <div class="row">
                <div class="box box-primary">
                    <div class="box-body">
                        <div id="XIComponentParams">
                            <input type="hidden" id="IsValueSet" value="@ViewBag.IsValueSet" />
                            @if (o1ClickD.oOneClickParameters.Where(x => x.iType == 20).Count() > 0)
                            {
                                foreach (var items in o1ClickD.oOneClickParameters.Where(x => x.iType == 20))
                                {
                                    <div class="form-group col-md-12 NVPairs">
                                        <div class="col-md-4">
                                            <label for="inputEmail" class="gn" data-sname="@items.sValue"> @items.sName <span class="danger"></span></label>
                                        </div>
                                        <div class="col-md-5">
                                            <input type="text" name="Names" id="valid-@items.sValue" placeholder="Value" class="form-control" value="" />
                                        </div>
                                    </div>
                                }
                            }
                            <div class="form-group">
                                <div class="col-md-2">
                                    <input type="button" value="Run" class="btn btn-theme btnQuote" id="XIOneClickParamsBtn" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
}
@if (o1ClickD.Code == "RECNCL")
{
    <div><input type="button" class="btn btn-theme btnQuote" value="Select" id="btnSaveReconcilliation" /></div>
}
else if (o1ClickD.Code == "REVERSE")
{
    <div><input type="button" class="btn btn-theme btnQuote" value="Reverse Reconcillation" id="btnReverse" /></div>
}
else if (o1ClickD.Code == "SRCN")
{
    <div><input type="button" class="btn btn-theme btnQuote" value="De Select" id="btnDeSelect" /></div>
}
else if (o1ClickD.Code == "ACTION")
{
    <div><input type="button" class="btn btn-theme btnQuote" value="Select & Next" id="btnAction" /></div>
}
<div id="CodeEditorDiv"></div>
<script type="text/javascript">
    $(document).ready(function () {
        if ('@bIsStepLock' !=null &&'@bIsStepLock' == "True") {
            $('.oneclickresponse').addClass("ComponentLock");
        }
    }); // end for ready

    @*if ('@sScroll' == "yes") {
             $("#OneClickResDiv_@o1ClickD.ID").mCustomScrollbar({
                 //setHeight:700,
                 //setWidth: false,
                 axis: "xy",
                 setWidth: "100%",
                 setLeft: 0,
                 //scrollbarPosition: "outside",
                 theme: "dark-3"
             });
         }*@
    $("#btnSaveReconcilliation").click(function (e) {
        debugger
        $('.chkReconcilliation:checkbox:checked').prop("disabled",true);
        $("#SelectRecon").remove();
        var sTabGUID = $('.InLineTop-402250cf-ed7b-41b4-81e4-6eb0b6c6c5f7').attr('id').split('_')[1];
        var res=$(this);
        var sGUID = fncGetGUIDFromHTMLTree("LayoutGUID", this);
        if('@ReconcilliationID'!=null&&'@o1ClickD.Code' == "RECNCL") {
            SaveReconcilliations(res,InputParams,sGUID,'ACXReconcilliation_T',sTabGUID);
            InputParams=[];
        }
        e.stopImmediatePropagation();
    });
     function btnSaveAssign(Xilinkid) {
         fncSetParam(SelectedInputParams.join(','), '@o1ClickD.sGUID', "MultiSelectedValues", "");
        fnc1ClickBtn(this, Xilinkid , '', '@o1ClickD.sGUID', 'Lead_T',false);
    }
    $("#btnAction").click(function() {
        $('.chkReconcilliation:checkbox:checked').prop("disabled",true);
        //var sTabGUID=$('.InLineTop-34').attr('id').split('_')[1];
        //var res=$(this);
        var sGUID = fncGetGUIDFromHTMLTree("LayoutGUID", this);
        if('@ReconcilliationID'!=null&&'@o1ClickD.Code' == "ACTION") {
            //SaveReconcilliations(res,InputParams,sGUID,'ACXReconcilliation_T',sTabGUID);
            //InputParams=[];
            XIRun(null,@o1ClickD.iActionXILinkID,0,sGUID,null,false,@o1ClickD.BOID,0,null,InputParams);
        }
    });
    $("#btnDeSelect").click(function (e) {
        debugger
        $('.chkReconcilliation:checkbox:checked').prop("disabled",true);
        $("#DeSelectRecon").remove();
        var sTabGUID = $('.InLineTop-402250cf-ed7b-41b4-81e4-6eb0b6c6c5f7').attr('id').split('_')[1];
        var res=$(this);
        var sGUID = fncGetGUIDFromHTMLTree("LayoutGUID", this);
        if('@ReconcilliationID'!=null && '@o1ClickD.Code' == "SRCN") {
            DeleteReconcilliations(res,InputParams,sGUID,'ACXReconcilliation_T',sTabGUID);
            InputParams=[];
        }
        //e.stopImmediatePropagation();
    });
    $("#btnRecpost").click(function() {
        $("#PostRecon").remove();
        if('@ReconcilliationID'!=null && '@o1ClickD.Code' == "SRCN") {
            PostReconcilliation();
        }
    });
    $("#btnReverse").click(function() {
        if('@ReconcilliationID'!=null && '@o1ClickD.Code' == "REVERSE") {
            ReverseReconcilliation();
        }
    });
    $("#CancelTran").click(function() {
        if('@o1ClickD.Code' == "CANREVTRAN") {
            XIRun(null,'4676',0,'@o1ClickD.sGUID',null,false);
            // CancelTransaction('@o1ClickD.sGUID');
        }
    });
    $("#ReplaceTran").click(function() {
        if('@o1ClickD.Code' == "CANREVTRAN") {
            XIRun(null,'4682',0,'@o1ClickD.sGUID',null,false);
        }
    });
    function fncExportToJson(){
        $.ajax({
            url: '@Url.Action("MergeJsonTemplate", "XiLink")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            async: true,
            cache: false,
            //data: JSON.stringify({ i1ClickID: '@o1ClickD.ID', sGUID: '@o1ClickD.sGUID', Fields: Fields, Optrs: Optrs, Values: Values, SearchType: Type, VisualName: VisualName, sSearType: sSearchType, SearchText:SearchText,sLockGroup:sLockGroup }),
            success: function (data) {
                var DialogDivID="ExportJson";
                var Div = '<div class="' + DialogDivID + '"></div>';
                $('#Dialogs').html(Div);
                var windowclose = '<i class="windowClose fa fa-times" onclick="fncdialogclose(this, ' + false + ', &quot;' + DialogDivID + '&quot;)"></i>';
                $('.'+DialogDivID).html(data);
                $("."+DialogDivID).dialog({
                    title:'Json',
                    //modal: true,
                    height:  $(window).height() * 0.9,
                    width: $(window).width() * 0.9,
                    //position: { my: 'left bottom', at: 'left+150 top+1150' },
                    open: function () {
                        $(this).parent().promise().done(function () {
                            $(this).children('.ui-dialog-titlebar').append('<div class="dialogIcons">' + windowclose + '</div>');
                        })
                    }
                });
            },
            error: function (data) {

            }
        })
    }

    function fncExportToHTML(){
        $.ajax({
            url: '@Url.Action("MergeProductsHTML", "XiLink")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            async: true,
            cache: false,
            //data: JSON.stringify({ i1ClickID: '@o1ClickD.ID', sGUID: '@o1ClickD.sGUID', Fields: Fields, Optrs: Optrs, Values: Values, SearchType: Type, VisualName: VisualName, sSearType: sSearchType, SearchText:SearchText,sLockGroup:sLockGroup }),
            success: function (data) {

                var DialogDivID="ExportHTML";
                var Div = '<div class="' + DialogDivID + '"></div>';
                $('#Dialogs').html(Div);
                var windowclose = '<i class="windowClose fa fa-times" onclick="fncdialogclose(this, ' + false + ', &quot;' + DialogDivID + '&quot;)"></i>';
                $('.'+DialogDivID).html(data);
                $("."+DialogDivID).dialog({
                    title:'Json',
                    //modal: true,
                    height:  $(window).height() * 0.9,
                    width: $(window).width() * 0.9,
                    //position: { my: 'left bottom', at: 'left+150 top+1150' },
                    open: function () {
                        $(this).parent().promise().done(function () {
                            $(this).children('.ui-dialog-titlebar').append('<div class="dialogIcons">' + windowclose + '</div>');
                        })
                    }
                });
            },
            error: function (data) {

            }
        })
    }
    function PostReconcilliation()
    {
        $.ajax({
            url: '@Url.Action("PostReconcilliation", "XiLink")',
            type: 'GET',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            cache: false,
            data: {ReconcilliationID:'@ReconcilliationID',ActRec:'@ActRec'},
            success: function (data) {
                if(data==true){
                    $("#btnRecpost").after($('<div id="PostRecon"><p><font face="Verdana" size="2">Reconcillation Successful</font></p></div>'));
                    XIRun(null,'4689', 0, '@o1ClickD.sGUID', null, false);
                }
                else{
                    $("#btnRecpost").after($('<div id="PostRecon"><p><font face="Verdana" size="2">Reconcillation already Posted.</font></p></div>'));
                }
            },
            error: function (data) {
                $("#btnRecpost").after($('<p><font face="Verdana" size="2">Reconcillation Failed</font></p>'));
            }
        })
    }
    function ReverseReconcilliation()
    {
        $.ajax({
            url: '@Url.Action("Reconcilliation", "XiLink")',
            type: 'GET',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            cache: false,
            data: {ReconciliationID:'@ReconcilliationID'},
            success: function (data) {
                if(data==true){
                    $('#btnReverse').prop('disabled',true);
                    $("#btnReverse").after($('<p><font face="Verdana" size="2">Reconcillation Reversed</font></p>'));
                }
                else{
                    $('#btnReverse').prop('disabled',true);
                    $("#btnReverse").after($('<p><font face="Verdana" size="2">Reverse Reconcillation is not possible, Because previously Not Reconciled.</font></p>'));
                }
            },
            error: function (data) {
                $("#btnReverse").after($('<p><font face="Verdana" size="2">Reverse Reconcillation Failed</font></p>'));
            }
        })
    }
    function SaveReconcilliations($this, oBOInstance, sGUID, sBOName, sTabGUID) {
        debugger
        var sContext = null;
        var pvalue = {
            Attributes: oBOInstance,
            sGUID: sGUID,
            sContext: sContext,
            sBOName: sBOName
        }
        var SortColumns = @Html.Raw(Json.Encode(o1ClickD.TableColumns));
        var expColumns = new Array();
        for (var i = 0; i < SortColumns.length; i++) {
            var obj = new Object();
            obj.sName = SortColumns[i];
            if (SortColumns[i] == "Select") {
                obj.bSortable = false;
            }
            else {
                obj.bSortable = true;
            }
            expColumns.push(obj);
        }
        $.ajax({
            url: '@Url.Action("SaveGrid", "XiLink")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            cache: false,
            data: JSON.stringify(pvalue),
            success: function (data) {
                var iPageLength = 0;
                if('@o1ClickD.iPaginationCount' == 0)
                {
                    iPageLength = 100;
                }
                else
                {
                    iPageLength = '@o1ClickD.iPaginationCount';
                }
                fncGetDTable(OneClickURL, '28430213-C8A6-448F-92E1-64879E2ECC50', expColumns, sGUID, '@o1ClickD.SearchText', iPageLength, sTabGUID, '@o1ClickD.SearchType','@o1ClickD.sParentWhere','','@o1ClickD.iDefaultSortColumn','@o1ClickD.sDefaultSortDirection');

                //var res=XILinkLoadJson('@o1ClickD.RowXiLinkID','@o1ClickD.sGUID',InputParams)
                //$('#SupplierSecondGrid').load();
                $("#btnSaveReconcilliation").after($('<div id="SelectRecon"><p><font face="Verdana" size="2">Data Saved Successfully</font></p></div>'));
            },
            error: function (data) {
                $("#btnSaveReconcilliation").after($('<div id="SelectRecon"><p><font face="Verdana" size="2">Data Saved failed</font></p></div>'));
            }
        })
    }
    function DeleteReconcilliations($this, oBOInstance, sGUID, sBOName, sTabGUID) {
        debugger
        var sContext = null;
        var pvalue = {
            Attributes: oBOInstance,
            sGUID: sGUID,
            sContext: sContext,
            sBOName: sBOName
        }
        var SortColumns = @Html.Raw(Json.Encode(o1ClickD.TableColumns));
        var expColumns = new Array();
        for (var i = 0; i < SortColumns.length; i++) {
            var obj = new Object();
            obj.sName = SortColumns[i];
            obj.bSortable = true
            expColumns.push(obj);
        }
        $.ajax({
            url: '@Url.Action("SaveGrid", "XiLink")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            cache: false,
            data: JSON.stringify(pvalue),
            success: function (data) {
                var iPageLength = 0;
                if('@o1ClickD.iPaginationCount' == 0)
                {
                    iPageLength = 100;
                }
                else
                {
                    iPageLength = '@o1ClickD.iPaginationCount';
                }
                fncGetDTable(OneClickURL, '@o1ClickD.XIGUID', expColumns, sGUID, '@o1ClickD.SearchText', iPageLength, sTabGUID, '@o1ClickD.SearchType','@o1ClickD.sParentWhere','','@o1ClickD.iDefaultSortColumn','@o1ClickD.sDefaultSortDirection');

                //var res=XILinkLoadJson('@o1ClickD.RowXiLinkID','@o1ClickD.sGUID',InputParams)
                //$('#SupplierSecondGrid').load();
                $("#btnDeSelect").after($('<div id="DeSelectRecon"><p><font face="Verdana" size="2">Data Saved Successfully</font></p></div>'));
            },
            error: function (data) {
                $("#btnDeSelect").after($('<div id="DeSelectRecon"><p><font face="Verdana" size="2">Data Saved failed</font></p></div>'));
            }
        })
    }

    function AnnualMonthly(name,$this) {
        $(".AMprice").removeClass('active');
        $($this).addClass('active');
        if (name == "Annual") {
            $(".MonthlyPrice-1").attr("hidden", true);
            $(".AnnualPrice-1").removeAttr("hidden");
        }
        else if (name == "Monthly") {
            $(".AnnualPrice-1").attr("hidden", true);
            $(".MonthlyPrice-1").removeAttr("hidden");
        }
    }
    function MCfnc($this)
    {
        var InputParams=[];
        var iQSDID=$($this).attr("data-id");
        var iCatID=$($this).attr("data-Categoryid");
        var iXiLinkID=$($this).attr("data-xilinkid");
        var param = {};
        param["sName"] = '{XIP|iQSInstanceID}';
        param["sValue"] = iQSDID;
        InputParams.push(param);
        var param1 = {};
        param1["sName"] = '{XIP|FKiCategoryID}';
        param1["sValue"] = iCatID;
        InputParams.push(param1);
        XIRun(null,iXiLinkID, 0, '@o1ClickD.sGUID', 'Categories_T', false,734,0, "",InputParams);
    }

    function fncSetTemplateToCache($this, iReportID, iRowXiLinkID) {
        var oOneClickParameters=@Html.Raw(Json.Encode(o1ClickD.oOneClickParameters.Where(x=>x.iType==10).ToList()));
        var RowData=$('#OneClickResult-@sTabGUID').dataTable().fnGetData($($this).closest('tr'));
        var Headings =@Html.Raw(Json.Encode(o1ClickD.Headings));
        var oVisualisation =@Html.Raw(Json.Encode(Model.oVisualisation));
        if (RowData) {
            var RowClickAttributeParams = [];
            var sHiddenString = "";
            for (var i = 0; i < Headings.length; i++) {
                if (Headings[i].toLowerCase() == "HiddenData".toLowerCase()) {
                    sHiddenString = RowData[i];
                }
            }
            if (sHiddenString && sHiddenString != "") {
                var sHiddenAttrArray = sHiddenString.split(':');
                for (var Attr = 0; Attr < sHiddenAttrArray.length; Attr++) {
                    if (sHiddenAttrArray[Attr] != "") {
                        var sAttrName = sHiddenAttrArray[Attr].split('__')[0];
                        var sAttrValue = sHiddenAttrArray[Attr].split('__')[1];
                        if (oOneClickParameters != null && oOneClickParameters.length > 0) {
                            for (var rAttr = 0; rAttr < oOneClickParameters.length; rAttr++) {
                                if (oOneClickParameters[rAttr].sName.toLowerCase() == sAttrName.toLowerCase()) {
                                    var RCAparam1 = {};
                                    RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                                    RCAparam1["sValue"] = sAttrValue;
                                    RowClickAttributeParams.push(RCAparam1);
                                }
                            }
                        }
                    }
                }
            }
        }
        var cValue = {
            sGUID: '@o1ClickD.sGUID',
            sXiLinkID: iRowXiLinkID ,
            oParams :RowClickAttributeParams
        }
        $.ajax({
            url: '@Url.Action("PreviewTemplate", "XiLink")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            cache: false,
            data: JSON.stringify(cValue),
            success: function (data) {
                if (data != "" && data != null) {
                    var IsChecked = $($this).prop("checked");
                    if (IsChecked == true) {
                        fncSetParam(data.sPreviewContent, '@o1ClickD.sGUID', "sLetterAttachement_" + data.iTemplateID, "").then(function (state, callback) { });
                    }
                    else
                    {
                        fncSetParam("", '@o1ClickD.sGUID', "sLetterAttachement_" + data.iTemplateID, "").then(function (state, callback) { });
                    }
                }
            }
        });
    }
    function PreviewTemplate($this,iReportID ,iRowXiLinkID) {
        var sInstanceID = "";
        var oOneClickParameters=@Html.Raw(Json.Encode(o1ClickD.oOneClickParameters.Where(x=>x.iType==10).ToList()));
        var RowData=$('#OneClickResult-@sTabGUID').dataTable().fnGetData($($this).closest('tr'));
        var Headings =@Html.Raw(Json.Encode(o1ClickD.Headings));
        var oVisualisation =@Html.Raw(Json.Encode(Model.oVisualisation));
        var sTextEditorID = ""; var sLetterSuccessMessage = "";
        var sTextEditor = "";
        var isChecked = $($this).closest("tr").find(".chkTemplate").prop("checked");
        $($this).attr('value', 'Edit');
        if(oVisualisation)
        {
            var oVisual = oVisualisation[0];
            if (oVisual != null && oVisual.XiVisualisationNVs != null && oVisual.XiVisualisationNVs.length > 0)
            {
                var oVisualisationNVs = oVisual.XiVisualisationNVs;
                oVisualisationNVs.filter(function (x) {
                    if (x.sName.toLowerCase() === "TextEditorID".toLowerCase()) {
                        sTextEditorID = x.sValue;
                        sTextEditor = sTextEditorID;
                    }
                    if (x.sName.toLowerCase() === "LetterSuccessMessage".toLowerCase()) {
                        sLetterSuccessMessage = x.sValue;
                    }
                })
            }
        }
        if(RowData){
            var RowClickAttributeParams=[];
            var sHiddenString="";
            for (var i = 0; i < Headings.length; i++) {
                if (Headings[i].toLowerCase() == "HiddenData".toLowerCase()) {
                    sHiddenString = RowData[i];
                }
            }
            if(sHiddenString && sHiddenString!="")
            {
                var sHiddenAttrArray=sHiddenString.split(':');
                for (var Attr = 0; Attr < sHiddenAttrArray.length; Attr++) {
                    if(sHiddenAttrArray[Attr]!="")
                    {
                        var sAttrName=sHiddenAttrArray[Attr].split('__')[0];
                        var sAttrValue=sHiddenAttrArray[Attr].split('__')[1];
                        if(oOneClickParameters!=null&&oOneClickParameters.length>0)
                        {
                            for (var rAttr = 0; rAttr < oOneClickParameters.length; rAttr++) {
                                if(oOneClickParameters[rAttr].sName.toLowerCase()==sAttrName.toLowerCase())
                                {
                                    var RCAparam1 = {};
                                    RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                                    RCAparam1["sValue"] = sAttrValue;
                                    RowClickAttributeParams.push(RCAparam1);
                                }
                            }
                        }
                    }
                }
            }
        }
        var cValue = {
            sGUID: '@o1ClickD.sGUID',
            sXiLinkID : iRowXiLinkID ,
            oParams :RowClickAttributeParams
        }
        $.ajax({
            url: '@Url.Action("PreviewTemplate", "XiLink")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            cache: false,
            data: JSON.stringify(cValue),
            success: function (data) {
                if (data != "" && data != null)
                {
                    if (sTextEditor == "LetterAttachment") {
                        tinymce.remove("textarea[name=" + sTextEditorID + "]");
                        var preTemplateContent = $("textarea[name=" + sTextEditorID + "]").val();
                        var PreTemplateID = $("textarea[name=" + sTextEditorID + "]").attr('id');
                        if (PreTemplateID && preTemplateContent && isChecked == true) {
                            fncSetParam(preTemplateContent, '@o1ClickD.sGUID', "sLetterAttachement_" + PreTemplateID, "").then(function (state, callback) { });
                        }
                        $("textarea[name=" + sTextEditorID + "]").val("");
                        $("textarea[name=" + sTextEditorID + "]").attr('id', data.iTemplateID);
                        sTextEditorID = $("textarea[name=" + sTextEditorID + "]").attr('id');
                    }
                    else {
                        tinymce.remove("#" + sTextEditorID);
                    }
                    $("#"+sTextEditorID).val(data.sPreviewContent);
                    $("#"+sTextEditorID).show();
                    if (sTextEditor && sTextEditor=="TypeHere"){
                        tinymce.init({ selector: '#TypeHere',width: "1500",
                            height: "500" ,
                            entity_encoding:'raw',
                            init_instance_callback: function (editor) {
                                editor.on('blur', function (e) {
                                    tinyMCE.triggerSave();
                                    var sLetterBodyContent = $("#TypeHere").val();
                                    if(sLetterBodyContent){
                                        fncSetParam(sLetterBodyContent, '@o1ClickD.sGUID', "sLetterBodyContent", "").then(function (state, callback) {});
                                        fncSetParam(data.iTemplateID, '@o1ClickD.sGUID', "sParentTemplateID", "").then(function (state, callback) {});
                                    }
                                });
                            },
                            toolbar: 'formatselect | bold italic strikethrough forecolor backcolor permanentpen formatpainter | link image media pageembed | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent | removeformat | addcomment | mybutton | mybutton2 |mybutto3',
                            menubar: false,
                            setup: function (editor) {
                                editor.ui.registry.addButton('mybutton', {
                                    text: 'Send',
                                    onAction: function () {
                                        var iTemplateID = data.iTemplateID;
                                        var sParentTemplateID=0;
                                        tinyMCE.triggerSave();
                                        var sLetterBodyContent = $("#TypeHere").val();
                                        if(sLetterBodyContent){
                                            fncSetParam(sLetterBodyContent, '@o1ClickD.sGUID', "sLetterBodyContent", "").then(function (state, callback) {});
                                            fncSetParam(data.iTemplateID, '@o1ClickD.sGUID', "sParentTemplateID", "").then(function (state, callback) {});
                                        }
                                        //var oHTMLContent=tinyMCE.activeEditor.getContent({format : 'raw'});
                                        //oContent=tinyMCE.activeEditor.getContent( { format : 'html' } );
                                        var sLetterBodyContent = $("#TypeHere").val();
                                        var sLetterAttachmentContent = $("#LetterAttachment").val();
                                        //oContent = $("#TextEditorNewDialog").val();
                                        var pvalue = {
                                            sLetterBodyContent: "",
                                            sTemplateID: "",
                                            sXiLinkID:data.sXiLinkID,
                                            sGUID:'@o1ClickD.sGUID'
                                        }
                                        $.ajax({
                                            url: '@Url.Action("SendLetterTemplate", "XiLink")',
                                            type: 'POST',
                                            contentType: "application/json; charset=utf-8",
                                            datatype: 'json',
                                            data: JSON.stringify(pvalue),
                                            cache: false,
                                            success: function (data) {
                                                $("#"+sLetterSuccessMessage).show();
                                                $("#"+sLetterSuccessMessage).prepend($('<div class="StatusMessages"><div class="alert alert-success">Mail send successfully</div></div>'));
                                                $(function () {
                                                    setTimeout(function () {
                                                        $("#"+sLetterSuccessMessage).hide('blind', {}, 500)
                                                    }, 5000);
                                                });
                                                return true;
                                            },
                                            error: function (data) {
                                                return false;
                                            },
                                        });
                                    }
                                });
                            }
                        });
                        var sLetterBodyContent = $("#TypeHere").val();
                        if(sLetterBodyContent){
                            fncSetParam(sLetterBodyContent, '@o1ClickD.sGUID', "sLetterBodyContent", "").then(function (state, callback) {});
                            fncSetParam(data.iTemplateID, '@o1ClickD.sGUID', "sParentTemplateID", "").then(function (state, callback) {});
                        }
                    }
                    else if (sTextEditor && sTextEditor=="LetterAttachment"){
                        tinymce.init({
                            selector: '#' + sTextEditorID,width: "1500",
                            height: "500" ,
                            entity_encoding:'raw',
                            //toolbar1: 'formatselect | bold italic strikethrough forecolor backcolor | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat | mybutton | mybutton2 | mybutton3',
                            //toolbar: 'mybutton mybutton2 mybutton3',
                            toolbar: 'formatselect | bold italic strikethrough forecolor backcolor permanentpen formatpainter | link image media pageembed | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent | removeformat | addcomment | mybutton | mybutton2 |mybutto3',
                            menubar: false,
                            setup: function (editor) {
                                editor.ui.registry.addButton('mybutton', {
                                    text: 'Send',
                                    //icon:false,
                                    //style:'color:green',
                                    onAction: function () {
                                        $('<form> <label class="form-label">Email :</label><input type="text" class="form-control sEmailC" value=' + data.sEmail + '> <label class="form-label">Subject :</label> <input type="text" class="form-control sSubjectC" value="' + data.sSubject + '"> </form>').dialog({
                                            title: "Confirmation",
                                            autoOpen: true,
                                            modal: true,
                                            width: 400,
                                            left: '600px',
                                            top: '80px',
                                            buttons: [
                                                {
                                                    text: "Yes",
                                                    click: function () {
                                                        var sEmail = $(".sEmailC").val();
                                                        var sSubject = $(".sSubjectC").val();
                                                        //$(this).dialog('close');
                                                        $(this).dialog('destroy').remove()
                                                        var iTemplateID = data.iTemplateID;
                                                        var sParentTemplateID=0;
                                                        tinyMCE.triggerSave();
                                                        if (sEmail) {
                                                            fncSetParam(sEmail, '@o1ClickD.sGUID', "{XIP|sEmail}", "").then(function (state, callback) { });
                                                        }
                                                        if (sSubject) {
                                                            fncSetParam(sSubject, '@o1ClickD.sGUID', "{XIP|sSubject}", "").then(function (state, callback) { });
                                                        }
                                                        //var oHTMLContent=tinyMCE.activeEditor.getContent({format : 'raw'});
                                                        //oContent=tinyMCE.activeEditor.getContent( { format : 'html' } );
                                                        var sLetterAttachmentContent = $("#" + sTextEditorID).val();
                                                        if (sLetterAttachmentContent) {
                                                            fncSetParam(sLetterAttachmentContent, '@o1ClickD.sGUID', "sLetterAttachement_" + iTemplateID, "").then(function (state, callback) { });
                                                        }
                                                        //oContent = $("#TextEditorNewDialog").val();
                                                        var pvalue = {
                                                            sLetterAttachmentContent: sLetterAttachmentContent,
                                                            sTemplateID: iTemplateID,
                                                            sXiLinkID:data.sXiLinkID,
                                                            sGUID:'@o1ClickD.sGUID'
                                                        }
                                                        $.ajax({
                                                            url: '@Url.Action("SendLetterTemplate", "XiLink")',
                                                            type: 'POST',
                                                            contentType: "application/json; charset=utf-8",
                                                            datatype: 'json',
                                                            data: JSON.stringify(pvalue),
                                                            cache: false,
                                                            success: function (data) {
                                                                $("#"+sLetterSuccessMessage).show();
                                                                $("#"+sLetterSuccessMessage).prepend($('<div class="StatusMessages"><div class="alert alert-success">Mail send successfully</div></div>'));
                                                                $(function () {
                                                                    setTimeout(function () {
                                                                        $("#"+sLetterSuccessMessage).hide('blind', {}, 500)
                                                                    }, 5000);
                                                                });
                                                                return true;
                                                            },
                                                            error: function (data) {
                                                                return false;
                                                            },
                                                        });
                                                    }
                                                },
                                                {
                                                    text: "No",
                                                    click: function () {
                                                        //$(this).dialog('close');
                                                        $(this).dialog('destroy').remove()
                                                    }
                                                }
                                            ]
                                        });

                                    }
                                });

                                editor.ui.registry.addButton('mybutton2', {
                                    text: 'Print',
                                    //icon:false,
                                    //style:'color:green',
                                    onAction: function () {
                                        var iTemplateID = data.iTemplateID;
                                        //var oContent = $("#" + sTextEditorID).val();
                                        var printWindow = window.open('', '', 'height=400,width=800');
                                        //printWindow.document.open();
                                        printWindow.document.write($('#' + sTextEditorID).val());
                                        //printWindow.document.close();
                                        printWindow.print();
                                        printWindow.document.close();
                                        printWindow.close();
                                    }
                                });
                            }
                        });
                    }
                    //tinymce.activeEditor.contentDocument.body.style.backgroundColor = '#f0f0f0';
                    //$('textarea#TypeHere').froalaEditor();
                    //$("#TypeHere").shieldEditor({
                    //    height: 260
                    //});
                }
            },
            error: function (respose, ID) {

            }
        })
    }
    var iOverrideType;
    function fncAdvc1Click(_this, o1ClickDJ, oBODJ, oCompDJ, sGUID, sTabGUID){
        var oOneClickParameters=o1ClickDJ.oOneClickParameters;
        var RowClickAttributeParams=[];
        var rt = $(_this).closest("tr");
        var rt = $(rt).prop("checked");
        if (rt == true) {
            e.stopImmediatePropagation();
        }
        if(o1ClickDJ.ResultListDisplayType==1)
        {
            var tr = $(_this).closest('tr');
            var tddata = [];
            if (o1ClickDJ.DisplayAs == 50 || o1ClickDJ.DisplayAs == 170)
            {
                tddata=$('#OneClickResult-'+sTabGUID).dataTable().fnGetData($(_this).closest('tr'));
            }
            else
            {
                $(tr).children('td').each(function(ii, vv){
                    tddata[ii] = $(this).text();
                });
            }
            RowData = tddata;
        }
        else{
            RowData = $(_this).children("td").map(function() {
                return $(_this).text();
            }).get();
        }
        var id;

        var sBOPK = oBODJ.sPrimaryKey;
        if(RowData){
            for (var i = 0; i < o1ClickDJ.Headings.length; i++) {
                if ($.inArray(sBOPK, o1ClickDJ.Headings) != -1)
                {
                    if (o1ClickDJ.Headings[i].toLowerCase() == sBOPK.toLowerCase())
                        id = RowData[i];
                }
                else{
                    if (o1ClickDJ.Headings[i].toLowerCase() == "ID".toLowerCase() || o1ClickDJ.Headings[i].toLowerCase() == "XiLinkID".toLowerCase() || o1ClickDJ.Headings[i].toLowerCase() == "BOID".toLowerCase())
                        id = RowData[i];
                }
            }
            if (editpopups.length > 0) {
                for (i = 0; i < editpopups.length; i++) {
                    editpopups[i].close();
                }
            }
            var edit = window.open('', '_blank', "scrollbars=1,resizable=1,width=" + screen.width + ", height=" + screen.height);
            $.ajax({
                type: 'POST',
                url: '@Url.Action("QueryEditPopUP", "QueryGeneration")',
                data: { QueryID: id, Type: "" },
                cache: false,
                async: true,
                dataType: 'html',
                success: function (data) {
                    with (edit.document) {
                        open();
                        write(data);
                        close();
                    }
                    editpopups.push(edit);
                }
            });
        }
    }
    function funDrillIn(_this, o1ClickDJ, oBODJ, sGUID, sTabGUID){
        @*var oOneClickParameters=@Html.Raw(Json.Encode(o1ClickD.oOneClickParameters.Where(x=>x.iType==10).ToList()));*@
        var oOneClickParameters=o1ClickDJ.oOneClickParameters;
        var rt = $(_this).closest("tr");
        var rt = $(rt).prop("checked");
        if (rt == true) {
            e.stopImmediatePropagation();
        }
        if (o1ClickDJ.ResultListDisplayType == 1 || o1ClickDJ.ResultListDisplayType == 2)
        {
            var tr = $(_this).closest('tr');
            var tddata = [];
            if (o1ClickDJ.DisplayAs == 50 || o1ClickDJ.DisplayAs == 170)
            {
                tddata=$('#OneClickResult-'+sTabGUID).dataTable().fnGetData($(_this).closest('tr'));
            }
            else
            {
                $(tr).children('td').each(function(ii, vv){
                    tddata[ii] = $(this).text();
                });
            }
            RowData = tddata;
        }
        else{
            RowData = $(_this).children("td").map(function() {
                return $(_this).text();
            }).get();
        }
        //Keerthi--Rowxilinkid for simple1click result grid
        //if(o1ClickDJ.iCatID=="10")
        //{
        //    $.ajax({
        //        type: 'POST',
        //        url: '/XiLink/GetRowXilinkID',
        //        data: { OneClickID: o1ClickDJ.oneClickID},
        //        cache: false,
        //        async: false,
        //        dataType: 'json',
        //        success: function (data) {
        //            o1ClickDJ.RowXiLinkID=data;
        //        }
        //    });
        //}
        var id;
        var IDRef = o1ClickDJ.sIDRef;
        if (RowData) {
            RowClickAttributeParams=[];
            var sHiddenString="";
            var sBOPK = oBODJ.sPrimaryKey;
            var bGUID = oBODJ.bGUID;
            var XIGUID="";
            for (var i = 0; i < o1ClickDJ.Headings.length; i++) {
                if (o1ClickDJ.Headings[i].toLowerCase() == sBOPK.toLowerCase()) {
                    id = RowData[i];
                }
                if (o1ClickDJ.Headings[i].toLowerCase() == "ProjectId".toLowerCase()) {
                    chatProjectId = RowData[i];
                }
                if (o1ClickDJ.Headings[i].toLowerCase() == "Override Type".toLowerCase()) {
                    iOverrideType = RowData[i];
                }
                if (o1ClickDJ.Headings[i].toLowerCase() == "HiddenData".toLowerCase()) {
                    sHiddenString = RowData[i];
                }
            }
            if(sHiddenString && sHiddenString!="")
            {
                if('@o1ClickD.sBOName' == 'XIDocumentTree'){
                    var parentuidialog = fncgetDialogFromHTMLTree('dialog', _this);
                    if(parentuidialog && parentuidialog != null){
                        $(parentuidialog).attr('data-info', sHiddenString);
                    }
                }
                var sHiddenAttrArray=sHiddenString.split(':');
                for (var Attr = 0; Attr < sHiddenAttrArray.length; Attr++) {
                    if(sHiddenAttrArray[Attr]!="")
                    {
                        var sAttrName=sHiddenAttrArray[Attr].split('__')[0];
                        var sAttrValue=sHiddenAttrArray[Attr].split('__')[1];
                        if(oOneClickParameters!=null&&oOneClickParameters.length>0)
                        {
                            for (var rAttr = 0; rAttr < oOneClickParameters.length; rAttr++) {
                                if(oOneClickParameters[rAttr].sName.toLowerCase()==sAttrName.toLowerCase())
                                {
                                    var RCAparam1 = {};
                                    RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                                    RCAparam1["sValue"] = sAttrValue;
                                    RowClickAttributeParams.push(RCAparam1);
                                    if(oOneClickParameters[rAttr].sName.toLowerCase() == sBOPK.toLowerCase()){
                                        id = sAttrValue;
                                    }
                                    else if(oOneClickParameters[rAttr].sName.toLowerCase() == "xiguid"){
                                        XIGUID = sAttrValue;
                                    }
                                }

                            }
                        }
                    }
                }
            }
            else
            {
                if(oOneClickParameters!=null&&oOneClickParameters.length>0)
                {
                    for (var rAttr = 0; rAttr < oOneClickParameters.length; rAttr++) {
                        for (var i = 0; i < o1ClickDJ.TableColumns.length; i++) {
                            if (o1ClickDJ.TableColumns[i].toLowerCase() == oOneClickParameters[rAttr].sName.toLowerCase()) {
                                var RCAparam1 = {};
                                RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                                RCAparam1["sValue"] = RowData[i];
                                RowClickAttributeParams.push(RCAparam1);
                            }
                        }
                    }
                }

            }
            var StaticParamsParams=o1ClickDJ.oOneClickParameters.filter(function (x) { return x.iType === 30});
            for (var c = 0; c < StaticParamsParams.length; c++) {
                var RCAparam1 = {};
                RCAparam1["sName"] = StaticParamsParams[c].sName;
                RCAparam1["sValue"] = StaticParamsParams[c].sValue;
                RowClickAttributeParams.push(RCAparam1);
            }
            var iInstanceID = "";
            if (bGUID == 'True' || ((IDRef && IDRef.length > 0 && IDRef.toLowerCase() == "xiguid") && XIGUID && XIGUID.length > 0)) {
                iInstanceID = XIGUID;
            }
            else{
                iInstanceID = (id);
            }
            var InputParams = [];
            if (iInstanceID && iInstanceID != null && iInstanceID.length > 0) {
                if(o1ClickDJ.IsRowClick == 'True' && (o1ClickDJ.RowXiLinkID > 0 || o1ClickDJ.RowXiLinkIDXIGUID.length > 0)){
                    var param1 = {};
                    param1["sName"] = 'sBOName';
                    param1["sValue"] = o1ClickDJ.sBOName;
                    InputParams.push(param1);
                    var param2 = {};
                    param2["sName"] = 'iBOIID';
                    param2["sValue"] = iInstanceID;
                    InputParams.push(param2);
                    var param3 = {};
                    param3["sName"] = 'iBODID';
                    param3["sValue"] = o1ClickDJ.BOID;
                    InputParams.push(param3);
                    var param4 = {};
                    param4["sName"] = '{-iInstanceID}';
                    param4["sValue"] = iInstanceID;
                    InputParams.push(param4);
                    var param5 = {};
                    param5["sName"] = '{XIP|'+o1ClickDJ.sBOName+'.id}';
                    param5["sValue"] = iInstanceID;
                    InputParams.push(param5);
                    var param6 = {};
                    param6["sName"] = '{XIP|sBOName}';
                    param6["sValue"] = o1ClickDJ.sBOName;
                    InputParams.push(param6);
                    var param7 = {};
                    param7["sName"] = '{XIP|iInstanceID}';
                    param7["sValue"] = iInstanceID;
                    InputParams.push(param7);
                    var param8 = {};
                    param8["sName"] = '{XIP|ActiveBO}';
                    param8["sValue"] = o1ClickDJ.sBOName;
                    InputParams.push(param8);
                    var param9 = {};
                    param9["sName"] = 'sBOLabel';
                    param9["sValue"] = oBODJ.LabelName;
                    InputParams.push(param9);
                    var param10 = {};
                    param10["sName"] = '1ClickID';
                    param10["sValue"] = o1ClickDJ.oneClickID;
                    InputParams.push(param10);
                    var param11 = {};
                    param11["sName"] = 'BOIDXIGUID';
                    param11["sValue"] = o1ClickDJ.BOIDXIGUID;
                    InputParams.push(param11);
                    var param13 = {};
                    param13["sName"] = '{XIP|ProjectID}';
                    param13["sValue"] = chatProjectId;
                    InputParams.push(param13);

                    if(RowClickAttributeParams!=null && RowClickAttributeParams.length>0)
                    {
                        for(var b=0;b<RowClickAttributeParams.length;b++){

                            var bExist = InputParams.filter(function (x) { return RowClickAttributeParams[b].sName == x.sName } ); //.Data = serialized[i].value;
                            if(bExist && bExist.length > 0){
                                for(var c=0;c<InputParams.length;c++){
                                    if(InputParams[c].sName == RowClickAttributeParams[b].sName){
                                        InputParams[c].sValue =RowClickAttributeParams[b].sValue;
                                    }
                                }
                                //InputParams.filter(function (x) { return x.sName === RowClickAttributeParams[b].sName; }).sValue = RowClickAttributeParams[b].sValue;
                            }
                            else{
                                InputParams.push(RowClickAttributeParams[b]);
                            }
                        }
                        //var newArray = $.merge(InputParams, RowClickAttributeParams);
                    }
                    if(o1ClickDJ.bIsRecordLock && o1ClickDJ.bIsRecordLock=='True')
                    {
                        $.ajax({
                            type: 'POST',
                            url: '@Url.Action("SetbLock", "XiLink")',
                            data: { iBODID: o1ClickDJ.BOID,sBOName:o1ClickDJ.sBOName,sInstanceID:iInstanceID},
                            cache: false,
                            async: false,
                            dataType: 'json',
                            success: function (data) {
                                if(data!="")
                                {
                                    var param = {};
                                    param["sName"] = 'bIsLock';
                                    param["sValue"] = true;
                                    InputParams.push(param);
                                }
                                else
                                {
                                    var param = {};
                                    param["sName"] = 'bIsLock';
                                    param["sValue"] = false;
                                    InputParams.push(param);
                                }
                            }
                        });
                    }
                    if(oBODJ.sAuditBOName&&oBODJ.sAuditBOName=="Audit_T")
                    {
                        $.ajax({
                            type: 'POST',
                            url: '@Url.Action("SaveAuditBO", "XiLink")',
                            data: { iBODID: oBODJ.BOID, sAuditBOName: oBODJ.sAuditBOName, sBOName: o1ClickDJ.sBOName, sInstanceID: iInstanceID, sAuditContent: null, sGUID: sGUID },
                            cache: false,
                            async: true,
                            dataType: 'json',
                            success: function (data) {
                            }
                        });
                    }
                    if (o1ClickDJ.ResultListDisplayType == '2') {
                        var sTarget = o1ClickDJ.sTarget;
                        fncGetBOAttributeValue(o1ClickDJ.BOIDXIGUID, iInstanceID).then(function (SelectedLabel) {
                            $('#' + sTarget).attr('data-iid', iInstanceID);
                            $('#' + sTarget).html(SelectedLabel);
                        })
                    }
                    else if(o1ClickDJ.sRowXiLinkType == "run")
                    {
                        XIRun(null,o1ClickDJ.RowXiLinkIDXIGUID, parseInt(iInstanceID), sGUID, o1ClickDJ.sBOName, false,parseInt(o1ClickDJ.BOID),0,null,InputParams);
                    }
                    else
                    {
                        XILinkLoadJson(o1ClickDJ.RowXiLinkIDXIGUID, sGUID, InputParams);
                    }
                }
            }
            else
            {
                XILinkLoadJson(o1ClickDJ.RowXiLinkIDXIGUID, sGUID, InputParams);
            }
        }
    };
    function fncTrigger1Click(_this, o1ClickDJ, oBODJ, oCompDJ, sGUID, sTabGUID){
        var oOneClickParameters=o1ClickDJ.oOneClickParameters;
        var RowClickAttributeParams=[];
        var rt = $(_this).closest("tr");
        var rt = $(rt).prop("checked");
        if (rt == true) {
            e.stopImmediatePropagation();
        }
        if(o1ClickDJ.ResultListDisplayType==1)
        {
            var tr = $(_this).closest('tr');
            var tddata = [];
            if (o1ClickDJ.DisplayAs == 50 || o1ClickDJ.DisplayAs == 170 )
            {
                tddata=$('#OneClickResult-'+sTabGUID).dataTable().fnGetData($(_this).closest('tr'));
            }
            else
            {
                $(tr).children('td').each(function(ii, vv){
                    tddata[ii] = $(this).text();
                });
            }
            RowData = tddata;
        }
        else{
            RowData = $(_this).children("td").map(function() {
                return $(_this).text();
            }).get();
        }
        var id;
        //if(o1ClickDJ.ResultListDisplayType==1)
        //{
        //    var tr = $(_this).closest('tr');
        //    var tddata = [];
        //    $(tr).children('td').each(function(ii, vv){
        //        tddata[ii] = $(_this).text();
        //    });
        //    RowData = tddata;
        //}
        //else{
        //    RowData = $(_this).children("td").map(function() {
        //        return $(_this).text();
        //    }).get();
        //}
        var sHiddenString="";
        var sBOPK = oBODJ.sPrimaryKey;
        var bGUID = oBODJ.bGUID;
        var XIGUID = "";
        var IDRef = o1ClickDJ.sIDRef;
        if(RowData){
            for (var i = 0; i < o1ClickDJ.Headings.length; i++) {
                if (o1ClickDJ.Headings[i].toLowerCase() == sBOPK.toLowerCase() || o1ClickDJ.Headings[i].toLowerCase() == "ID".toLowerCase() || o1ClickDJ.Headings[i].toLowerCase() == "XiLinkID".toLowerCase() || o1ClickDJ.Headings[i].toLowerCase() == "BOID".toLowerCase()) {
                    id = RowData[i];
                }
                if (o1ClickDJ.Headings[i].toLowerCase() == "HiddenData".toLowerCase()) {
                    sHiddenString = RowData[i];
                }
            }
        }
        if(sHiddenString && sHiddenString!="")
        {
            var sHiddenAttrArray=sHiddenString.split(':');
            for (var Attr = 0; Attr < sHiddenAttrArray.length; Attr++) {
                if(sHiddenAttrArray[Attr]!="")
                {
                    var sAttrName=sHiddenAttrArray[Attr].split('__')[0];
                    var sAttrValue=sHiddenAttrArray[Attr].split('__')[1];
                    if(oOneClickParameters!=null&&oOneClickParameters.length>0)
                    {
                        for (var rAttr = 0; rAttr < oOneClickParameters.length; rAttr++) {
                            if(oOneClickParameters[rAttr].iType == 40){
                                var RCAparam1 = {};
                                RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                                RCAparam1["sValue"] = oOneClickParameters[rAttr].sName;
                                RowClickAttributeParams.push(RCAparam1);
                            }
                            else if(oOneClickParameters[rAttr].sName.toLowerCase()==sAttrName.toLowerCase())
                            {
                                var RCAparam1 = {};
                                RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                                RCAparam1["sValue"] = sAttrValue;
                                RowClickAttributeParams.push(RCAparam1);
                                if(oOneClickParameters[rAttr].sName.toLowerCase() == sBOPK.toLowerCase()){
                                    id = sAttrValue;
                                }
                                else if (oOneClickParameters[rAttr].sName.toLowerCase() == "xiguid") {
                                    XIGUID = sAttrValue;
                                }
                            }

                        }
                    }
                }
            }
        }
        else
        {
            if(oOneClickParameters!=null&&oOneClickParameters.length>0)
            {
                for (var rAttr = 0; rAttr < oOneClickParameters.length; rAttr++) {
                    for (var i = 0; i < o1ClickDJ.TableColumns.length; i++) {
                        if(oOneClickParameters[rAttr].iType == 40){
                            var RCAparam1 = {};
                            RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                            RCAparam1["sValue"] = oOneClickParameters[rAttr].sName;
                            RowClickAttributeParams.push(RCAparam1);
                        }
                        else if (o1ClickDJ.TableColumns[i].toLowerCase() == oOneClickParameters[rAttr].sName.toLowerCase()) {
                            var RCAparam1 = {};
                            RCAparam1["sName"] = oOneClickParameters[rAttr].sValue;
                            RCAparam1["sValue"] = RowData[i];
                            RowClickAttributeParams.push(RCAparam1);
                        }
                    }
                }
            }

        }
        var iInstanceID = "";
        if ('@bUIDRef' == 'True') {
            bGUID = 'True';
        }
        if (bGUID == 'True' || ((IDRef && IDRef.length > 0 && IDRef.toLowerCase() == "xiguid") && XIGUID && XIGUID.length > 0)) {
            iInstanceID = XIGUID;
        }
        else {
            iInstanceID=id;
        }
        var QSInfo = fncQSInfoFromHTMLTree(_this);
        var NewParams = [];
        var InputParams = [];
        var QSEvents = "";
        var ComponentName = fncGetComponentNameFromHTMLTree('Component', _this);
        var WrapperParms = {};
        var CurrentGUID = sCurrentGUID;
        var _uidialog = fncgetDialogFromHTMLTree('dialog', _this);
        if (_uidialog == null || (_uidialog && _uidialog.length == 0)) {
            sLayoutType = "inline-layout";
            _uidialog = fncgetInlineLayoutFromHTMLTree('inline-layout', _this);
        }
        //var StepID = ComponentName.split('-')[1];
        if(QSInfo[2].sValue && QSInfo[2].sValue && QSInfo[2].sValue && QSInfo[2].sValue.length > 0){
            var jCompDef = oCompDJ.Params; @*'@Html.Raw(Json.Encode(Model.oDefintion))';*@
            var ConfigParams = oCompDJ.Params; //JSON.parse(jCompDef);
            if(ConfigParams) {
                for(var i=0;i<ConfigParams.length;i++){
                    if(ConfigParams[i].sName.toLowerCase() == "listClickparamname".toLowerCase()){
                        WrapperParms["sName"] = ConfigParams[i].sValue;
                        WrapperParms["sValue"] = "XIC|null";
                        var param1 = {};
                        param1["sName"] = '{XIP|ActiveBO}';
                        param1["sValue"] = o1ClickDJ.sBOName;
                        InputParams.push(param1);
                        var param2 = {};
                        param2["sName"] = 'iBOIID';
                        param2["sValue"] = iInstanceID;
                        InputParams.push(param2);
                        var param3 = {};
                        param3["sName"] = 'iInstanceID';
                        param3["sValue"] = iInstanceID;
                        InputParams.push(param3);
                        var param4 = {};
                        param4["sName"] = '{-iInstanceID}';
                        param4["sValue"] = iInstanceID;
                        InputParams.push(param4);
                        var param5 = {};
                        param5["sName"] = 'iOverrideType';
                        param5["sValue"] = iOverrideType;
                        InputParams.push(param5);
                        var param6 = {};
                        param6["sName"] = '{XIP|sBOName}';
                        param6["sValue"] = o1ClickDJ.sBOName;
                        InputParams.push(param6);
                        var param7 = {};
                        param7["sName"] = '{XIP|iInstanceID}';
                        param7["sValue"] = iInstanceID;
                        InputParams.push(param7);
                        var param7 = {};
                        param7["sName"] = 'iBODID';
                        param7["sValue"] = o1ClickDJ.BOID;
                        InputParams.push(param7);
                        var param7 = {};
                        param7["sName"] = 'BOIDXIGUID';
                        param7["sValue"] = o1ClickDJ.BOIDXIGUID;
                        InputParams.push(param7);
                        if(RowClickAttributeParams!=null && RowClickAttributeParams.length>0)
                        {
                            for(var b=0;b<RowClickAttributeParams.length;b++){

                                var bExist = InputParams.filter(function (x) { return RowClickAttributeParams[b].sName == x.sName } ); //.Data = serialized[i].value;
                                if(bExist && bExist.length > 0){
                                    for(var c=0;c<InputParams.length;c++){
                                        if(InputParams[c].sName == RowClickAttributeParams[b].sName){
                                            InputParams[c].sValue =RowClickAttributeParams[b].sValue;
                                        }
                                    }
                                    //InputParams.filter(function (x) { return x.sName === RowClickAttributeParams[b].sName; }).sValue = RowClickAttributeParams[b].sValue;
                                }
                                else{
                                    InputParams.push(RowClickAttributeParams[b]);
                                    NewParams.push(RowClickAttributeParams[b]);
                                    var param8 = {};
                                    param8["sName"] = 'iPage';
                                    param8["sValue"] = "0";
                                    NewParams.push(param8);
                                    var param9 = {};
                                    param9["sName"] = 'sLoadType';
                                    param9["sValue"] = "normal";
                                    NewParams.push(param9);
                                }
                            }
                            //var newArray = $.merge(InputParams, RowClickAttributeParams);
                        }
                        WrapperParms["nSubParams"] = InputParams;
                    }
                    else if(ConfigParams[i].sName.toLowerCase().indexOf('listclick') >= 0 && ConfigParams[i].sName.toLowerCase() != "listClickparamname".toLowerCase()){
                        if(ConfigParams[i].sValue && ConfigParams[i].sValue.length > 0){
                            QSEvents = QSEvents+ConfigParams[i].sValue+",";
                        }
                    }
                }
                if(QSEvents.length>0){
                    QSEvents = QSEvents.substring(0, QSEvents.length - 1);
                    funCallQSEvent(QSInfo, QSEvents).then(function (nXILinks) {
                        var QSDefID = 0;
                        for(m=0;m<QSInfo.length;m++){
                            if(QSInfo[m].sName=="iQSDID"){
                                QSDefID = QSInfo[m].sValue;
                            }
                        }
                        for(var k=0;k<nXILinks.length;k++){
                            XIRun(null,nXILinks[k], 0, sGUID, 0, false, 0, QSDefID);
                        }
                    });
                }
                NewParams.push(WrapperParms);
                var IDEParams = @Html.Raw(Json.Encode(o1ClickD.FilterGroup));
                if(IDEParams){
                    if (Object.keys(IDEParams).length > 0){
                        var sMode = IDEParams["sMode"];
                        var sTreeGUID = IDEParams["sTreeGUID"];
                        var iNodeID = IDEParams["iNodeID"];
                        fncUpdateXITree(o1ClickDJ.BOIDXIGUID, iInstanceID, iNodeID, sTreeGUID)
                    }
                }
                fncUpdateXIParams(ComponentName, sGUID, CurrentGUID, NewParams).then(function (data) {
                    if(data != null && data != 'undefined'){
                        TriggerComponent(sGUID, 'OneClickComponent', data, null, _uidialog).then(function (ID) {
                            //LoadSubnodeStep(sGUID, 'Step7 with BO Component', QSInfo[0].sValue, ID);
                        });
                    }

                });
                //fncUpdateXIParams(ComponentName, sGUID, CurrentGUID, NewParams);
            }
        }
    };

    //const content_height = $(window).height() - $('#HomeHeader').height();
    //$('#OneClickComponent .OneClickResDiv').slimScroll({
    //    //height: '250px',
    //    height: content_height,
    //});
    /**/const content_height = $(window).height() - $('#HomeHeader').height() - 10;
    $('.scroll_vh_100').not('.sec-controlbox .scroll_vh_100').slimScroll({
        height: content_height,
    });
    /*$(".ui-dialog .scroll_vh_100").not('.sec-controlbox .scroll_vh_100').slimscroll({destroy:true});
    $('.ui-dialog .scroll_vh_100').not('.sec-controlbox .scroll_vh_100').attr('style', '');


    $(".dialog-box .scroll_vh_100").slimscroll({destroy:true});
    const dlg_content_height = $('.ui-dialog').height() - 54;
    $('.dialog-box .scroll_vh_100').slimScroll({height: dlg_content_height});
    const dlg_content_height_2 = $('.ui-dialog').height() - $('.ui-dialog #TabsArea').height() - 54;
    $('.dialog-box #MainContent .scroll_vh_100').slimScroll({height: dlg_content_height_2});
    const content_height = $(window).height() - $('#HomeHeader').height() - 10;
    $('.scroll_vh_100').slimScroll({
        height: content_height,
    });*/

    function fncExecuteAsncQuotes(){
        $.ajax({
            url: '@Url.Action("ExecuteAsncQuotes", "XiLink")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            async: true,
            cache: false,
            data: JSON.stringify({ sGUID: '@o1ClickD.sGUID' }),
            success: function (data) {
                var RefreshBtn = $('.hideref-' + @o1ClickD.BOID);
                if (RefreshBtn && RefreshBtn.length > 0) {
                    $(RefreshBtn[0]).click();
                }
            },
            error: function (data) {

            }
        })
    }
    function fncExecuteXIAlgorithm($this, XiLinkID) {
        var o1ClickDJ ={
                oOneClickParameters :@Html.Raw(Json.Encode(o1ClickD.oOneClickParameters.Where(x => x.iType == 10 || x.iType == 30 || x.iType == 40).ToList())),
                ResultListDisplayType :'@o1ClickD.ResultListDisplayType',
                ResultListDisplayType : '@o1ClickD.ResultListDisplayType',
                DisplayAs : '@o1ClickD.DisplayAs',
                Headings : @Html.Raw(Json.Encode(o1ClickD.Headings)),
                TableColumns : @Html.Raw(Json.Encode(o1ClickD.TableColumns)),
                IsRowClick : '@o1ClickD.IsRowClick',
                RowXiLinkID : '@o1ClickD.RowXiLinkID',
                sBOName : '@o1ClickD.sBOName',
                BOID : '@o1ClickD.BOID',
                bIsRecordLock : '@o1ClickD.bIsRecordLock',
                sRowXiLinkType : '@o1ClickD.sRowXiLinkType',
                oneClickID:'@o1ClickD.ID',
                iCatID:'@o1ClickD.CategoryID',
            }
        var tr = $($this).closest('tr');
        var id = "";
        var tddata = [];
        var RowData;
        $(tr).children('td').each(function (ii, vv) {
            tddata[ii] = $(this).text();
        });
        RowData = tddata;
        var sBOPK = '@sPrimaryKey';
        for (var i = 0; i < o1ClickDJ.Headings.length; i++) {
            if (o1ClickDJ.Headings[i].toLowerCase() == sBOPK.toLowerCase()) {
                id = RowData[i];
            }
        }
        var NewGUID = CreateGuid();
        fncSetParam(id, NewGUID, "{XIP|iInstanceID}", "").then(function (state, callback) {
            XIRun($this, XiLinkID, 0, NewGUID, '@o1ClickD.sBOName', false);
            var RefreshBtn = $('.hideref-' + @o1ClickD.BOID);
            if (RefreshBtn && RefreshBtn.length > 0) {
                //$(RefreshBtn[0]).click();
            }
        })
    }



    function loadProjectDetails(tableName, Id) {
        debugger
        $.ajax({
            url: '@Url.Action("LoadProjectDetails", "XIComponents")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            async: true,
            cache: false,
            data: JSON.stringify({ sBO: tableName, id:Id }),
            success: function (data) {
                ProjId = data;
                console.log("projectId:"+ProjId);
            },
            error: function (data) {

            }
        })
                        }
     var ProjId = '@sTabGUID';
     var ProjectID = $("#append").val();
     var hub = $.connection.oneHub;
                        hub.server.joinGroup("Group_" + ProjectID);
                        @*var ProjId = '@sTabGUID';
                        if (ProjId > 0) {
                            var input = document.getElementById("ChatMsgBox_@sTabGUID");
                            input.addEventListener("keypress", function (event) {
                                debugger
                                if (event.key === "Enter") {
                                    event.preventDefault();
                                    document.getElementById("msgPress").click();
                                }
                            });
                        }*@

                        $(document).ready(function () {
                            $('#ChatMsgBox_@sTabGUID').on('keydown', function (event) {
                                if (event.key === 'Enter' || event.keyCode === 13) {
                                    // Check if the Enter key was pressed
                                    fncSaveChatMessage(); // Call your function here
                                    event.preventDefault(); // Prevent a newline character from being inserted
                                }
                            });
                        });



    function fncSaveChatMessage(chatID, FileAliasName, FilePath) {
        var sMessage = $('#ChatMsgBox_@sTabGUID').val();
        var ProjectID = $("#append").val();
        var categoryID = $("#selectcategory").val();
        var reciverID = '';
        var ProjectName = $("#append").text();
        var ImgID = $('#UploadImageValue').val()
        var ChattypeID = $(".icn.active").attr("id");
        $.ajax({
            url: '@Url.Action("Save_ChatMessage", "XIComponents")',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            async: true,
            cache: false,
            data: JSON.stringify({ sMessage: sMessage, reciverID: reciverID, sProjectID: ProjectID, ImgID: ImgID, chatID: chatID, categoryID: categoryID, FileAliasName: FileAliasName, FilePath: FilePath, ChattypeID: ChattypeID }),
            success: function (data) {
                debugger;
                $('#UploadImage').val('');
                var username = '@sUserName'; // The username to remove
                        var intValue = parseInt($('#thumb_' + chatID).text());
                        // Get the UI element by its ID
                        var uiElement = document.getElementById('Name_' + chatID);
                if (data != "" && data != "ok") {
                    var FKIChatID = data.Attributes.FKIChatID.sValue;
                    if (FKIChatID == "") {
                        var timeArray = data.Attributes.tTime.sValue.split(':');
                        var hours = timeArray[0];
                        var minutes = timeArray[1];
                        var formattedTime = hours + ':' + minutes;
                        var date = data.Attributes.dDate.sValue.split(' ');
                        if (@iUserID == data.Attributes.iSenderID.sValue) {
                            var sHTML = '<li class="clearfix"><div class="msg-right"><div class="message my-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick = "fncSaveChatMessage(' + data.Attributes.id.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + data.Attributes.id.sValue + '></div>';
                            if (data.Attributes.sDescription.sValue.length > 0) {
                                sHTML = sHTML + '<p> ' + data.Attributes.sDescription.sValue + '</p>';
                            }
                            else if (data.Attributes.sAliasName.sValue.length > 0) { sHTML = sHTML + '<a download href="' + data.Attributes.sFullPath.sValue + '"><p> ' + data.Attributes.sAliasName.sValue + '</p></a>'; }
                            sHTML = sHTML + '<span class="message-data-time" > ' + data.Attributes.XICreatedBy.sValue + ' ' + date[0] + ' ' + formattedTime + '</span ></div> <div class="expression-icon-select" id="selected_' + data.Attributes.id.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + data.Attributes.id.sValue + '"></span></div>';
                            sHTML = sHTML + '<ul id=Name_' + data.Attributes.id.sValue + '></ul> </div></div></li> ';
                        }
                        else {

                            var sHTML = '<li class="clearfix"><div class="message other-message context-menu-one"><div class="expression-icon"><span class="fa fa-thumbs-up icon text-warning" onclick="fncSaveChatMessage(' + data.Attributes.id.sValue + ');"></span><input type="hidden" id="chatID" name="chatID" value=' + data.Attributes.id.sValue + '></div>';
                            if (data.Attributes.sDescription.sValue.length > 0) {
                                sHTML = sHTML + '<p> ' + data.Attributes.sDescription.sValue + '</p>';
                            }
                            else if (data.Attributes.sAliasName.sValue.length > 0) { sHTML = sHTML + '<a download href="' + data.Attributes.sFullPath.sValue + '"><p> ' + data.Attributes.sAliasName.sValue + '</p></a>'; }

                            sHTML = sHTML + '<span class="message-data-time">' + data.Attributes.XICreatedBy.sValue + ' ' + date[0] + ' ' + formattedTime + '</span></div><div class="expression-icon-select"  id="selected_' + data.Attributes.id.sValue + '"><div class="thumbUserList"><span class="fa fa-thumbs-up icon text-warning"></span><span class="num" id="thumb_' + data.Attributes.id.sValue + '"></span></div><ul id=Name_' + data.Attributes.id.sValue + '></ul></div></li>';
                        }

                        $('#ChatMsgBox_@sTabGUID').val('');
                    }
                    else {                      
                        var listItems = uiElement.querySelectorAll('li');
                        if (uiElement != null) {
                            // If <li> element exists with the specified username, remove it
                            var existingLiElements = uiElement.querySelectorAll('li');
                            var usernameExists = false;

                            // Iterate over existing <li> elements to check if the username already exists
                            existingLiElements.forEach(function (liElement) {
                                // Check if liElement is not undefined
                                if (liElement && liElement.textContent && liElement.textContent.trim() === username) {
                                    usernameExists = true;
                                    return; // Exit the loop early if the username is found
                                }
                            });

                            // If the username does not exist, create a new <li> element and append it to the UI element
                            if (!usernameExists) {
                                var newLiElement = document.createElement('li');
                                newLiElement.textContent = username;
                                uiElement.appendChild(newLiElement);
                            }

                            else {
                                listItems.forEach(function (li) {
                                    // Check if the text content of the list item matches the username
                                    if (li.textContent.trim() === username) {
                                        // Remove the list item from the UI element
                                        li.remove();
                                    }
                                });
                            }
                        }
                        else {
                            var listItem = document.createElement('li');
                            listItem.textContent = '@sUserName';
                            uiElement.appendChild(listItem);
                        }
                        var intValue = parseInt($('#thumb_' + chatID).text());
                        $('#thumb_' + chatID).text('')
                        $('#selected_' + chatID).addClass('selected');
                        if (intValue > 0 && intValue !='NaN') { $('#thumb_' + chatID).append(intValue + 1); }
                        else { $('#thumb_' + chatID).append(1); }
                    }

                    if (ProjectID > 0) {
                        if ($.connection.hub.state === $.signalR.connectionState.connected) {
                            hub.server.joinGroup("Group_" + ProjectID);
                            console.log("Group_" + ProjectID);
                            hub.server.sendMessageToGroup("Group_" + ProjectID, ProjectID, sHTML);
                        } else {
                            console.error('Connection is not yet established. Cannot send data.');
                        }

                    }
                }
                else {
                    if (uiElement != null) {
                        var listItems = uiElement.querySelectorAll('li');
                        var existingLiElements = uiElement.querySelectorAll('li');
                        var usernameExists = false;
                        // Iterate over existing <li> elements to check if the username already exists
                        existingLiElements.forEach(function (liElement) {
                            // Check if liElement is not undefined
                            if (liElement && liElement.textContent && liElement.textContent.trim() === username) {
                                usernameExists = true;
                                return; // Exit the loop early if the username is found
                            }
                        });
                        // If the username does not exist, create a new <li> element and append it to the UI element
                        if (!usernameExists) {
                            var newLiElement = document.createElement('li');
                            newLiElement.textContent = username;
                            uiElement.appendChild(newLiElement);
                        }
                        else {
                            listItems.forEach(function (li) {
                                // Check if the text content of the list item matches the username
                                if (li.textContent.trim() === username) {
                                    // Remove the list item from the UI element
                                    li.remove();
                                }
                            });
                        }
                    }
                    else {
                        var listItem = document.createElement('li');
                        listItem.textContent = '@sUserName';
                        uiElement.appendChild(listItem);
                    }
                    var intValue = parseInt($('#thumb_' + chatID).text());
                    $('#thumb_' + chatID).text('');
                    $('#selected_' + chatID).addClass('selected');
                    if (intValue === 1)
                    { $('#selected_' + chatID).removeClass('selected'); }
                    else {
                        $('#thumb_' + chatID).append(intValue - 1);
                    }
                }

            },
            error: function (data) {
                debugger;
            }
        })
     }
</script>
